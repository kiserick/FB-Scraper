import {Environment} from '../env/testEnv';
import {FacebookNotificationsHandler} from '../../src/facebook/FacebookNotificationsHandler';
import {TestAid} from '../env/testAid.es6';

let aid = new TestAid();
let chai = require('chai');
let env = new Environment();
let htmlparser = require('htmlparser2');
let subject = null;

describe('FacebookNotificationsHandler testing.', function() {

	chai.should();
	this.error = (error) => assert('Error thrown', false);

	var execute = (done, html, tests) => {
		subject = new FacebookNotificationsHandler((error, data) => {
			if (error) {
				this.error();
			} else if (tests) {
				tests(data);
			}
			done();
		})

		var parser = new htmlparser.Parser(subject, {
			recognizeSelfClosing: true
		});
		parser.write(html);
		parser.done();
	};

	describe('#parse', function() {

		it('simple data feed...', function(done) {
			var html = '<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Notifications</title></head><body class="b c d e" tabindex="0"><div class="f"><div id="viewport"><div id="objects_container"><div class="bf e" id="root" role="main"><div class="bg"><div class="e" id="notifications_list"><div class="bh" id="notifications_list"><h2 class="bi"><a aria-label="Notification Settings" class="bj bk" href="/settings/notifications/?refid=48" role="button"><img class="bl r bm r" height="20" src="https://static.xx.fbcdn.net/rsrc.php/v2/yj/r/7Ov1U5Yvw-2.png" width="20"/></a></h2><div><h5 class="bn bo i">Today</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D1592528147741952%26id%3D100009543463363&amp;seennotification=1461897991225799&amp;gfid=AQD8TA4yn0WrSbOB&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yr/r/_CqYdac1bgZ.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D1592528147741952%26id%3D100009543463363&amp;seennotification=1461897991225799&amp;gfid=AQD8TA4yn0WrSbOB&amp;refid=48"><div>Your profile video is ready to view. <span class="bw bx"><abbr class="by">2 hours ago</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D1592513531076747%26id%3D100009543463363&amp;seennotification=1461894630933281&amp;gfid=AQDoFN7RDg50_hue&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yr/r/_CqYdac1bgZ.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D1592513531076747%26id%3D100009543463363&amp;seennotification=1461894630933281&amp;gfid=AQDoFN7RDg50_hue&amp;refid=48"><div>Your video is ready to view. You can now watch it. <span class="bw bx"><abbr class="by">3 hours ago</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">27 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F771062152968455%3Fview%3Dpermalink%26id%3D1054182981323036&amp;seennotification=1461741400382742&amp;gfid=AQCR4ZE61dADk_dw&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y1/r/vF2XT-TEoHq.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F771062152968455%3Fview%3Dpermalink%26id%3D1054182981323036&amp;seennotification=1461741400382742&amp;gfid=AQCR4ZE61dADk_dw&amp;refid=48"><div><span class="blueName">Timothy Nunn</span> added 5 photos in <span class="blueName">Perth Gamers - Retro Console, Arcade, Pinball &amp; PC - fans, traders &amp; events</span>. <span class="bw bx"><abbr class="by">Wednesday at 15:16</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1784275615125204&amp;seennotification=1461558018260516&amp;gfid=AQBArj1vWk4H2eIN&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1784275615125204&amp;seennotification=1461558018260516&amp;gfid=AQBArj1vWk4H2eIN&amp;refid=48"><div><span class="blueName">Robin Batra</span> added 3 photos in <span class="blueName">Perth Beer Economy.</span> on Tuesday. <span class="bw bx"><abbr class="by">Wednesday at 12:04</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">26 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F771062152968455&amp;seennotification=1461520751559000&amp;gfid=AQCxabfqc8oqSPK1&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y1/r/vF2XT-TEoHq.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F771062152968455&amp;seennotification=1461520751559000&amp;gfid=AQCxabfqc8oqSPK1&amp;refid=48"><div><span class="blueName">Timothy Nunn</span>, <span class="blueName">Gabriel Harmsen</span> and 2 others posted in <span class="blueName">Perth Gamers - Retro Console, Arcade, Pinball &amp; PC - fans, traders &amp; events</span>. <span class="bw bx"><abbr class="by">26 April at 12:24</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">22 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fsupport%2Fview_details%2F%3Fid%3D1583037268691040%26ref_medium%3Dtextonly&amp;seennotification=1461285366050657&amp;gfid=AQBT62OCst5_oWIO&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yK/r/olv3peIolPi.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fsupport%2Fview_details%2F%3Fid%3D1583037268691040%26ref_medium%3Dtextonly&amp;seennotification=1461285366050657&amp;gfid=AQBT62OCst5_oWIO&amp;refid=48"><div>We have an update about a problem you reported: &quot;Dear Facebook Support\n\nI use the...&quot; <span class="bw bx"><abbr class="by">22 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">21 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F771062152968455%3Fview%3Dpermalink%26id%3D1050262165048451&amp;seennotification=1461253453600211&amp;gfid=AQDIJVTDIZZSbNmf&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y1/r/vF2XT-TEoHq.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F771062152968455%3Fview%3Dpermalink%26id%3D1050262165048451&amp;seennotification=1461253453600211&amp;gfid=AQDIJVTDIZZSbNmf&amp;refid=48"><div><span class="blueName">Brad King</span> posted in <span class="blueName">Perth Gamers - Retro Console, Arcade, Pinball &amp; PC - fans, traders &amp; events</span>. <span class="bw bx"><abbr class="by">21 April</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Ffind-friends%2Fbrowser%2F&amp;seennotification=1461202160915352&amp;gfid=AQCwHo7HXVT2cQ19&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yE/r/7Sq7wKJHi_5.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Ffind-friends%2Fbrowser%2F&amp;seennotification=1461202160915352&amp;gfid=AQCwHo7HXVT2cQ19&amp;refid=48"><div>Do you know Dale Wells? <span class="bw bx"><abbr class="by">21 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">19 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Ffind-friends%2Fbrowser%2F&amp;seennotification=1461064491568956&amp;gfid=AQAKnG0UH-OMvML3&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yE/r/7Sq7wKJHi_5.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Ffind-friends%2Fbrowser%2F&amp;seennotification=1461064491568956&amp;gfid=AQAKnG0UH-OMvML3&amp;refid=48"><div>Do you know Ty Mckinnon? <span class="bw bx"><abbr class="by">19 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">17 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F771062152968455&amp;seennotification=1460725362712140&amp;gfid=AQDCGFW3QoUIPIEx&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y1/r/vF2XT-TEoHq.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F771062152968455&amp;seennotification=1460725362712140&amp;gfid=AQDCGFW3QoUIPIEx&amp;refid=48"><div><span class="blueName">Dylan Sainsbury</span>and <span class="blueName">Chris Malkowski</span>posted in <span class="blueName">Perth Gamers - Retro Console, Arcade, Pinball &amp; PC - fans, traders &amp; events</span>. <span class="bw bx"><abbr class="by">17 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">15 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D260465974291227%26id%3D100009834785112&amp;seennotification=1460716386026369&amp;gfid=AQAQes3aoUvUpcHd&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yY/r/hBdHTt6W4dK.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D260465974291227%26id%3D100009834785112&amp;seennotification=1460716386026369&amp;gfid=AQAQes3aoUvUpcHd&amp;refid=48"><div><span class="blueName">Skooter Martin</span>updated his status. <span class="bw bx"><abbr class="by">15 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">14 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1778510779035021&amp;seennotification=1460580792088099&amp;gfid=AQBJ81xCiHUkYtRL&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1778510779035021&amp;seennotification=1460580792088099&amp;gfid=AQBJ81xCiHUkYtRL&amp;refid=48"><div><span class="blueName">Jordan Vagnoni</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;Couch set&quot;. <span class="bw bx"><abbr class="by">14 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">13 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1778148472404585&amp;seennotification=1460496644013561&amp;gfid=AQAc072yPfrqaSA5&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1778148472404585&amp;seennotification=1460496644013561&amp;gfid=AQAc072yPfrqaSA5&amp;refid=48"><div><span class="blueName">Bill Farmer</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;Customized tables&quot;. <span class="bw bx"><abbr class="by">13 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">12 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1778035925749173&amp;seennotification=1460466430172681&amp;gfid=AQBlCY4CsrjWR1gQ&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1778035925749173&amp;seennotification=1460466430172681&amp;gfid=AQBlCY4CsrjWR1gQ&amp;refid=48"><div><span class="blueName">Jess Briggs</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;Frangipani cuttings&quot;. <span class="bw bx"><abbr class="by">12 April</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F771062152968455%3Fview%3Dpermalink%26id%3D1044005189007482&amp;seennotification=1460288788781939&amp;gfid=AQBT8h8-GhBWtGGR&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y1/r/vF2XT-TEoHq.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F771062152968455%3Fview%3Dpermalink%26id%3D1044005189007482&amp;seennotification=1460288788781939&amp;gfid=AQBT8h8-GhBWtGGR&amp;refid=48"><div><span class="blueName">Adrian Hawke</span>posted in <span class="blueName">Perth Gamers - Retro Console, Arcade, Pinball &amp; PC - fans, traders &amp; events</span>. <span class="bw bx"><abbr class="by">12 April</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1777681232451309&amp;seennotification=1460431530043281&amp;gfid=AQD_lxOX7y7qHwgd&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1777681232451309&amp;seennotification=1460431530043281&amp;gfid=AQD_lxOX7y7qHwgd&amp;refid=48"><div><span class="blueName">Tosh Polmear</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;2x 3-Seater couches&quot;. <span class="bw bx"><abbr class="by">12 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">11 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1777560969130002&amp;seennotification=1460372139744760&amp;gfid=AQBFaNvo1hez1uoU&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1777560969130002&amp;seennotification=1460372139744760&amp;gfid=AQBFaNvo1hez1uoU&amp;refid=48"><div><span class="blueName">Leo O\'Kane</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;table and chairs&quot;. <span class="bw bx"><abbr class="by">11 April</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1777509342468498&amp;seennotification=1460343194165776&amp;gfid=AQC7kJ9xR05OSAbk&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1777509342468498&amp;seennotification=1460343194165776&amp;gfid=AQC7kJ9xR05OSAbk&amp;refid=48"><div><span class="blueName">Danielle Wilson-Moore</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;swing set&quot;. <span class="bw bx"><abbr class="by">11 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">10 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1777220229164076&amp;seennotification=1460290006029781&amp;gfid=AQDE2Rj-OhxLfp2H&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1777220229164076&amp;seennotification=1460290006029781&amp;gfid=AQDE2Rj-OhxLfp2H&amp;refid=48"><div><span class="blueName">Brendan Brookes</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;Wood heater&quot;. <span class="bw bx"><abbr class="by">10 April</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1777170405835725&amp;seennotification=1460272629523788&amp;gfid=AQDhVNfSL_G5NPo7&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1777170405835725&amp;seennotification=1460272629523788&amp;gfid=AQDhVNfSL_G5NPo7&amp;refid=48"><div><span class="blueName">Kidd Poyner</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;Pool table&quot;. <span class="bw bx"><abbr class="by">10 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">9 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1776700015882764&amp;seennotification=1460159692541001&amp;gfid=AQA0O9Kag639l8sj&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1776700015882764&amp;seennotification=1460159692541001&amp;gfid=AQA0O9Kag639l8sj&amp;refid=48"><div><span class="blueName">Glenn Coombs</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;Car parts. Tools. Etc&quot;. <span class="bw bx"><abbr class="by">9 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">8 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1776329249253174&amp;seennotification=1460099806373902&amp;gfid=AQDIUJ1o40en2HFk&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1776329249253174&amp;seennotification=1460099806373902&amp;gfid=AQDIUJ1o40en2HFk&amp;refid=48"><div><span class="blueName">Bec Henderson</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;Cupbord&quot;. <span class="bw bx"><abbr class="by">8 April</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1776113399274759&amp;seennotification=1460073449555217&amp;gfid=AQAboRSyDIC2Pv9b&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1776113399274759&amp;seennotification=1460073449555217&amp;gfid=AQAboRSyDIC2Pv9b&amp;refid=48"><div><span class="blueName">Jesse Wilson</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;Pallet Furniture / Planter Boxes&quot;. <span class="bw bx"><abbr class="by">8 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">7 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1775964105956355&amp;seennotification=1460031941721982&amp;gfid=AQAG9aRydfls5GwS&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1775964105956355&amp;seennotification=1460031941721982&amp;gfid=AQAG9aRydfls5GwS&amp;refid=48"><div><span class="blueName">Shane Hetebry</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;ford falcon&quot;. <span class="bw bx"><abbr class="by">7 April</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">6 April</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1775674925985273&amp;seennotification=1459942606794842&amp;gfid=AQAMOIdGlYJ2FhsX&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1775674925985273&amp;seennotification=1459942606794842&amp;gfid=AQAMOIdGlYJ2FhsX&amp;refid=48"><div><span class="blueName">Kieran Cherrie</span>posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;Backyard blitz&quot;. <span class="bw bx"><abbr class="by">6 April</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1775609532658479&amp;seennotification=1459929643768169&amp;gfid=AQCPYkKWsRTBJcO6&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y2/r/yOUyZI9bori.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1667167856835981%3Fmulti_permalinks%3D1775609532658479&amp;seennotification=1459929643768169&amp;gfid=AQCPYkKWsRTBJcO6&amp;refid=48"><div><span class="blueName">Mark James</span> posted an item for sale in <span class="blueName">Perth Beer Economy.</span>: &quot;hitachi drills and charger&quot;. <span class="bw bx"><abbr class="by">6 April</abbr></span></div></a></td></tr></tbody></table></div></div><div class="e bz"><a href="/notifications.php?more&amp;target=25&amp;refid=48#lastseen"><span>See more notifications</span></a></div></div></div></div></div></div></div></div></body></html>';

			var expectedData = [{
				id: '1461897991225799',
				message: 'Your profile video is ready to view.',
				rawTimestamp: '2 hours ago',
				creator: '/story.php?story_fbid=1592528147741952&id=100009543463363&seennotification=1461897991225799&gfid=AQD8TA4yn0WrSbOB&refid=48'
			}, {
				id: '1461894630933281',
				message: 'Your video is ready to view. You can now watch it.',
				rawTimestamp: '3 hours ago',
				creator: '/story.php?story_fbid=1592513531076747&id=100009543463363&seennotification=1461894630933281&gfid=AQDoFN7RDg50_hue&refid=48'
			}, {
				id: '1461741400382742',
				message: 'Timothy Nunn added 5 photos in Perth Gamers - Retro Console, Arcade, Pinball & PC - fans, traders & events.',
				rawTimestamp: 'Wednesday at 15:16',
				creator: '/groups/771062152968455?view=permalink&id=1054182981323036&seennotification=1461741400382742&gfid=AQCR4ZE61dADk_dw&refid=48'
			}, {
				id: '1461558018260516',
				message: 'Robin Batra added 3 photos in Perth Beer Economy. on Tuesday.',
				rawTimestamp: 'Wednesday at 12:04',
				creator: '/groups/1667167856835981?multi_permalinks=1784275615125204&seennotification=1461558018260516&gfid=AQBArj1vWk4H2eIN&refid=48'
			}, {
				id: '1461520751559000',
				message: 'Timothy Nunn, Gabriel Harmsen and 2 others posted in Perth Gamers - Retro Console, Arcade, Pinball & PC - fans, traders & events.',
				rawTimestamp: '26 April at 12:24',
				creator: '/groups/771062152968455&seennotification=1461520751559000&gfid=AQCxabfqc8oqSPK1&refid=48'
			}, {
				id: '1461253453600211',
				message: 'Brad King posted in Perth Gamers - Retro Console, Arcade, Pinball & PC - fans, traders & events.',
				rawTimestamp: '21 April',
				creator: '/groups/771062152968455?view=permalink&id=1050262165048451&seennotification=1461253453600211&gfid=AQDIJVTDIZZSbNmf&refid=48'
			}];

			var ignoreMessages = [
				'We have an update about a problem you reported: "Dear Facebook Support\n\nI use the..."',
				'Do you know Dale Wells?',
				'Do you know Ty Mckinnon?'
			];

			var tests = (data) => {

				// Ensure the notifications not of interest are ignored
				ignoreMessages.forEach((message) => {
					data.notifications.filter((notification) => (notification.message === message)).length.should.equal(0);
				})

				// Validate first entries
				for (var i = 0; i < expectedData.length; i++) {
					aid.validate(expectedData[i], data.notifications[i]);
				}

				// Ensure last entry is as expected (ensures all notifications of interest are scraped)
				data.notifications.length.should.equal(23);
				aid.validate({
					id: '1459929643768169',
					message: 'Mark James posted an item for sale in Perth Beer Economy.: "hitachi drills and charger".',
					rawTimestamp: '6 April',
					creator: '/groups/1667167856835981?multi_permalinks=1775609532658479&seennotification=1459929643768169&gfid=AQCPYkKWsRTBJcO6&refid=48'
				},
				data.notifications[22]);
			}
			execute(done, html, tests)
		});

		it('placeholder ...', (done) => {
			let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC \'-//WAPFORUM//DTD XHTML Mobile 1.0//EN\' \'http://www.wapforum.org/DTD/xhtml-mobile10.dtd\'><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Notifications</title></head><body class="b c d e" tabindex="0"><div class="f"><div id="viewport"><div id="objects_container"><div class="bf e" id="root" role="main"><div class="bg"><div class="e" id="notifications_list"><div class="bh" id="notifications_list"><h2 class="bi"><a aria-label="Notification Settings" class="bj bk" href="/settings/notifications/?refid=48" role="button"><img class="bl r bm r" height="20" src="https://static.xx.fbcdn.net/rsrc.php/v2/yl/r/7V5aEi6e-vQ.png" width="20"/></a></h2><div><h5 class="bn bo i">Today</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fbelindasmartin&amp;birthdays=1468015200&amp;sr&amp;gfid=AQCRe34Kzdgw0YaR&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yM/r/sxPsP6mjdTj.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fbelindasmartin&amp;birthdays=1468015200&amp;sr&amp;gfid=AQCRe34Kzdgw0YaR&amp;refid=48">Today is Belinda Martin\'s birthday.</a></td></tr></tbody></table></div><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fevents%2F1612079585787290%2F%3Facontext%3D%257B%2522ref%2522%253A29%252C%2522ref_notif_type%2522%253A%2522event_joined_nearby%2522%252C%2522action_history%2522%253A%2522null%2522%257D&amp;seennotification=1467951665065356&amp;gfid=AQBOF0wXxX4lqbQi&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y-/r/gyxl6u6ebKs.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fevents%2F1612079585787290%2F%3Facontext%3D%257B%2522ref%2522%253A29%252C%2522ref_notif_type%2522%253A%2522event_joined_nearby%2522%252C%2522action_history%2522%253A%2522null%2522%257D&amp;seennotification=1467951665065356&amp;gfid=AQBOF0wXxX4lqbQi&amp;refid=48"><div><span class="blueName">Simon Van Der Schaar</span>is interested in going to an event near you tomorrow. <span class="bx by"><abbr class="bz">11 minutes ago</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D10157247688455389%26id%3D723655388%26comment_id%3D10157248719495389%2310157248719495389&amp;seennotification=1467946504621375&amp;gfid=AQBTZkMPOXm1gaeb&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yz/r/3MQ4u_KHRDo.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D10157247688455389%26id%3D723655388%26comment_id%3D10157248719495389%2310157248719495389&amp;seennotification=1467946504621375&amp;gfid=AQBTZkMPOXm1gaeb&amp;refid=48"><div><span class="blueName">Sally Hastings</span>also commented on <span class="blueName">Shaun Johnston</span>\'s post. <span class="bx by"><abbr class="bz">1 hour ago</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fcomment%2Freplies%2F%3Fctoken%3D1838133733081203_1838418516386058%26ft_ent_identifier%3D1838133733081203%26gfid%3DAQCOwtd_AhsJqcxn&amp;seennotification=1467942848945227&amp;gfid=AQAZGvue2mvY3q45&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yz/r/3MQ4u_KHRDo.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fcomment%2Freplies%2F%3Fctoken%3D1838133733081203_1838418516386058%26ft_ent_identifier%3D1838133733081203%26gfid%3DAQCOwtd_AhsJqcxn&amp;seennotification=1467942848945227&amp;gfid=AQAZGvue2mvY3q45&amp;refid=48"><div><span class="blueName">Bryan Martin</span>replied to your comment on <span class="blueName">Peter Martin</span>\'s link. <span class="bx by"><abbr class="bz">2 hours ago</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fcomment%2Freplies%2F%3Fctoken%3D1199995886698324_1200552563309323%26ft_ent_identifier%3D1199995886698324%26gfid%3DAQBIH12RvZ8n2Xji&amp;seennotification=1467938467686630&amp;gfid=AQB9qWDXO6ufIBVW&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y0/r/P-X7mvy5FNu.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fcomment%2Freplies%2F%3Fctoken%3D1199995886698324_1200552563309323%26ft_ent_identifier%3D1199995886698324%26gfid%3DAQBIH12RvZ8n2Xji&amp;seennotification=1467938467686630&amp;gfid=AQB9qWDXO6ufIBVW&amp;refid=48"><div><span class="blueName">Laura Catherine</span>replied to your comment on a post in <span class="blueName">Parkerville-Gidgegannup and Beyond; buy, sell, swap and free</span>. <span class="bx by"><abbr class="bz">3 hours ago</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">July 6</h5><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F301271729984280%3Fmulti_permalinks%3D938514889593291&amp;seennotification=1467791192703984&amp;gfid=AQBdZFiEmtieRDsx&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yR/r/pO1aez3fL0j.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F301271729984280%3Fmulti_permalinks%3D938514889593291&amp;seennotification=1467791192703984&amp;gfid=AQBdZFiEmtieRDsx&amp;refid=48"><div><span class="blueName">Penny Henry</span>posted an item for sale in <span class="blueName">Perth hills livestock and pets</span>: &quot;Pet transport crate&quot;. <span class="bx by"><abbr class="bz">Wednesday at 3:46pm</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D299509650386859%26id%3D100009834785112&amp;seennotification=1467788687116251&amp;gfid=AQCbMQ4hFUv7I5WF&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yf/r/1rDpclrMj9x.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D299509650386859%26id%3D100009834785112&amp;seennotification=1467788687116251&amp;gfid=AQCbMQ4hFUv7I5WF&amp;refid=48"><div><span class="blueName">Ian Matthew Bassett</span>likes a link you shared. <span class="bx by"><abbr class="bz">Wednesday at 3:04pm</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">July 5</h5><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F412252208822528%3Fmulti_permalinks%3D1042349792479430&amp;seennotification=1467732764598916&amp;gfid=AQBvSUpHc_tpN1YL&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yc/r/69DV5j-aWcD.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F412252208822528%3Fmulti_permalinks%3D1042349792479430&amp;seennotification=1467732764598916&amp;gfid=AQBvSUpHc_tpN1YL&amp;refid=48"><div><span class="blueName">Julie McClements</span>posted an item for sale in <span class="blueName">Mundaring/ Stoneville/ Mt Helena stuff for sale</span>: &quot;Rossi Motorbike Boots&quot;. <span class="bx by"><abbr class="bz">Tuesday at 11:32pm</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D1733362540250328%26id%3D100007297956506%26comment_id%3D1733464136906835%231733464136906835&amp;seennotification=1467628918654464&amp;gfid=AQBxt3ozSOjVP3Ge&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yz/r/3MQ4u_KHRDo.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D1733362540250328%26id%3D100007297956506%26comment_id%3D1733464136906835%231733464136906835&amp;seennotification=1467628918654464&amp;gfid=AQBxt3ozSOjVP3Ge&amp;refid=48"><div><span class="blueName">Inge de Jong</span>and <span class="blueName">Lorraine Hull</span>also commented on <span class="blueName">Diem Scantlebury</span>\'s photo. <span class="bx by"><abbr class="bz">Jul 5 at 12:05am</abbr></span></div></a></td></tr></tbody></table></div></div><div><h5 class="bn bo i">July 4</h5><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fgroups%2F1172970366061944%3Fmulti_permalinks%3D1481396125219365&amp;seennotification=1467647914888210&amp;gfid=AQAeyj8_myhIt9Vt&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yX/r/_rw-ATsdusP.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fgroups%2F1172970366061944%3Fmulti_permalinks%3D1481396125219365&amp;seennotification=1467647914888210&amp;gfid=AQAeyj8_myhIt9Vt&amp;refid=48"><div><span class="blueName">Kydyn Wraight</span>posted in <span class="blueName">Perth Alcohol Economy (using alcohol as currency to trade)</span>on Sunday: &quot;have you got any old electronic games for booze? ...&quot;. <span class="bx by"><abbr class="bz">Jul 4 at 11:58pm</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D10153782483157183%26id%3D631187182%26comment_id%3D10153782707737183%2310153782707737183&amp;seennotification=1467629955304004&amp;gfid=AQCTTezF1JUVFDYe&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yz/r/3MQ4u_KHRDo.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fstory.php%3Fstory_fbid%3D10153782483157183%26id%3D631187182%26comment_id%3D10153782707737183%2310153782707737183&amp;seennotification=1467629955304004&amp;gfid=AQCTTezF1JUVFDYe&amp;refid=48"><div><span class="blueName">Franko Šeman</span>and <span class="blueName">Ben Mullings</span>also commented on <span class="blueName">Ben Mullings</span>\'s link. <span class="bx by"><abbr class="bz">Jul 4 at 9:14pm</abbr></span></div></a></td></tr></tbody></table></div><div class="bp bw br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fcomment%2Freplies%2F%3Fctoken%3D10153782483157183_10153782507897183%26ft_ent_identifier%3D10153782483157183%26gfid%3DAQBf5IeXUpKuZq3Z&amp;seennotification=1467629928188163&amp;gfid=AQD61L1Zf5NhQScA&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yz/r/3MQ4u_KHRDo.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fcomment%2Freplies%2F%3Fctoken%3D10153782483157183_10153782507897183%26ft_ent_identifier%3D10153782483157183%26gfid%3DAQBf5IeXUpKuZq3Z&amp;seennotification=1467629928188163&amp;gfid=AQD61L1Zf5NhQScA&amp;refid=48"><div><span class="blueName">Ben Mullings</span>and <span class="blueName">Franko Šeman</span>replied to your comment on <span class="blueName">Ben Mullings</span>\'s link. <span class="bx by"><abbr class="bz">Jul 4 at 8:46pm</abbr></span></div></a></td></tr></tbody></table></div></div><div class="e ca"><a href="/notifications.php?more&amp;target=30&amp;refid=48#lastseen"><span>See more notifications</span></a></div></div></div></div></div></div><div class="cb"><div class="cj ck"><a class="cx" href="#header">Back To Top</a></div></div></div></div></body></html>';
			let tests = (data) => data.notifications[0].rawTimestamp.should.equal('Today');

			execute(done, html, tests);
		});
		
		it('ensure redirected urls are fully parsed...', (done) => {
			let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC \'-//WAPFORUM//DTD XHTML Mobile 1.0//EN\' \'http://www.wapforum.org/DTD/xhtml-mobile10.dtd\'><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Notifications</title></head><body class="b c d e" tabindex="0"><div class="f"><div id="viewport"><div id="objects_container"><div class="bf e" id="root" role="main"><div class="bg"><div class="e" id="notifications_list"><div class="bh" id="notifications_list"><h2 class="bi"><a aria-label="Notification Settings" class="bj bk" href="/settings/notifications/?refid=48" role="button"><img class="bl r bm r" height="20" src="https://static.xx.fbcdn.net/rsrc.php/v2/yl/r/7V5aEi6e-vQ.png" width="20"/></a></h2><div><h5 class="bn bo i">Today</h5><div class="bp bq br"><table class="l"><tbody><tr><td class="v m"><a class="bs" href="/a/notifications.php?redir=%2Fbelindasmartin&amp;birthdays=1468015200&amp;sr&amp;gfid=AQCRe34Kzdgw0YaR&amp;refid=48"><div class="bt"><img class="r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yM/r/sxPsP6mjdTj.png" width="16"/></div></a></td><td class="v s bu"><a class="bv" href="/a/notifications.php?redir=%2Fbelindasmartin&amp;birthdays=1468015200&amp;sr&amp;gfid=AQCRe34Kzdgw0YaR&amp;refid=48">Today is Belinda Martin\'s birthday.</a></td></tr></tbody></table></div></div><div class="e ca"><a href="/notifications.php?more&amp;target=30&amp;refid=48#lastseen"><span>See more notifications</span></a></div></div></div></div></div></div><div class="cb"><div class="cc"><div class="cd"><table class="l"><tbody><tr><td class="s ce" style="width:50%"><b class="cf">English (US)</b><a class="cg" href="/a/language.php?l=zh_CN&amp;lref=https%3A%2F%2Fm.facebook.com%2Fnotifications.php&amp;index=2&amp;gfid=AQC-45-dMjaX3cfQ&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">中文(简体)</a><a class="cg" href="/a/language.php?l=es_LA&amp;lref=https%3A%2F%2Fm.facebook.com%2Fnotifications.php&amp;index=4&amp;gfid=AQCBX6SXawkradL5&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">Español</a></td><td class="s ch" style="width:50%"><a class="cg" href="/a/language.php?l=pt_BR&amp;lref=https%3A%2F%2Fm.facebook.com%2Fnotifications.php&amp;index=1&amp;gfid=AQCr0Z1VD2xmcNZD&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">Português (Brasil)</a><a class="cg" href="/a/language.php?l=ko_KR&amp;lref=https%3A%2F%2Fm.facebook.com%2Fnotifications.php&amp;index=3&amp;gfid=AQC6fTpslC2We_8-&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">한국어</a><a class="cg" href="/language.php?n=https%3A%2F%2Fm.facebook.com%2Fnotifications.php&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48"><div class="ci">+ </div></a></td></tr></tbody></table></div></div><div class="cj ck"><a class="cx" href="#header">Back To Top</a></div></div></div></div></body></html>';
			let tests = (data) => data.notifications[0].creator.should.equal('/belindasmartin&birthdays=1468015200&sr&gfid=AQCRe34Kzdgw0YaR&refid=48');

			execute(done, html, tests);
		});

		it('ensure that no notification pages are handled gracefully...', (done) => {
			let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Notifications</title></head><body class="b c d e" tabindex="0"><div class="f"><div id="viewport"><div class="g"><div class="h i" id="header"><form action="/search/" class="j k" method="get"><input name="refid" type="hidden" value="48"/><input name="search" type="hidden" value="Search"/><input name="search_source" type="hidden" value="top_nav"/><table class="l"><tbody><tr><td class="m"><a class="n o p" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=MNotificationsController&amp;refid=48"><img alt="Facebook logo" class="q r" height="20" src="https://fbstatic-a.akamaihd.net/rsrc.php/v3/y-/r/AzJ1vI_Eq_B.png" width="20"/></a></td><td class="s t"><input autocomplete="off" autocorrect="off" class="u v w" name="query" placeholder="Search Facebook" spellcheck="false" type="text"/></td><td class="m"><input class="x y z ba" type="submit" value="Search"/></td></tr></tbody></table></form><div class="bb"><a accesskey="1" aria-label="Home" class="bc bd" href="/home.php?a_type=sr&amp;ref_component=mbasic_home_header&amp;ref_page=MNotificationsController&amp;refid=48" style="display:block;height:0;overflow:hidden;position:absolute;width:0;padding:0"/><a aria-hidden="1" class="bc bd" href="/home.php?ref_component=mbasic_home_header&amp;ref_page=MNotificationsController&amp;refid=48" tabindex="-1">Home</a><a class="bc bd" href="/bishwa.subba.52?v=info&amp;ref_component=mbasic_home_header&amp;ref_page=MNotificationsController&amp;refid=48">Edit Profile</a><a accesskey="2" class="bc bd" href="/friends/center/mbasic/?fb_ref=tn&amp;sr=1&amp;ref_component=mbasic_home_header&amp;ref_page=MNotificationsController&amp;refid=48">Find Friends(2)</a><a accesskey="4" class="bc bd" href="/messages/read/?tid=mid.1476129219872%3Aff1f900ea02fb96b06&amp;ref_component=mbasic_home_header&amp;ref_page=MNotificationsController&amp;refid=48#fua"><strong class="be">Messages(1)</strong></a><a accesskey="3" class="bc bf bd" href="/notifications.php?ref_component=mbasic_home_header&amp;ref_page=MNotificationsController&amp;refid=48">Notifications</a><a accesskey="6" class="bc bd" href="/buddylist.php?ref_component=mbasic_home_header&amp;ref_page=MNotificationsController&amp;refid=48">Chat</a><a accesskey="5" class="bc bd" href="/menu/bookmarks/?ref_component=mbasic_home_header&amp;ref_page=MNotificationsController&amp;refid=48">Menu</a></div></div></div><div id="objects_container"><div class="bg e" id="root" role="main"><div class="bh"><div class="bi"><div class="bj e bk"><a href="/sms/activation.php?refid=48"><span>Receive your notifications via SMS</span></a></div></div><div class="e bk" id="notifications_list">You have no new notifications.</div></div><div/></div></div><div class="bl"><div class="bm"><div class="bn"><table class="l"><tbody><tr><td class="s bo" style="width:50%"><b class="bp">English (UK)</b><a class="bq" href="/a/language.php?l=hi_IN&amp;lref=https%3A%2F%2Fmbasic.facebook.com%2Fnotifications.php&amp;index=2&amp;gfid=AQABkzNqXeXX874g&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">हिन्दी</a><a class="bq" href="/a/language.php?l=ur_PK&amp;lref=https%3A%2F%2Fmbasic.facebook.com%2Fnotifications.php&amp;index=4&amp;gfid=AQBCSS6nq6Rv5OQU&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">اردو</a></td><td class="s br" style="width:50%"><a class="bq" href="/a/language.php?l=en_US&amp;lref=https%3A%2F%2Fmbasic.facebook.com%2Fnotifications.php&amp;index=1&amp;gfid=AQAUZwthRNKDMtYv&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">English (US)</a><a class="bq" href="/a/language.php?l=pa_IN&amp;lref=https%3A%2F%2Fmbasic.facebook.com%2Fnotifications.php&amp;index=3&amp;gfid=AQCPQxHl3GDqDAUv&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">ਪੰਜਾਬੀ</a><a class="bq" href="/language.php?n=https%3A%2F%2Fmbasic.facebook.com%2Fnotifications.php&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48"><div class="bs">+ </div></a></td></tr></tbody></table></div></div><div class="bt bu"><div id="search_div"><form action="/search/" method="get"><input name="refid" type="hidden" value="48"/><input name="search" type="hidden"/><input name="search_source" type="hidden" value="footer"/><div class="bv bw"><table class="l bx by"><tbody><tr><td class="m bz ca"><label for="u_0_0"><img class="cb r" height="20" src="https://fbstatic-a.akamaihd.net/rsrc.php/v3/y3/r/u_RuO0EnWYS.png" width="20"/></label></td><td class="s cc ca"><input class="u cd ce cf" id="u_0_0" name="query" type="text"/></td><td class="m cg ca"><input class="x y ch ba" type="submit" value="Search"/></td></tr></tbody></table></div></form></div><table class="l"><tbody><tr><td class="s bo" style="width:50%"><a class="bq" href="/pages/create/?ref_type=site_footer&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">Create Page</a><a accesskey="0" class="bq" href="/help/?ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">Help</a><a accesskey="7" class="bq" href="/settings/?ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">Settings &amp; Privacy</a></td><td class="s br" style="width:50%"><a class="bq" href="/bugnub/?source=Footer&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">Report a Problem</a><a accesskey="8" class="bq" href="/policies/?ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">Terms &amp; Policies</a><a class="bq" href="/logout.php?h=Afco3lcwfxq1SpUX&amp;t=1477896083&amp;ref_component=mbasic_footer&amp;ref_page=MNotificationsController&amp;refid=48">Log Out (Bishwa Subba)</a></td></tr></tbody></table><a class="ci" href="#header">Back to Top</a></div></div></div></div></body></html>';

			execute(done, html, (data) => data.notifications.length.should.equal(0));
		});

		it('ensure that failed login requests are handled gracefully...', (done) => {
			let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Welcome to Facebook</title></head><body class="b c d e f" tabindex="0"><div class="g"><div id="viewport"><div id="objects_container"><div class="s f" id="root" role="main"><table class="t"><tbody><tr><td class="u"><div id="login-notices"><div class="v w x" style="display: none;"><div class="y"/></div><div class="z i ba"><span class="bb">You must log in first.</span></div></div><div><div class="bc bd"><div/><form action="https://mbasic.facebook.com/login.php?next=https%3A%2F%2Fmbasic.facebook.com%2Fnotifications.php&amp;refsrc=https%3A%2F%2Fmbasic.facebook.com%2Fnotifications.php&amp;lwv=100&amp;login_try_number=1&amp;refid=9" class="be" id="login_form" method="post" novalidate="1"><input autocomplete="off" name="lsd" type="hidden" value="AVrPuti4"/><input name="charset_test" type="hidden" value="€,´,€,´,水,Д,Є"/><input name="version" type="hidden" value="1"/><input id="ajax" name="ajax" type="hidden" value="0"/><input id="width" name="width" type="hidden" value="0"/><input id="pxr" name="pxr" type="hidden" value="0"/><input id="gps" name="gps" type="hidden" value="0"/><input id="dimensions" name="dimensions" type="hidden" value="0"/><input name="m_ts" type="hidden" value="1477862830"/><input name="li" type="hidden" value="rmUWWIkX62CJQZVf4nCBXWIv"/><ul class="bf bg bh"><li class="bg"><h3 class="bi bj bk">Email or Phone</h3><input autocapitalize="off" autocorrect="off" class="bl bm bn" name="email" type="text" value=""/></li><li class="bg"><div><h3 class="bi bj bk">Password</h3><input autocapitalize="off" autocorrect="off" class="bl bm bo bp" name="pass" type="password"/></div></li><li class="bg"><input class="m n bq br bs" name="login" type="submit" value="Log In"/></li></ul><noscript><input name="_fb_noscript" type="hidden" value="true"/></noscript></form><div class="bt bu"><div class="bt bv" id="signup-button"><a class="m n bw" href="/reg/?cid=103&amp;refid=9" style="           background-color:#69a74e;           color:white;           height:44px;"><span class="q">Create New Account</span></a></div></div><div class="bx by"><span class="bz ca"><ul class="bf cb"><li class="bg"><a href="/recover/initiate/?c=https%3A%2F%2Fmbasic.facebook.com%2Flogin.php%3Fnext%3Dhttps%253A%252F%252Fmbasic.facebook.com%252Fnotifications.php%26refsrc%3Dhttps%253A%252F%252Fmbasic.facebook.com%252Fnotifications.php&amp;lwv=100&amp;refid=9" id="forgot-password-link">Forgot Password?</a></li><li class="bg"><a href="/help/?refid=9" id="help-link">Help Center</a></li></ul></span></div></div></div></td></tr></tbody></table><div/></div></div></div></div></body></html>';

			execute(done, html, (data) => data.notifications.length.should.equal(0));
		});

		it('ensure that "do you know" posts are ignored...', (done) => {
			let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Notifications</title></head><body class="nontouch x2 _513c acw" tabindex="0"><div class="mfsm"><div id="viewport"><div id="objects_container"><div class="acw" id="root"><div class="_m-w"><div class="acw" id="notifications_list"><div class="_55x2" id="notifications_list"><h2 class="_vqv"><a class="button touchable" href="/settings/notifications/?refid=48"><img class="_5r0v img _4q9b img" height="20" src="https://static.xx.fbcdn.net/rsrc.php/v3/yf/r/LO2UtbcweDv.png" width="20"/></a></h2><div><h5 class="al _m-x aps">2 January</h5><div class="_5n90 _1buw _p9p"><table class="_4g33"><tbody><tr><td class="_55wq _5s61"><a class="_1p53" href="/a/notifications.php?redir=%2Fsteph.mcgrath.96&amp;seennotification=1483363284802044&amp;gfid=AQDdB7j6X2LU5pc3&amp;refid=48"><div class="_qsh"><img class="img" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/yp/r/FYzDg0PZ-oQ.png" width="16"/></div></a></td><td class="_55wq _4g34 _3166"><a class="_5n99" href="/a/notifications.php?redir=%2Fsteph.mcgrath.96&amp;seennotification=1483363284802044&amp;gfid=AQDdB7j6X2LU5pc3&amp;refid=48"><div>Teest, do you know Steph Mac? <span class="mfss fcg"><abbr class="_30dc">Monday at 21:21</abbr></span></div></a></td></tr></tbody></table></div></div></div></div></div><div/></div></div></div></body></html>';
			execute(done, html, (data) => data.notifications.length.should.equal(0));
		});
	});
});