import {FacebookAddPhotoHandler} from '../../src/facebook/FacebookAddPhotoHandler.es6';
import {TestAid} from '../env/testAid.es6';

let htmlparser = require('htmlparser2')

let aid = new TestAid();
let subject = null;

var execute = (html) => {
	var parser = new htmlparser.Parser(subject, {
		recognizeSelfClosing: true
	});
	parser.write(html);
	parser.done();
}

var doTest = (done, html, expectedPost) => {
	subject = new FacebookAddPhotoHandler((error, data) => {
		// Validate the data
		aid.validate(expectedPost, data.upload);
		// Successful
		done();
	})
	execute(html);
}

describe('FacebookAddPhotoHandler', () => {

	it('test upload form is scraped correctly...', (done) => {
		let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Add Photos</title></head><body class="b c d e f" tabindex="0"><div class="g"><div id="viewport"><div id="toggleHeader"/><div class="h i j" id="header"><table class="k l"><tbody><tr><td class="m"><a class="n o p" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=XComposerMBasicController"><img alt="Facebook logo" class="q r" height="14" src="https://static.xx.fbcdn.net/rsrc.php/v2/yR/r/aOwaKgucSnh.png" width="14"/></a></td><td class="s"><table class="k l t"><tbody><tr><td class="s"><h1 class="u v">Add Photos</h1></td></tr></tbody></table></td><td class="m"><a class="w x" href="/composer/mbasic/?csid=f3fc12bd-2d00-48bb-815d-e09a0e46304c&amp;cwevent=cancel_media&amp;av=100009834785112&amp;view_overview">Cancel</a></td></tr></tbody></table></div><div id="objects_container"><div class="y f" id="root" role="main"><table class="k"><tbody><tr><td class="z s"><form action="/composer/mbasic/?csid=f3fc12bd-2d00-48bb-815d-e09a0e46304c&amp;av=100009834785112&amp;view_overview" enctype="multipart/form-data" method="post"><input autocomplete="off" name="fb_dtsg" type="hidden" value="AQFQ7hNcuHL3:AQGB3k9g7Yb2"/><input name="charset_test" type="hidden" value="€,´,€,´,水,Д,Є"/><div class="ba" style="display:none"><span/><a class="bb"><img alt="Remove Video" class="bc r" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y6/r/14K7MNDgn50.png" width="16"/></a></div><div class="bd"><input accept="image/*" class="be bf" name="file1" type="file"/></div><div class="bd"><input class="bg bh bi bj" name="add_photo_done" type="submit" value="Preview"/><div class="bk bl"><span class="bm bn">Photo Filters</span><fieldset class="bo"><label class="bp bq"><div class="br"><table class="k l"><tbody><tr><td class="m"><input checked="1" name="filter_type" type="radio" value="5"/></td><td class="m bs"><img class="bt bu r" height="24" src="https://static.xx.fbcdn.net/rsrc.php/v2/y3/r/dd5jFhvKsDk.png" width="24"/></td><td class="s"><span class="bm">Enhance</span></td></tr></tbody></table></div></label><label class="bp bq"><div class="br"><table class="k l"><tbody><tr><td class="m"><input name="filter_type" type="radio" value="2"/></td><td class="m bs"><img class="bt bu r" height="24" src="https://static.xx.fbcdn.net/rsrc.php/v2/yN/r/RuIAWv_2_EQ.png" width="24"/></td><td class="s"><span class="bm">Black and White</span></td></tr></tbody></table></div></label><label class="bp bq"><div class="br"><table class="k l"><tbody><tr><td class="m"><input name="filter_type" type="radio" value="6"/></td><td class="m bs"><img class="bt bu r" height="24" src="https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/Bsqim273Qdm.png" width="24"/></td><td class="s"><span class="bm">Retro</span></td></tr></tbody></table></div></label><label class="bp bq"><div class="br"><table class="k l"><tbody><tr><td class="m"><input name="filter_type" type="radio" value="0"/></td><td class="m bs"><img class="bt bu r" height="24" src="https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/a2uH0dITkCD.png" width="24"/></td><td class="s"><span class="bm">No Filter</span></td></tr></tbody></table></div></label></fieldset></div><input name="target_id" type="hidden" value="100009834785112"/><input name="waterfall_source" type="hidden" value="composer_feed"/><input name="waterfall_id" type="hidden" value="f3fc12bd-2d00-48bb-815d-e09a0e46304c"/><input name="waterfall_app_name" type="hidden" value="web_m_basic"/></div></form></td></tr></tbody></table></div></div></div></div></body></html>';
		let expected = {
			charset_test: '€,´,€,´,水,Д,Є',
			csid: 'f3fc12bd-2d00-48bb-815d-e09a0e46304c',
			fb_dtsg: 'AQFQ7hNcuHL3:AQGB3k9g7Yb2'
		};

		doTest(done, html, expected);
	});
	
	it('test complete form no photo is scraped correctly...', (done) => {
	    let html = '<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Update Status</title><meta name="referrer" content="default" id="meta_referrer" /><style type="text/css">/*<![CDATA[*/.b .k{border:0;border-collapse:collapse;margin:0;padding:0;width:100%;}.b .k.by{width:auto;}.b .k tbody{vertical-align:top;}.b .l>tr>td,.b .l>tbody>tr>td,.b .k td.l{vertical-align:middle;}.b .k td{padding:0;}.b .k td.bz{padding:2px;}.b .k td.bb{padding:4px;}.b .s{width:100%;}.z{background:#fff;}.f{background:#e9ebee;}.b .bz{padding:2px;}.b .bb{padding:4px;}form{margin:0;border:0;}.bc{display:block;display:flex;max-width:100%;overflow:hidden;white-space:nowrap;}.bd{color:#4b4f56;font-size:12px;line-height:20px;white-space:nowrap;}.bh{line-height:20px;overflow:hidden;}.bh>input{max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}.be{background-color:#fff;border:0;display:inline-block;height:26px;line-height:26px;margin:0;padding-right:16px;position:relative;vertical-align:top;white-space:nowrap;}.be input,.be button{color:#3b5998;}.be a:hover{color:#fff;}.be.bf,.bk.bf{height:20px;line-height:20px;}.bk{-webkit-appearance:none;background-color:#fff;border:none;color:#4b4f56;display:inline-block;font-size:12px;height:26px;min-width:100%;padding:0;vertical-align:top;}.be a.bk{color:#4b4f56;}.bl{background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/y7/r/Gm9JuAvZCI7.png);background-position:right center;background-repeat:no-repeat;bottom:0;display:block;pointer-events:none;position:absolute;right:0;top:0;width:16px;}.bj{text-align:left;}.bo{background:#fff;}.bm .bu{background-color:transparent;color:#4b4f56;display:block;padding:0;width:100%;}.bp .r{display:block;}.bm .bn .bp{padding:4px;}.b .bm .bn{border:1px solid #90949c;}.bq{background:#eceff5;}.bs{-webkit-appearance:none;border:0;margin:0;padding:0;}.bv{margin-bottom:4px;margin-top:4px;}.bw.bw{display:block;}.bx{display:inline-block;}.bx .ce{display:block;font-size:small;white-space:normal;}.ca,.cb.r{cursor:pointer;display:block;}.b .cb{padding:2px;}.b .bx a.ce,.bx .ce{color:#4b4f56;font-weight:bold;text-align:left;}.b .bx a.ce:hover,.b .bx a.ce:focus,.bx .ce:hover,.bx .ce:focus{background:#4b4f56;color:#fff;}.b .bx a.ca:hover,.b .bx a.ca:focus,.bx .ca:hover,.bx .ca:focus{background:inherit;}.r{border:0;display:inline-block;vertical-align:top;}i.r u{position:absolute;width:0;height:0;overflow:hidden;}.cd{-webkit-appearance:none;background-color:transparent;border:0;display:inline;font-size:inherit;margin:0;padding:0;}.cd:hover{background-color:#3b5998;color:#fff;white-space:normal;}.cf{color:#3b5998;}.cg{-webkit-appearance:none;background:none;display:inline-block;font-size:12px;height:28px;line-height:28px;margin:0;overflow:visible;padding:0 9px;text-align:center;vertical-align:top;white-space:nowrap;}.b .cg{border-radius:2px;}.ci,a.ci,html .b a.ci{color:#fff;}.b .ci{background-color:#4267b2;border:1px solid #365899;}.b a.ci:hover,.b .ci:hover{background-color:#465e91;}.ci[disabled]{color:#899bc1;}.b .ci[disabled]:hover{background-color:#4267b2;}.b a.cg::after{content:"";display:inline-block;height:100%;vertical-align:middle;}.cg.ch{display:block;width:100%;}a.cg.ch,.b label.cg.ch{display:block;width:auto;}.b .cg{padding:0 8px;}.b a.cg{height:26px;line-height:26px;}body{text-align:left;direction:ltr;}body,tr,input,textarea,button{font-family:sans-serif;}body,p,figure,h1,h2,h3,h4,h5,h6,ul,ol,li,dl,dd,dt{margin:0;padding:0;}h1,h2,h3,h4,h5,h6{font-size:1em;font-weight:bold;}ul,ol{list-style:none;}article,aside,figcaption,figure,footer,header,nav,section{display:block;}.d #viewport{margin:0 auto;max-width:600px;}#page{position:relative;}.h{background-color:#3b5998;color:#fff;}.h .p{padding:6px;}.h .u.u{font-size:small;font-weight:normal;}.x{background-position:center center;background-repeat:no-repeat;display:block;font-size:small;height:12px;margin:2px;padding:5px;white-space:nowrap;width:12px;}.x:hover{background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yU/r/8hVZmswHyRB.png);}.x{background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yJ/r/CMXwnKcwXks.png);}.i .x,.i .x:hover{background-image:none;height:auto;width:auto;}.p{display:block;padding:5px;}.j .t{table-layout:fixed;width:100%;}.q,.q.r{display:block;}.n{display:block;}.o{height:14px;width:14px;}.b a,.b a:visited{color:#3b5998;text-decoration:none;}.b .w,.b .w:visited{color:#fff;}.b a:focus,.b a:hover{background-color:#3b5998;color:#fff;}.b .w:focus,.b .w:hover{background-color:#fff;color:#3b5998;}.v{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}body,tr,input,textarea,.g{font-size:medium;}/*]]>*/</style><link rel="manifest" href="/data/manifest/" crossorigin="use-credentials" /></head><body tabindex="0" class="b c d e f"><div class="g"><div id="viewport"><div class="h i j" id="header"><table class="k l"><tbody><tr><td class="m"><a class="n o p" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=XComposerMBasicController"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yR/r/aOwaKgucSnh.png" width="14" height="14" class="q r" alt="Facebook logo" /></a></td><td class="s"><table class="k l t"><tbody><tr><td class="s"><h1 class="u v">Update Status</h1></td></tr></tbody></table></td><td class="m"><a class="w x" href="/composer/mbasic/?csid=d409daa6-c487-465f-8e22-710f7aed8d98&amp;av=100009543463363&amp;discard&amp;view_overview">Cancel</a></td></tr></tbody></table></div><div id="objects_container"><div class="y f" id="root" role="main"><table class="k"><tbody><tr><td class="z s ba"><div class="bb"><form method="post" action="/composer/mbasic/?csid=d409daa6-c487-465f-8e22-710f7aed8d98&amp;incparms%5B0%5D=xc_message&amp;av=100009543463363" enctype="multipart/form-data"><input type="hidden" name="fb_dtsg" value="AQEuHlqMObRg:AQGSEwVTvoNp" autocomplete="off" /><input type="hidden" name="charset_test" value="&#x20ac;,&#xb4;,&#x20ac;,&#xb4;,&#x6c34;,&#x414;,&#x404;" /><input type="hidden" name="at" /><input type="hidden" name="target" value="100009543463363" /><input type="hidden" name="csid" value="d409daa6-c487-465f-8e22-710f7aed8d98" /><input type="hidden" name="c_src" value="feed" /><input type="hidden" name="referrer" value="feed" /><input type="hidden" name="ctype" value="advanced" /><input type="hidden" name="cver" value="amber" /><input type="hidden" name="users_with" /><input type="hidden" name="album_id" /><input type="hidden" name="waterfall_source" value="composer_feed" /><input type="hidden" name="privacyx" value="300645083384735" /><input type="hidden" name="appid" value="0" /><div class="bc"><span class="bd">Share with:&nbsp;</span><label class="be bf bg bh"><input value="Public" type="submit" name="view_privacy" class="bi bj bk bf" /><div class="bl"></div></label></div><div class="bm"><table class="k bn bo"><tbody><tr><td class="m bp"><label for="u_0_0"><img src="https://scontent.fper1-1.fna.fbcdn.net/v/t1.0-1/cp0/e15/q65/p32x32/13254024_1602928176701949_8926661900527470375_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=ba195d9a5336fc32b4fae7270bcc37a2&amp;oe=581ACC23" width="32" height="32" class="bq r" alt="Teest Devisd" /></label></td><td class="s br l"><textarea class="bs bt bu" name="xc_message" id="u_0_0" rows="3">test post Aug 2nd 2016, 3:08:00 pm</textarea></td></tr></tbody></table></div><div class="bv"><div class="bw bx"><table class="k by l"><tbody><tr><td class="bz m"><label for="u_0_1" class="ca"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yE/r/Q-U_WZzAqVP.png" width="16" height="16" class="cb cc r" /></label></td><td class="bz m"><input value="Tag Friends" type="submit" name="view_withtag" class="bi cd ce cf" id="u_0_1" /></td></tr></tbody></table></div><div class="bw bx"><table class="k by l"><tbody><tr><td class="bz m"><label for="u_0_2" class="ca"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yW/r/gqS520QVYNv.png" width="16" height="16" class="cb cc r" /></label></td><td class="bz m"><input value="Add Location" type="submit" name="view_location" class="bi cd ce cf" id="u_0_2" /></td></tr></tbody></table></div><div class="bw bx"><table class="k by l"><tbody><tr><td class="bz m"><label for="u_0_3" class="ca"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/ym/r/s_JBnFooj2Z.png" width="16" height="16" class="cb cc r" /></label></td><td class="bz m"><input value="Add Feeling or Activity" type="submit" name="view_minutiae" class="bi cd ce cf" id="u_0_3" /></td></tr></tbody></table></div><div class="bw bx"><table class="k by l"><tbody><tr><td class="bz m"><label for="u_0_4" class="ca"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/y1/r/KIY954HBjri.png" width="16" height="16" class="cb cc r" /></label></td><td class="bz m"><input value="Add Photos" type="submit" name="view_photo" class="bi cd ce cf" id="u_0_4" /></td></tr></tbody></table></div></div><input value="Post" type="submit" name="view_post" class="bi cg ch ci" /></form></div></td></tr></tbody></table></div></div></div></div></body></html>'
	    let expected = {
	         fb_dtsg: 'AQEuHlqMObRg:AQGSEwVTvoNp',
	         charset_test: '&#x20ac;,&#xb4;,&#x20ac;,&#xb4;,&#x6c34;,&#x414;,&#x404;',
	         at: '',
	         target: '100009543463363',
	         csid: 'd409daa6-c487-465f-8e22-710f7aed8d98',
	         c_src: 'feed',
	         referrer: 'feed',
	         ctype: 'advanced',
	         cver: 'amber',
	         users_with: '',
	         album_id: '',
	         waterfall_source: 'composer_feed',
	         privacyx: '300645083384735',
	         appid: '0'
	    }
	    doTest(done, html, expected)
	})

	   it('test complete form with photo is scraped correctly...', (done) => {
	        let html = '<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Update Status</title><meta name="referrer" content="default" id="meta_referrer" /><style type="text/css">/*<![CDATA[*/.b .k{border:0;border-collapse:collapse;margin:0;padding:0;width:100%;}.b .k.bx{width:auto;}.b .k tbody{vertical-align:top;}.b .l>tr>td,.b .l>tbody>tr>td,.b .k td.l{vertical-align:middle;}.b .k td{padding:0;}.b .k td.cg{padding:2px;}.b .k td.bb{padding:4px;}.b .s{width:100%;}.z{background:#fff;}.f{background:#e9ebee;}.b .cg{padding:2px;}.b .bb{padding:4px;}form{margin:0;border:0;}.bc{display:block;display:flex;max-width:100%;overflow:hidden;white-space:nowrap;}.bd{color:#4b4f56;font-size:12px;line-height:20px;white-space:nowrap;}.bh{line-height:20px;overflow:hidden;}.bh>input{max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}.be{background-color:#fff;border:0;display:inline-block;height:26px;line-height:26px;margin:0;padding-right:16px;position:relative;vertical-align:top;white-space:nowrap;}.be input,.be button{color:#3b5998;}.be a:hover{color:#fff;}.be.bf,.bk.bf{height:20px;line-height:20px;}.bk{-webkit-appearance:none;background-color:#fff;border:none;color:#4b4f56;display:inline-block;font-size:12px;height:26px;min-width:100%;padding:0;vertical-align:top;}.be a.bk{color:#4b4f56;}.bl{background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/y7/r/Gm9JuAvZCI7.png);background-position:right center;background-repeat:no-repeat;bottom:0;display:block;pointer-events:none;position:absolute;right:0;top:0;width:16px;}.bj{text-align:left;}.bo{background:#fff;}.bm .bu{background-color:transparent;color:#4b4f56;display:block;padding:0;width:100%;}.bp .r{display:block;}.bm .bn .bp{padding:4px;}.b .bm .bn{border:1px solid #90949c;}.bq{background:#eceff5;}.bs{-webkit-appearance:none;border:0;margin:0;padding:0;}.bv{margin-bottom:4px;margin-top:4px;}.ca{margin-right:4px;}.ce.ce{display:block;}.cf{display:inline-block;}.cf .cl{display:block;font-size:small;white-space:normal;}.ch,.ci.r{cursor:pointer;display:block;}.b .ci{padding:2px;}.b .cf a.cl,.cf .cl{color:#4b4f56;font-weight:bold;text-align:left;}.b .cf a.cl:hover,.b .cf a.cl:focus,.cf .cl:hover,.cf .cl:focus{background:#4b4f56;color:#fff;}.b .cf a.ch:hover,.b .cf a.ch:focus,.cf .ch:hover,.cf .ch:focus{background:inherit;}.r{border:0;display:inline-block;vertical-align:top;}i.r u{position:absolute;width:0;height:0;overflow:hidden;}.ck{-webkit-appearance:none;background-color:transparent;border:0;display:inline;font-size:inherit;margin:0;padding:0;}.ck:hover{background-color:#3b5998;color:#fff;white-space:normal;}.cm{color:#3b5998;}.cn{-webkit-appearance:none;background:none;display:inline-block;font-size:12px;height:28px;line-height:28px;margin:0;overflow:visible;padding:0 9px;text-align:center;vertical-align:top;white-space:nowrap;}.b .cn{border-radius:2px;}.cp,a.cp,html .b a.cp{color:#fff;}.b .cp{background-color:#4267b2;border:1px solid #365899;}.b a.cp:hover,.b .cp:hover{background-color:#465e91;}.cp[disabled]{color:#899bc1;}.b .cp[disabled]:hover{background-color:#4267b2;}.b a.cn::after{content:"";display:inline-block;height:100%;vertical-align:middle;}.cn.co{display:block;width:100%;}a.cn.co,.b label.cn.co{display:block;width:auto;}.b .cn{padding:0 8px;}.b a.cn{height:26px;line-height:26px;}.bw .cc{position:relative;}.bw .cb{border:1px dashed #90949c;color:#90949c;}.bw .cd{cursor:pointer;position:absolute;right:-4px;top:-3px;}body{text-align:left;direction:ltr;}body,tr,input,textarea,button{font-family:sans-serif;}body,p,figure,h1,h2,h3,h4,h5,h6,ul,ol,li,dl,dd,dt{margin:0;padding:0;}h1,h2,h3,h4,h5,h6{font-size:1em;font-weight:bold;}ul,ol{list-style:none;}article,aside,figcaption,figure,footer,header,nav,section{display:block;}.d #viewport{margin:0 auto;max-width:600px;}#page{position:relative;}.h{background-color:#3b5998;color:#fff;}.h .p{padding:6px;}.h .u.u{font-size:small;font-weight:normal;}.x{background-position:center center;background-repeat:no-repeat;display:block;font-size:small;height:12px;margin:2px;padding:5px;white-space:nowrap;width:12px;}.x:hover{background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yU/r/8hVZmswHyRB.png);}.x{background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yJ/r/CMXwnKcwXks.png);}.i .x,.i .x:hover{background-image:none;height:auto;width:auto;}.p{display:block;padding:5px;}.j .t{table-layout:fixed;width:100%;}.q,.q.r{display:block;}.n{display:block;}.o{height:14px;width:14px;}.b a,.b a:visited{color:#3b5998;text-decoration:none;}.b .w,.b .w:visited{color:#fff;}.b a:focus,.b a:hover{background-color:#3b5998;color:#fff;}.b .w:focus,.b .w:hover{background-color:#fff;color:#3b5998;}.v{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}body,tr,input,textarea,.g{font-size:medium;}/*]]>*/</style><link rel="manifest" href="/data/manifest/" crossorigin="use-credentials" /></head><body tabindex="0" class="b c d e f"><div class="g"><div id="viewport"><div class="h i j" id="header"><table class="k l"><tbody><tr><td class="m"><a class="n o p" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=XComposerMBasicController"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yR/r/aOwaKgucSnh.png" width="14" height="14" class="q r" alt="Facebook logo" /></a></td><td class="s"><table class="k l t"><tbody><tr><td class="s"><h1 class="u v">Update Status</h1></td></tr></tbody></table></td><td class="m"><a class="w x" href="/composer/mbasic/?csid=55626ccb-3768-4a83-a76f-5af1c99c3b0d&amp;av=100009543463363&amp;discard&amp;view_overview">Cancel</a></td></tr></tbody></table></div><div id="objects_container"><div class="y f" id="root" role="main"><table class="k"><tbody><tr><td class="z s ba"><div class="bb"><form method="post" action="/composer/mbasic/?csid=55626ccb-3768-4a83-a76f-5af1c99c3b0d&amp;incparms%5B0%5D=xc_message&amp;av=100009543463363" enctype="multipart/form-data"><input type="hidden" name="fb_dtsg" value="AQFFk0apmvaX:AQEoTn9OHwel" autocomplete="off" /><input type="hidden" name="charset_test" value="&#x20ac;,&#xb4;,&#x20ac;,&#xb4;,&#x6c34;,&#x414;,&#x404;" /><input type="hidden" name="at" /><input type="hidden" name="target" value="100009543463363" /><input type="hidden" name="csid" value="55626ccb-3768-4a83-a76f-5af1c99c3b0d" /><input type="hidden" name="c_src" value="feed" /><input type="hidden" name="referrer" value="feed" /><input type="hidden" name="ctype" value="advanced" /><input type="hidden" name="cver" value="amber" /><input type="hidden" name="users_with" /><input type="hidden" name="album_id" /><input type="hidden" name="waterfall_source" value="composer_feed" /><input type="hidden" name="privacyx" value="300645083384735" /><input type="hidden" name="appid" value="0" /><input type="hidden" name="photo_ids[]" value="1641642936163806" /><input type="hidden" name="return_uri" value="/home.php?stype=phs&amp;sk=live&amp;gfid=AQA2bksL9JCILqym" /><input type="hidden" name="return_uri_error" value="/composer/mbasic/?csid=55626ccb-3768-4a83-a76f-5af1c99c3b0d&amp;av=100009543463363&amp;view_overview" /><input type="hidden" name="waterfall_id" value="55626ccb-3768-4a83-a76f-5af1c99c3b0d" /><div class="bc"><span class="bd">Share with:&nbsp;</span><label class="be bf bg bh"><input value="Public" type="submit" name="view_privacy" class="bi bj bk bf" /><div class="bl"></div></label></div><div class="bm"><table class="k bn bo"><tbody><tr><td class="m bp"><label for="u_0_0"><img src="https://scontent.fper1-1.fna.fbcdn.net/v/t1.0-1/cp0/e15/q65/p32x32/13254024_1602928176701949_8926661900527470375_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=ba195d9a5336fc32b4fae7270bcc37a2&amp;oe=581ACC23" width="32" height="32" class="bq r" alt="Teest Devisd" /></label></td><td class="s br l"><textarea class="bs bt bu" name="xc_message" id="u_0_0" rows="3">test post Aug 3rd 2016, 9:30:30 am</textarea></td></tr></tbody></table></div><div class="bv"><div class="bw"><table class="k bx by"><tbody><tr><td class="m"><div class="bz ca bv"><input alt="Add Photos" value="Add Photos" class="cb" src="https://static.xx.fbcdn.net/rsrc.php/v2/yb/r/6V3eTUQPZ26.png" type="image" name="view_photo" /></div></td><td class="m"><div class="bz bv"><div class="cc"><img src="https://scontent.fper1-1.fna.fbcdn.net/v/t1.0-0/cp0/e15/q65/c2.0.64.64/p64x64/13886967_1641642936163806_2190028826635481364_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=4096fdaaed9924281045fe1368e8a6a6&amp;oe=58574BFD" width="53" height="53" class="r" /><input type="image" src="https://static.xx.fbcdn.net/rsrc.php/v2/yt/r/mivGmdHDdyW.png" value="x" class="cd" name="remove_photo_overview[1641642936163806]" /></div></div></td></tr></tbody></table></div><div class="ce cf"><table class="k bx l"><tbody><tr><td class="cg m"><label for="u_0_1" class="ch"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yE/r/Q-U_WZzAqVP.png" width="16" height="16" class="ci cj r" /></label></td><td class="cg m"><input value="Tag Friends" type="submit" name="view_withtag" class="bi ck cl cm" id="u_0_1" /></td></tr></tbody></table></div><div class="ce cf"><table class="k bx l"><tbody><tr><td class="cg m"><label for="u_0_2" class="ch"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yW/r/gqS520QVYNv.png" width="16" height="16" class="ci cj r" /></label></td><td class="cg m"><input value="Add Location" type="submit" name="view_location" class="bi ck cl cm" id="u_0_2" /></td></tr></tbody></table></div><div class="ce cf"><table class="k bx l"><tbody><tr><td class="cg m"><label for="u_0_3" class="ch"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/ym/r/s_JBnFooj2Z.png" width="16" height="16" class="ci cj r" /></label></td><td class="cg m"><input value="Add Feeling or Activity" type="submit" name="view_minutiae" class="bi ck cl cm" id="u_0_3" /></td></tr></tbody></table></div><div class="ce cf"><table class="k bx l"><tbody><tr><td class="cg m"><label for="u_0_4" class="ch"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/ya/r/LOEwZiIn0lF.png" width="16" height="16" class="ci cj r" /></label></td><td class="cg m"><input value="Add to Album" type="submit" name="view_album" class="bi ck cl cm" id="u_0_4" /></td></tr></tbody></table></div></div><input value="Post" type="submit" name="view_post" class="bi cn co cp" /></form></div></td></tr></tbody></table></div></div></div></div></body></html>'
	        let expected = {
	             fb_dtsg: 'AQFFk0apmvaX:AQEoTn9OHwel',
	             charset_test: '&#x20ac;,&#xb4;,&#x20ac;,&#xb4;,&#x6c34;,&#x414;,&#x404;',
	             at: '',
	             target: '100009543463363',
	             csid: '55626ccb-3768-4a83-a76f-5af1c99c3b0d',
	             c_src: 'feed',
	             referrer: 'feed',
	             ctype: 'advanced',
	             cver: 'amber',
	             users_with: '',
	             album_id: '',
	             waterfall_source: 'composer_feed',
	             privacyx: '300645083384735',
	             appid: '0',
	             'photo_ids[]': '1641642936163806',
	             return_uri: '/home.php?stype=phs&amp;sk=live&amp;gfid=AQA2bksL9JCILqym',
	             return_uri_error: '/composer/mbasic/?csid=55626ccb-3768-4a83-a76f-5af1c99c3b0d&amp;av=100009543463363&amp;view_overview',
	             waterfall_id: '55626ccb-3768-4a83-a76f-5af1c99c3b0d',
	             xc_message: 'test post Aug 3rd 2016, 9:30:30 am'
	             
	        }
	        doTest(done, html, expected)
	    })

});