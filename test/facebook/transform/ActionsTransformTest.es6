import {Action} from '../../../src/data/action.es6';
import {ActionsTransform} from '../../../src/facebook/transform/ActionsTransform.es6';
import {ScrapeTestAid} from '../../env/facebook/transform/ScrapeTestAid.es6';

let aid = null;
let chai = require('chai');
let subject = null;

chai.should();

describe('ActionsTransform tests', () => {

	beforeEach(() => {
		subject = new ActionsTransform();
		aid = new ScrapeTestAid(subject, 'transform');
	});

	it('parsing post with all actions produces all actions...', (done) => {
		let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Timeline Photos</title></head><body tabindex="0" class="b c d e"><div class="f"><div id="viewport"><div id="toggleHeader"></div><div class="g"><h1 class="h" id="header"><a class="i" href="/home.php?ref_component=mbasic_home_logo&ref_page=%2Fwap%2Fphoto.php"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/y8/r/k97pj8-or6s.png" width="77" height="16" class="j k" alt="facebook" /></a></h1></div><div id="objects_container"><div class="l e" id="root" role="main"><div class="m"><div><div><div class="n"><div style="text-align:center;"><img src="https://scontent.fper1-1.fna.fbcdn.net/v/t1.0-0/cp0/e15/q65/p320x320/13173892_10153984858012224_8340546245935083768_n.jpg?efg=eyJpIjoiYiJ9&oh=91dde1e8d6a4cd2bee9fddee9e8b92d8&oe=57E7122D" width="320" height="320" class="k" /></div></div><div class="n o"><table cellspacing="0" cellpadding="0" class="p"><tr><td valign="top"><a class="q" href="/photo.php?fbid=10153986175047224&id=38862387223&set=a.77124207223.75636.38862387223&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529">Previous</a></td><td valign="top" class="r"><a class="q" href="/photo.php?fbid=10153984854282224&id=38862387223&set=a.77124207223.75636.38862387223&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529">Next</a></td></tr></table></div></div><div><div class="s t u"><table class="v w"><tbody><tr><td class="x y z" style="width:33%"><a class="ba bb bc bd" href="/a/like.php?ul&perm&ifab&ft_ent_identifier=10153984858012224&av=100009834785112&gfid=AQBVAOIm9ehyTTbX&ref_component=mbasic_photo_permalink_actionbar&ref_page=%2Fwap%2Fphoto.php&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yy/r/P2H0Ng8Ff2w.png" width="16" height="16" class="be bf bg k" /><span class="bh">Like</span></a></td><td class="x y z" style="width:33%"><a class="ba bb bc bd" href="#composer-10153984858012224"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/ks_T7R1PM8o.png" width="16" height="16" class="be bf bg k" /><span class="bh">Comment</span></a></td><td class="x y bi z" style="width:33%"><a class="ba bb bc bd" href="/composer/mbasic/?c_src=share&referrer=permalink&target=100009834785112&sid=10153984858012224&m=self&exit_uri=https%3A%2F%2Fmbasic.facebook.com%2FWCEofficial%2Fphotos%2Fa.77124207223.75636.38862387223%2F10153984858012224%2F%3Ftype%3D3%26bacr%3D1462520948%253A1462520948%253A1%253A-4513018467623033529%253A1462449601%253A0%253A0%253A2%26refid%3D7%26_ft_%3Dqid.6281479642555173518%253Amf_story_key.-4513018467623033529&cwevent=composer_entry&av=100009834785112&view_overview&ref_component=mbasic_photo_permalink_actionbar&ref_page=%2Fwap%2Fphoto.php&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/_ByufLrUwa0.png" width="16" height="16" class="be bf bg k" /><span class="bh">Share</span></a></td></tr></tbody></table></div></div><div><div class="bj bk bl bm"><div class="bn"><a class="bo" href="/WCEofficial/?_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529"><strong class="bp">West Coast Eagles</strong></a><br /><div class="bq">True grit.<div id="voice_replace_id" class="br"></div></div></div><div class="bs bt bu"><span class="bv"><div class="bw"><div class="bx bu bv"><abbr>Yesterday at 8:00pm</abbr><span aria-hidden="true"> · </span><span class="by bu">Public</span><span aria-hidden="true"> · </span>in <a href="/WCEofficial/albums/77124207223/?_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529">Timeline Photos</a></div><span class="bx bu bv"><a class="bz" href="https://scontent.fper1-1.fna.fbcdn.net/t31.0-8/fr/cp0/e15/q65/13131189_10153984858012224_8340546245935083768_o.jpg?efg=eyJpIjoiYiJ9">View Full Size</a><span aria-hidden="true"> · </span><a class="bz" href="/tokenizer/single/?mode=share_msg&sid=10153984858012224&returnURI=https%3A%2F%2Fmbasic.facebook.com%2FWCEofficial%2Fphotos%2Fa.77124207223.75636.38862387223%2F10153984858012224%2F%3Ftype%3D3%26bacr%3D1462520948%253A1462520948%253A1%253A-4513018467623033529%253A1462449601%253A0%253A0%253A2%26refid%3D7%26_ft_%3Dqid.6281479642555173518%253Amf_story_key.-4513018467623033529&ref_component=mbasic_photo_permalink&ref_page=%2Fwap%2Fphoto.php&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529">Send as Message</a><span aria-hidden="true"> · </span><a class="bz" href="/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%2210153984858012224%22%2C%22is_impostor%22%3A%22%22%7D&is_direct=1&action_key=RESOLVE_PROBLEM&redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2FWCEofficial%2Fphotos%2Fa.77124207223.75636.38862387223%2F10153984858012224%2F%3Ftype%3D3%26bacr%3D1462520948%253A1462520948%253A1%253A-4513018467623033529%253A1462449601%253A0%253A0%253A2%26refid%3D7%26_ft_%3Dqid.6281479642555173518%253Amf_story_key.-4513018467623033529&ext=1462782503&hash=AeTo65y9vz2Kwa-u&ref_component=mbasic_photo_permalink&ref_page=%2Fwap%2Fphoto.php&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529">Report</a></span></div></span></div></div><div><div class="e ca" id="ufi_10153984858012224"><div class="cb cc"><div class="cd ce cf cg"><a href="/10153984858012224/likes/?cancel_uri=https%3A%2F%2Fmbasic.facebook.com%2FWCEofficial%2Fphotos%2Fa.77124207223.75636.38862387223%2F10153984858012224%2F%3Ftype%3D3%26bacr%3D1462520948%253A1462520948%253A1%253A-4513018467623033529%253A1462449601%253A0%253A0%253A2%26refid%3D7%26_ft_%3Dqid.6281479642555173518%253Amf_story_key.-4513018467623033529&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529">899 people</a> like this.</div><div class="ch ci" id="composer-10153984858012224"><form method="post" action="/a/comment.php?fs=7&actionsource=1&redirectosoftpermalink&comment_logging&ft_ent_identifier=10153984858012224&gfid=AQB6KXyOTd8SyTY4&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529&av=100009834785112"><input type="hidden" name="fb_dtsg" value="AQGpUjhhRAe0:AQGrlUEzeAI2" autocomplete="off" /><input type="hidden" name="charset_test" value="&#x20ac;,&#xb4;,&#x20ac;,&#xb4;,&#x6c34;,&#x414;,&#x404;" /><label class="cj" for="u_0_0">Write a comment...</label><table class="v ck" id="u_0_0"><tbody><tr><td class="x"><div class="cl cm"><table class="v cn co"><tbody><tr><td class="x cp w"><input class="cq cr cs ct" id="composerInput" name="comment_text" type="text" /></td></tr></tbody></table></div></td><td class="cu"><div class="cv"><input value="Comment" type="submit" class="bb cw cx cy" /></div></td></tr></tbody></table><span class="cz bu bv"><a href="/friends/selector/?return_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D10153984858012224%26pap%26at%3Dcompose&cancel_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D10153984858012224%26pap%26at%3Dcompose&friends_key=ids&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529">Mention Friends</a></span></form></div><div id="add_comment_link_placeholder"></div></div></div></div></div></div></div></div></div></div></div></body></html>';
		let expected = [{
				target: '/composer/mbasic/?c_src=share&referrer=permalink&target=100009834785112&sid=10153984858012224&m=self&exit_uri=https%3A%2F%2Fmbasic.facebook.com%2FWCEofficial%2Fphotos%2Fa.77124207223.75636.38862387223%2F10153984858012224%2F%3Ftype%3D3%26bacr%3D1462520948%253A1462520948%253A1%253A-4513018467623033529%253A1462449601%253A0%253A0%253A2%26refid%3D7%26_ft_%3Dqid.6281479642555173518%253Amf_story_key.-4513018467623033529&cwevent=composer_entry&av=100009834785112&view_overview&ref_component=mbasic_photo_permalink_actionbar&ref_page=%2Fwap%2Fphoto.php&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529',
				type: 'Share'
			}, {
				target: '/a/like.php?ul&perm&ifab&ft_ent_identifier=10153984858012224&av=100009834785112&gfid=AQBVAOIm9ehyTTbX&ref_component=mbasic_photo_permalink_actionbar&ref_page=%2Fwap%2Fphoto.php&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529',
				type: 'Like'
			}, {
				target: '/a/comment.php?fs=7&actionsource=1&redirectosoftpermalink&comment_logging&ft_ent_identifier=10153984858012224&gfid=AQB6KXyOTd8SyTY4&_ft_=qid.6281479642555173518%3Amf_story_key.-4513018467623033529&av=100009834785112&fb_dtsg=AQGpUjhhRAe0:AQGrlUEzeAI2&charset_test=€,´,€,´,水,Д,Є',
				type: 'Comment'
			}
		];

		aid.doTest(done, html, expected);
	});

	it('parsing post created by ourself produces delete action...', (done) => {
		let html = '<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Comments</title></head><body tabindex="0" class="b c d e"><div class="f"><div id="viewport"><div id="toggleHeader"></div><div class="g"><h1 class="h" id="header"><a class="i" href="/home.php?ref_component=mbasic_home_logo&ref_page=%2Fwap%2Fstory.php&refid=52"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/y8/r/k97pj8-or6s.png" width="77" height="16" class="j k" alt="facebook" /></a></h1></div><div id="objects_container"><div class="l e" id="root" role="main"><div id="m_story_permalink_view"><div class="m"><div class="n o" id="u_0_2"><div><div><div class="p q"><a class="r" href="/edit/post/dialog/?cid=S%3A_I100009834785112%3A273501259654365&ct=2&nodeID=m_story_permalink_view&redir=%2Fstory.php%3Fstory_fbid%3D273501259654365%26id%3D100009834785112%26refid%3D17%26_ft_%3Dtop_level_post_id.273501259654365%253Atl_objid.273501259654365%253Athid.100009834785112%253A306061129499414%253A2%253A0%253A1464764399%253A-723554753820384022&perm&loc=permalink&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112">Edit</a><span aria-hidden="true"> · </span><a class="r" href="/delete.php?perm&story_permalink_token=S%3A_I100009834785112%3A273501259654365&continue=%2Fstories.php%23s_cbcd49e0daa660cea5de3b339c242cae&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112">Delete</a></div><h3 class="s t"><strong><a href="/profile.php?fref=nf&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112&__tn__=C">Skooter Martin</a></strong> shared <a href="/AudibleAustralia/?refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112&__tn__=C">Audible Australia</a>&#039;s <a href="/AudibleAustralia/photos/a.127389140764900.1073741828.123945261109288/370832343087244/?type=3&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112&__tn__=C">photo</a>.</h3></div><div class="u"><div class="v w n x" id="u_0_3"><div><h3 class="s y"><a href="/AudibleAustralia/?refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112&__tn__=C">Audible Australia</a></h3><div class="z"><p>Planning your next adventure? Take inspiration from Jon Krakauer&#039;s &#039;Into The Wild&#039;.</p><p> Pic credit: oftwolands</p></div><div class="u"><div class="ba bb"><a class="bc bd be" href="/AudibleAustralia/photos/a.127389140764900.1073741828.123945261109288/370832343087244/?type=3&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112&__tn__=E"><img src="https://scontent.fper2-1.fna.fbcdn.net/v/t1.0-0/cp0/e15/q65/p200x200/13100815_370832343087244_3159128389588923240_n.jpg?efg=eyJpIjoiYiJ9&oh=69f81858ff04d147ec7778452612f5d0&oe=57DD4BD8" width="200" height="200" class="k" /></a></div></div></div></div></div></div><div class="bf"><div class="p q"><abbr>37 mins</abbr><span aria-hidden="true"> · </span><span class="bg"><div><span class="p">Privacy:&nbsp;</span><span class="p"><a href="/privacyx/selector/?redir=https%3A%2F%2Fmbasic.facebook.com%2Fstory.php%3Fstory_fbid%3D273501259654365%26id%3D100009834785112%26refid%3D17%26_ft_%3Dtop_level_post_id.273501259654365%253Atl_objid.273501259654365%253Athid.100009834785112%253A306061129499414%253A2%253A0%253A1464764399%253A-723554753820384022&ci=273501259654365&ct=4&sel=300645083384735&as=1&gfid=AQAHHb0nqon3tYXh&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112">Public</a></span></div></span></div><div class="p q"><a class="r" href="/nfx/basic/direct_actions/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22permalink%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22hideable_token%22%3A%22MzI3NjUwNDK1NDM1MTYzrXPNKwkuSSwpLXYuSk0syczPCy7JL6qsqzM0AAJLC2MTcwtTQ0OjujqDOgA%22%2C%22story_permalink_token%22%3A%22S%3A_I100009834785112%3A273501259654365%22%7D&redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2Fstory.php%3Fstory_fbid%3D273501259654365%26id%3D100009834785112%26refid%3D17%26_ft_%3Dtop_level_post_id.273501259654365%253Atl_objid.273501259654365%253Athid.100009834785112%253A306061129499414%253A2%253A0%253A1464764399%253A-723554753820384022&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112">More</a></div></div></div></div><div class="e bh" id="ufi_273501259654365"><div class="bi bj"><div class="bk bl bm"><table class="bn bo"><tbody><tr><td class="bp bq br" style="width:33%"><a class="bs bt bu bv" href="/a/like.php?ul&perm&ifab&ft_ent_identifier=273501259654365&av=100009834785112&gfid=AQCxlORyNH_r0pny&ref_component=mbasic_photo_permalink_actionbar&ref_page=%2Fwap%2Fstory.php&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yy/r/P2H0Ng8Ff2w.png" width="16" height="16" class="bw bx by k" /><span class="bz">Like</span></a></td><td class="bp bq br" style="width:33%"><a class="bs bt bu bv" href="#composer-273501259654365"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/ks_T7R1PM8o.png" width="16" height="16" class="bw bx by k" /><span class="bz">Comment</span></a></td><td class="bp bq ca br" style="width:33%"><a class="bs bt bu bv" href="/composer/mbasic/?c_src=share&referrer=permalink&target=100009834785112&sid=273501259654365&m=self&exit_uri=https%3A%2F%2Fmbasic.facebook.com%2Fstory.php%3Fstory_fbid%3D273501259654365%26id%3D100009834785112%26refid%3D17%26_ft_%3Dtop_level_post_id.273501259654365%253Atl_objid.273501259654365%253Athid.100009834785112%253A306061129499414%253A2%253A0%253A1464764399%253A-723554753820384022&cwevent=composer_entry&av=100009834785112&view_overview&ref_component=mbasic_photo_permalink_actionbar&ref_page=%2Fwap%2Fstory.php&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/_ByufLrUwa0.png" width="16" height="16" class="bw bx by k" /><span class="bz">Share</span></a></td></tr></tbody></table></div><div class="bi cb" id="u_0_0"></div><div class="cc cd" id="composer-273501259654365"><form method="post" action="/a/comment.php?fs=8&actionsource=13&redirectosoftpermalink&comment_logging&ft_ent_identifier=273501259654365&gfid=AQAllevmloKq-otE&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112&av=100009834785112&refid=52"><input type="hidden" name="fb_dtsg" value="AQFhFbGOqpLT:AQHJEF7q_wIi" autocomplete="off" /><input type="hidden" name="charset_test" value="&#x20ac;,&#xb4;,&#x20ac;,&#xb4;,&#x6c34;,&#x414;,&#x404;" /><label class="ce" for="u_0_1">Write a comment...</label><table class="bn bo" id="u_0_1"><tbody><tr><td class="bp"><div class="cf cg"><table class="bn ch ci"><tbody><tr><td class="bp cj ck"><input class="cl cm cn co" id="composerInput" name="comment_text" type="text" /></td></tr></tbody></table></div></td><td class="cp"><div class="cq"><input value="Comment" type="submit" class="bt cr cs ct" /></div></td></tr></tbody></table><span class="cu p q"><a href="/mbasic/comment/advanced/?target_id=273501259654365&pap=1&at=compose&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112">Attach a Photo</a><span aria-hidden="true"> · </span><a href="/friends/selector/?return_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D273501259654365%26pap%26at%3Dcompose&cancel_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D273501259654365%26pap%26at%3Dcompose&friends_key=ids&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112">Mention Friends</a></span></form></div></div></div></div></div></div></div></div></body></html>';
		let expected = [{
				target: '/composer/mbasic/?c_src=share&referrer=permalink&target=100009834785112&sid=273501259654365&m=self&exit_uri=https%3A%2F%2Fmbasic.facebook.com%2Fstory.php%3Fstory_fbid%3D273501259654365%26id%3D100009834785112%26refid%3D17%26_ft_%3Dtop_level_post_id.273501259654365%253Atl_objid.273501259654365%253Athid.100009834785112%253A306061129499414%253A2%253A0%253A1464764399%253A-723554753820384022&cwevent=composer_entry&av=100009834785112&view_overview&ref_component=mbasic_photo_permalink_actionbar&ref_page=%2Fwap%2Fstory.php&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112',
				type: 'Share'
			}, {
				target: '/a/like.php?ul&perm&ifab&ft_ent_identifier=273501259654365&av=100009834785112&gfid=AQCxlORyNH_r0pny&ref_component=mbasic_photo_permalink_actionbar&ref_page=%2Fwap%2Fstory.php&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112',
				type: 'Like'
			}, {
				target: '/a/comment.php?fs=8&actionsource=13&redirectosoftpermalink&comment_logging&ft_ent_identifier=273501259654365&gfid=AQAllevmloKq-otE&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112&av=100009834785112&refid=52&fb_dtsg=AQFhFbGOqpLT:AQHJEF7q_wIi&charset_test=€,´,€,´,水,Д,Є',
				type: 'Comment'
			}, {
				target: '/delete.php?perm&story_permalink_token=S%3A_I100009834785112%3A273501259654365&continue=%2Fstories.php%23s_cbcd49e0daa660cea5de3b339c242cae&refid=52&_ft_=top_level_post_id.273501259654365%3Atl_objid.273501259654365%3Athid.100009834785112',
				type: 'Delete'
			}
		];

		aid.doTest(done, html, expected);
	});

	it('fail gracefully if comment charset is missing... ', (done) => {
		let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Timeline Photos</title></head><body class="b c d e" tabindex="0"><div class="f"><div id="viewport"><div class="g"><h1 class="h" id="header" role="banner"><a class="i" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php"><img alt="facebook" class="j img" height="15" src="https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/5Zo8s-IGqA1.png" width="77"/></a></h1></div><div id="objects_container"><div class="e" id="root" role="main"><div class="k"><div><div><div class="l"><div style="text-align:center;"><img alt="No automatic alt text available." class="img" height="300" src="https://scontent.fper1-1.fna.fbcdn.net/v/t1.0-0/cp0/e15/q65/s600x600/15202598_1782275402101236_3538830727221369466_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=7b03bfc11da0513ddfde1e2eba45f001&amp;oe=58B7FB3F" width="234"/></div></div><div class="l m"><table cellpadding="0" cellspacing="0" class="n"><tr><td valign="top"><a class="o" href="/photo.php?fbid=1782275652101211&amp;id=1515871602074952&amp;set=a.1521463861515726.1073741828.1515871602074952&amp;_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236">Previous</a></td><td class="p" valign="top"><a class="o" href="/photo.php?fbid=1782274882101288&amp;id=1515871602074952&amp;set=a.1521463861515726.1073741828.1515871602074952&amp;_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236">Next</a></td></tr></table></div></div><div><div class="q s t u"><table class="v w" role="presentation"><tbody><tr><td class="x y z" style="width:25%"><a aria-pressed="false" class="ba bb bc bd" href="/a/like.php?ul&amp;perm&amp;ifab&amp;ft_ent_identifier=1782275402101236&amp;av=100009543463363&amp;gfid=AQD39BX_KmZLrV4X&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236" role="button"><img aria-hidden="true" class="be bf bg img" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/yc/r/yB-I64VDoBZ.png" width="16"/><span class="bh">Like</span></a></td><td class="x y z" style="width:25%"><a aria-pressed="false" class="ba bb bc bd" href="/reactions/picker/?ft_id=1782275402101236&amp;origin_uri=https%3A%2F%2Fmbasic.facebook.com%2FsarcasmLOL%2Fphotos%2Fa.1521463861515726.1073741828.1515871602074952%2F1782275402101236%2F%3Ftype%3D3%26bacr%3D1479862205%253A1479862205%253A4%253A-1927950494815652152%253A1479852000%253A6355959774256069079%26refid%3D8%26_ft_%3Dqid.6355959774256069079%253Amf_story_key.-6806823979784191937%253Atop_level_post_id.1782275402101236&amp;av=100009543463363&amp;_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236" role="button"><img aria-hidden="true" class="be bf img" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/4o8rk0I8aTS.png" width="16"/><span class="bh">React</span></a></td><td class="x y z" style="width:25%"><a class="ba bb bc bd" href="#composer-1782275402101236"><img aria-hidden="true" class="be bf bg img" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/yx/r/Psiw6TN0rH8.png" width="16"/><span class="bh">Comment</span></a></td><td class="x y bi z" style="width:25%"><a class="ba bb bc bd" href="/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=100009543463363&amp;sid=1782275402101236&amp;m=self&amp;exit_uri=https%3A%2F%2Fmbasic.facebook.com%2FsarcasmLOL%2Fphotos%2Fa.1521463861515726.1073741828.1515871602074952%2F1782275402101236%2F%3Ftype%3D3%26bacr%3D1479862205%253A1479862205%253A4%253A-1927950494815652152%253A1479852000%253A6355959774256069079%26refid%3D8%26_ft_%3Dqid.6355959774256069079%253Amf_story_key.-6806823979784191937%253Atop_level_post_id.1782275402101236&amp;cwevent=composer_entry&amp;av=100009543463363&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236"><img aria-hidden="true" class="be bf bg img" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/yU/r/qQMCy4a8cyx.png" width="16"/><span class="bh">Share</span></a></td></tr></tbody></table></div></div><div><div class="bj bk bl bm"><div class="bn"><a class="bo" href="/sarcasmLOL/?_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236"><strong class="bp">Sarcasm</strong></a><br/><div><div class="bq" id="voice_replace_id"/></div></div><div class="br bs bt"><span class="bu"><div class="bv"><div class="bw bt bu"><abbr>1 hour ago</abbr><span aria-hidden="true">· </span><span class="bx bt">Custom</span><span aria-hidden="true">· </span>in <a href="/sarcasmLOL/albums/1521463861515726/?_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236">Timeline Photos</a></div><span class="bw bt bu"><a class="by" href="https://scontent.fper1-1.fna.fbcdn.net/v/t1.0-9/fr/cp0/e15/q65/15202598_1782275402101236_3538830727221369466_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=fa2dc98e89cef0c5d9030947a49fe012&amp;oe=58B3B4FE">View Full Size</a><span aria-hidden="true">· </span><a class="by" href="/tokenizer/single/?mode=share_msg&amp;sid=1782275402101236&amp;returnURI=https%3A%2F%2Fmbasic.facebook.com%2FsarcasmLOL%2Fphotos%2Fa.1521463861515726.1073741828.1515871602074952%2F1782275402101236%2F%3Ftype%3D3%26bacr%3D1479862205%253A1479862205%253A4%253A-1927950494815652152%253A1479852000%253A6355959774256069079%26refid%3D8%26_ft_%3Dqid.6355959774256069079%253Amf_story_key.-6806823979784191937%253Atop_level_post_id.1782275402101236&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236">Send as Message</a><span aria-hidden="true">· </span><a class="by" href="/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22is_rapid_reporting%22%3Afalse%2C%22reportable_ent_token%22%3A%221782275402101236%22%2C%22is_impostor%22%3A%22%22%7D&amp;is_direct=1&amp;action_key=RESOLVE_PROBLEM&amp;redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2FsarcasmLOL%2Fphotos%2Fa.1521463861515726.1073741828.1515871602074952%2F1782275402101236%2F%3Ftype%3D3%26bacr%3D1479862205%253A1479862205%253A4%253A-1927950494815652152%253A1479852000%253A6355959774256069079%26refid%3D8%26_ft_%3Dqid.6355959774256069079%253Amf_story_key.-6806823979784191937%253Atop_level_post_id.1782275402101236&amp;ext=1480121406&amp;hash=AeQarQ9kmOefvOpk&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236">Report</a></span></div></span></div></div><div><div class="e bz" id="ufi_1782275402101236"><div class="ca cb"><div class="cc cd"><a class="ce" href="/ufi/reaction/profile/browser/?ft_ent_identifier=1782275402101236&amp;_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236"><div class="cf cg"><span class="ch"><span class="ci"><img alt="Like" class="img" height="16" role="presentation" src="https://static.xx.fbcdn.net/rsrc.php/v3/yj/r/6WffvhOaXGY.png" width="16"/></span><span class="ci"><img alt="Haha" class="img" height="16" role="presentation" src="https://static.xx.fbcdn.net/rsrc.php/v3/yV/r/McJA2ZjdJmf.png" width="16"/></span><span class="ci"><img alt="Love" class="img" height="16" role="presentation" src="https://static.xx.fbcdn.net/rsrc.php/v3/y1/r/RvGKklgAefT.png" width="16"/></span></span><div aria-label="19K left reactions including Like, Haha and Love" class="cj">19K</div></div></a></div><div class="ck cl" id="composer-1782275402101236"><form action="/a/comment.php?fs=7&amp;actionsource=1&amp;comment_logging&amp;ft_ent_identifier=1782275402101236&amp;gfid=AQDRsuxcuNC-zZQi&amp;_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236&amp;av=100009543463363" method="post"><input autocomplete="off" name="fb_dtsg" type="hidden" value="AQGXzQEjTisy:AQEupIQT4MrM"/><label class="cm" for="u_0_0">Write a comment...</label><table class="v w" id="u_0_0" role="presentation"><tbody><tr><td class="x"><div class="cn co"><table class="v cp cq" role="presentation"><tbody><tr><td class="x cr cs"><input class="ct cu cv cw" id="composerInput" name="comment_text" type="text"/></td></tr></tbody></table></div></td><td class="cx"><div class="cy"><input class="bb cz da db" type="submit" value="Comment"/></div></td></tr></tbody></table><span class="dc bt bu"><a href="/friends/selector/?return_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D1782275402101236%26pap%26at%3Dcompose&amp;cancel_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D1782275402101236%26pap%26at%3Dcompose&amp;friends_key=ids&amp;_ft_=qid.6355959774256069079%3Amf_story_key.-6806823979784191937%3Atop_level_post_id.1782275402101236">Mention Friends</a></span></form></div><div id="add_comment_link_placeholder"/></div></div></div></div></div></div><div/></div></div></div></div></body></html>';
		aid.doTest(done, html, (data) => data.length.should.equal(3));
	});
});