import {Action} from '../../src/data/action.es6';
import {Comment} from '../../src/data/comment.es6';
import {Environment} from '../env/TestEnv.es6';
import {FacebookPhotoHandler} from '../../src/facebook/FacebookPhotoHandler';
import {Media} from '../../src/data/media.es6';
import {Post} from '../../src/data/post.es6';
import {TestAid} from '../env/testAid.es6';

let subject = null;
let aid = new TestAid();
let chai = require('chai');
let env = new Environment();
let htmlparser = require('htmlparser2');
let CHARSET_TEST = '&charset_test=€,´,€,´,水,Д,Є';

chai.should();

describe('FacebookPhotoHandling ', function() {

	this.error = (error) => chai.assert('Error thrown', false);

	var execute = (html) => {
		var parser = new htmlparser.Parser(subject, {
			recognizeSelfClosing: true
		});
		parser.write(html);
		parser.done();
	}

	var doTest = (done, html, testing) => {
		subject = new FacebookPhotoHandler((error, data) => {
			// Propagate error
			if (error) {
				this.error(error);
			}

			// Validate the data
			if ('function' === typeof(testing)) {
				testing(data);
			} else {
				aid.validate(testing, data.post);
			}

			// Successful
			done();
		})
		execute(html);
	}

	describe('#parse', function() {

		it('complete photo post without comments', (done) => {
			let html = '<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Photos from Mike Bur\'s post</title></head><body class="b c d e f" tabindex="0"><div class="g"><div id="viewport"><div class="h"><h1 class="i" id="header"><a class="j" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img alt="facebook" class="k l" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y8/r/k97pj8-or6s.png" width="77"/></a></h1></div><div id="objects_container"><div class="f" id="root" role="main"><div class="m"><div><div><div class="n"><div style="text-align:center;"><img class="l" height="426" src="https://scontent.fadl1-1.fna.fbcdn.net/hphotos-xtp1/v/t1.0-0/p320x320/12348081_10207137796139429_6822283307896066403_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=56c7cefad0233e64bf6803512186fdb7&amp;oe=56E41E58" width="320"/></div></div><div class="n o"><table cellpadding="0" cellspacing="0" class="p"><tr><td valign="top"><a class="q" href="/photo.php?fbid=10207137796259432&amp;id=1117810821&amp;set=pcb.10207137798899498&amp;source=48&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Previous</a></td><td class="r" valign="top"><a class="q" href="/photo.php?fbid=10207137796259432&amp;id=1117810821&amp;set=pcb.10207137798899498&amp;source=48&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Next</a></td></tr></table></div></div><div><div class="s t u"><table class="v w"><tbody><tr><td class="x y z" style="width:33%"><a class="ba bb bc bd" href="/a/like.php?ul&amp;perm&amp;ifab&amp;ft_ent_identifier=10207137796139429&amp;av=550398225&amp;gfid=AQBGBAi-srVukDy6&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646"><img class="be bf bg l" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yy/r/P2H0Ng8Ff2w.png" width="16"/><span class="bh">Like</span></a></td><td class="x y z" style="width:33%"><a class="ba bb bc bd" href="#composer-10207137796139429"><img class="be bf bg l" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/ks_T7R1PM8o.png" width="16"/><span class="bh">Comment</span></a></td><td class="x y bi z" style="width:33%"><a class="ba bb bc bd" href="/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=550398225&amp;sid=10207137796139429&amp;m=self&amp;exit_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D10207137796139429%26id%3D1117810821%26set%3Dpcb.10207137798899498%26source%3D48%26refid%3D52%26_ft_%3Dqid.6226835915828417629%253Amf_story_key.8066764526319610646&amp;cwevent=composer_entry&amp;av=550398225&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646"><img class="be bf bg l" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/_ByufLrUwa0.png" width="16"/><span class="bh">Share</span></a></td></tr></tbody></table></div></div><div><div class="bj bk bl bm"><div class="bn"><a class="bo" href="/mike.bur.3?refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646"><strong class="bp">Mike Bur</strong></a><br/><div><div class="bq" id="voice_replace_id"/></div></div><div class="br bs bt"><span class="bu"><div class="bv"><div class="bw bt bu"><abbr>58 minutes ago</abbr>near <a class="bx" href="/profile.php?id=103317853043264&amp;ref=stream&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Cottesloe</a><span aria-hidden="true">· </span><span class="by bt">Public</span><span aria-hidden="true">· </span>in <a href="/mike.bur.3/albums/3390099787435/?refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Mobile Uploads</a></div><div class="bz"><a href="/story.php?story_fbid=10207137798899498&amp;id=1117810821&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Photos from Mike Bur\'s post</a></div><span class="bw bt bu"><a class="ca" href="https://scontent.fadl1-1.fna.fbcdn.net/hphotos-xtp1/v/t1.0-9/12348081_10207137796139429_6822283307896066403_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=7203a3dfe32c0900f80638f7dadaf938&amp;oe=56D907EF">View Full Size</a><span aria-hidden="true">· </span><a class="ca" href="/tokenizer/single/?mode=share_msg&amp;sid=10207137796139429&amp;returnURI=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D10207137796139429%26id%3D1117810821%26set%3Dpcb.10207137798899498%26source%3D48%26refid%3D52%26_ft_%3Dqid.6226835915828417629%253Amf_story_key.8066764526319610646&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Send as message</a><span aria-hidden="true">· </span><a class="ca" href="/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22confirm_actions%22%3Afalse%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%2210207137796139429%22%2C%22is_impostor%22%3A%22%22%7D&amp;is_direct=1&amp;action_key=RESOLVE_PROBLEM&amp;redirect_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D10207137796139429%26id%3D1117810821%26set%3Dpcb.10207137798899498%26source%3D48%26refid%3D52%26_ft_%3Dqid.6226835915828417629%253Amf_story_key.8066764526319610646&amp;ext=1450058316&amp;hash=AeTguo4npjoli4J_&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Report</a></span></div></span></div></div><div><div class="f cb" id="ufi_10207137796139429"><div class="cc cd"><div class="cc ce" id="u_0_0"/><div class="cf cg" id="composer-10207137796139429"><form action="/a/comment.php?fs=7&amp;actionsource=13&amp;redirectosoftpermalink&amp;comment_logging&amp;ft_ent_identifier=10207137796139429&amp;gfid=AQD2qKBVuM4sZmqu&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646&amp;av=550398225&amp;refid=13" method="post"><input autocomplete="off" name="fb_dtsg" type="hidden" value="AQHPLOLW2W0G"/><input name="charset_test" type="hidden" value="€,´,€,´,水,Д,Є"/><label class="ch" for="u_0_1">Write a comment...</label><table class="v ci" id="u_0_1"><tbody><tr><td class="x"><div class="cj ck"><table class="v cl cm"><tbody><tr><td class="x cn w"><input class="co cp cq cr" id="composerInput" name="comment_text" type="text"/></td></tr></tbody></table></div></td><td class="cs"><div class="ct"><input class="bb cu cv cw" type="submit" value="Comment"/></div></td></tr></tbody></table><span class="cx bt bu"><a href="/mbasic/comment/advanced/?target_id=10207137796139429&amp;pap=1&amp;at=compose&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Attach a Photo</a><span aria-hidden="true">· </span><a href="/friends/selector/?return_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D10207137796139429%26pap%26at%3Dcompose&amp;cancel_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D10207137796139429%26pap%26at%3Dcompose&amp;friends_key=ids&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Mention Friends</a></span></form></div></div></div></div></div></div></div></div></div></div></div></body></html>';
			let commentParameters = '&fb_dtsg=AQHPLOLW2W0G' + CHARSET_TEST;
			doTest(done, html, {
				media: [new Media({
					"imageUrl": "https://scontent.fadl1-1.fna.fbcdn.net/hphotos-xtp1/v/t1.0-9/12348081_10207137796139429_6822283307896066403_n.jpg?efg=eyJpIjoiYiJ9&oh=7203a3dfe32c0900f80638f7dadaf938&oe=56D907EF",
					"mimeType": "image/jpeg",
					"srcUrl": "https://scontent.fadl1-1.fna.fbcdn.net/hphotos-xtp1/v/t1.0-9/12348081_10207137796139429_6822283307896066403_n.jpg?efg=eyJpIjoiYiJ9&oh=7203a3dfe32c0900f80638f7dadaf938&oe=56D907EF",
					"type": "photo"
				})],
				rawTimestamp: '58 minutes ago'
			});
		});

		it('complete photo post with comments', (done) => {
			let html = '<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Photos from Mike Bur&#039;s post</title><meta name="referrer" content="origin-when-crossorigin" id="meta_referrer" /><noscript><meta http-equiv="X-Frame-Options" content="DENY" /></noscript><style type="text/css">/*<![CDATA[*/.bl{background-color:#fff;}.n{background-color:#000;}.o{padding:2px 3px;}.bm{padding:6px 3px;}.p{width:100%;}.p .r{text-align:right;}.b a,.b a:visited{color:#3b5998;text-decoration:none;}.b .bx,.b .bx:visited{color:gray;}.b .ca,.b .ca:visited{color:#6d84b4;}.b .q,.b .q:visited{color:#fff;}.b a:focus,.b a:hover,.b .bx:focus,.b .bx:hover,.b .ca:focus,.b .ca:hover{background-color:#3b5998;color:#fff;}.b .q:focus,.b .q:hover{background-color:#fff;color:#3b5998;}.l{border:0;display:inline-block;vertical-align:top;}i.l u{position:absolute;width:0;height:0;overflow:hidden;}.bj{border-bottom:1px solid #ddd;font-size:small;}.by,.bq{display:inline;}.bj .bz,.bj .bw,.bj .by .g,.bj .by.bt,.bj .by .bt{font-size:x-small;}.bk{padding:4px;}.da{padding-left:4px;}.bs{margin-top:2px;}.bu{color:gray;}.bt{font-size:small;}body,tr,input,textarea,.g{font-size:medium;}.cc>div{border-top:1px solid rgba(0, 0, 0, .101);}.cc>.cc>div:first-child{border-top:none;}.cb{background-color:#f6f7f8;color:#141823;}.cn{border-bottom:1px solid #ddd;}.b .cn{padding-bottom:8px;}.b .u{border-color:#ddd;border-width:1px 0 0;}.b .u .y{background-color:#f6f7f8;}.b .u .y:hover,.b .u .y:hover .bc{background-color:#e9eaed;}.b .u .bc{background-color:inherit;}@-moz-keyframes mPlatformDialogOauthV4_moveUp{from{opacity:1;-moz-transform:translateY(0%);}to{opacity:0;-moz-transform:translateY(10%);}}@-moz-keyframes mPlatformDialogOauthV4_moveDown{from{opacity:0;-moz-transform:translateY(10%);}to{opacity:1;-moz-transform:translateY(0%);}}.f{background:#f6f7f8;}.cm{padding:8px 8px 0;}.co{color:#141823;display:block;font-size:small;}.b .cm .cr table{border:none;}.b .cm .cx{border:1px solid #999;height:36px;padding:3px 3px 4px 0;width:98%;}.de{margin-top:4px;}form{margin:0;border:0;}.b .v{border:0;border-collapse:collapse;margin:0;padding:0;width:100%;}.b .v tbody,.b .cp>tr>td,.b .cp>tbody>tr>td,.b .v td.cp{vertical-align:top;}.b .w>tr>td,.b .w>tbody>tr>td,.b .v td.w{vertical-align:middle;}.b .v td{padding:0;}.b .v td.cw{padding:2px;}.b .v td.ce{padding:4px;}.b .x{width:100%;}.ct{background:#fff;}.cq .cy{background-color:transparent;color:#4e5665;display:block;padding:0;width:100%;}.b .cq .cs{border:1px solid #9197a3;}.cv{border:0;display:block;margin:0;padding:0;}.b .cw{padding:2px;}.b .ce{padding:4px;}.db{-moz-appearance:none;background:none;display:inline-block;font-size:12px;height:28px;line-height:28px;margin:0;overflow:visible;padding:0 9px;text-align:center;vertical-align:top;white-space:nowrap;}.b .db{border-radius:2px;}.db[disabled] .bf{opacity:.3;}.dd,a.dd,html .b a.dd{color:#fff;}.b .dd{background-color:#4e69a2;border:1px solid #385490;}.b a.dd:hover,.b .dd:hover{background-color:#465e91;}.dd[disabled]{color:#899bc1;}.b .dd[disabled]:hover{background-color:#4e69a2;}.db .bh{display:inline-block;}.b .db .bh{display:inline-block;margin-top:0;vertical-align:middle;}.b a.db::after,.b .db.ba::after{content:"";display:inline-block;height:100%;vertical-align:middle;}html .db .bf{vertical-align:top;}.db .bh{line-height:20px;margin-top:4px;}.db .bf.bg{margin-top:6px;}.db.ba{padding-left:8px;}.db.ba .bf{margin-right:6px;}.b .db{padding:0 8px;}.b a.db{height:26px;line-height:26px;}.b a.db .bf.bg{margin-top:5px;}.b .db.ba{padding-left:7px;}.bf,.l.bf{display:inline-block;pointer-events:none;vertical-align:middle;}.bh{pointer-events:none;}.t{border-color:#d3d6db #cdd0d6 #c0c4cc;border-style:solid;border-width:1px;}.s .bc,.s .y{background-color:#fff;}.y{background-color:#fff;position:relative;}.y.y.y{padding:6px 0;}.bc{-moz-appearance:none;border:none;margin:0;padding:0;}input.bd,button.bd{width:100%;}.bc{display:block;}.bc{background-color:#fff;color:#4e5665;font-size:small;text-align:center;white-space:nowrap;}.b .y a.bc{color:#4e5665;}.b .y a.bc:hover,.b .y a.bc:focus{background:#f2f2f2;color:#4e5665;}.y:hover,.y:focus,.y:hover .bc,.y:focus .bc{background:#f2f2f2;}.bc{padding:0 4px;}.y .bc .be{display:block;margin:0 auto;}.y .ba.bc .be{margin:0 auto 1px;}.y .bh{pointer-events:auto;}@-moz-keyframes highlightFade{0%{background:#fff9d7;}50%{background:#fff9d7;}100%{background:transparent;}}.ch{color:#9197a3;}.cg{font-size:12px;line-height:16px;}.ci{font-weight:normal;}body{text-align:left;direction:ltr;}body,tr,input,textarea,button{font-family:sans-serif;}body,p,figure,h1,h2,h3,h4,h5,h6,ul,ol,li,dl,dd,dt{margin:0;padding:0;}h1,h2,h3,h4,h5,h6{font-size:1em;font-weight:bold;}ul,ol{list-style:none;}article,aside,figcaption,figure,footer,header,nav,section{display:block;}.e #viewport{margin:0 auto;max-width:600px;}#page{position:relative;}.i{background:#3b5998;height:24px;}.j{display:inline-block;}.k{padding:4px 5px 5px;}/*]]>*/</style><meta name="robots" content="noindex" /></head><body tabindex="0" class="b c d e f"><div class="g"><div id="viewport"><div class="h"><h1 class="i" id="header"><a class="j" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/y8/r/k97pj8-or6s.png" width="77" height="16" class="k l" alt="facebook" /></a></h1></div><div id="objects_container"><div id="root" role="main" class="f"><div class="m"><div><div><div class="n"><div style="text-align:center;"><img src="https://scontent.fadl1-1.fna.fbcdn.net/hphotos-xfl1/v/t1.0-0/p320x320/12342467_10207137796259432_9116886526397470293_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=5f0606fe6693d9f9f8dad74b3383e28e&amp;oe=5717E679" width="320" height="426" class="l" /></div></div><div class="n o"><table cellspacing="0" cellpadding="0" class="p"><tr><td valign="top"><a class="q" href="/photo.php?fbid=10207137796139429&amp;id=1117810821&amp;set=pcb.10207137798899498&amp;source=48&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Previous</a></td><td valign="top" class="r"><a class="q" href="/photo.php?fbid=10207137796139429&amp;id=1117810821&amp;set=pcb.10207137798899498&amp;source=48&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Next</a></td></tr></table></div></div><div><div class="s t u"><table class="v w"><tbody><tr><td class="x y z" style="width:33%"><a class="ba bb bc bd" href="/a/like.php?ul&amp;perm&amp;ifab&amp;ft_ent_identifier=10207137796259432&amp;av=550398225&amp;gfid=AQBuMmRa7Aa0fZ5N&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yy/r/P2H0Ng8Ff2w.png" width="16" height="16" class="be bf bg l" /><span class="bh">Like</span></a></td><td class="x y z" style="width:33%"><a class="ba bb bc bd" href="#composer-10207137796259432"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/ks_T7R1PM8o.png" width="16" height="16" class="be bf bg l" /><span class="bh">Comment</span></a></td><td class="x y bi z" style="width:33%"><a class="ba bb bc bd" href="/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=550398225&amp;sid=10207137796259432&amp;m=self&amp;exit_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D10207137796259432%26id%3D1117810821%26set%3Dpcb.10207137798899498%26source%3D48%26refid%3D52%26_ft_%3Dqid.6226835915828417629%253Amf_story_key.8066764526319610646&amp;cwevent=composer_entry&amp;av=550398225&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/_ByufLrUwa0.png" width="16" height="16" class="be bf bg l" /><span class="bh">Share</span></a></td></tr></tbody></table></div></div><div><div class="bj bk bl bm"><div class="bn"><a class="bo" href="/mike.bur.3?refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646"><strong class="bp">Mike Bur</strong></a><br /><div><div id="voice_replace_id" class="bq"></div></div></div><div class="br bs bt"><span class="bu"><div class="bv"><div class="bw bt bu"><abbr>58 minutes ago</abbr> near <a class="bx" href="/profile.php?id=103317853043264&amp;ref=stream&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Cottesloe</a><span aria-hidden="true"> · </span><span class="by bt">Public</span><span aria-hidden="true"> · </span>in <a href="/mike.bur.3/albums/3390099787435/?refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Mobile Uploads</a></div><div class="bz"><a href="/story.php?story_fbid=10207137798899498&amp;id=1117810821&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Photos from Mike Bur&#039;s post</a></div><span class="bw bt bu"><a class="ca" href="https://scontent.fadl1-1.fna.fbcdn.net/hphotos-xfl1/v/t1.0-9/12342467_10207137796259432_9116886526397470293_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=c6432a7cad7cac012628093bc5a14e09&amp;oe=571EBBCE">View Full Size</a><span aria-hidden="true"> · </span><a class="ca" href="/tokenizer/single/?mode=share_msg&amp;sid=10207137796259432&amp;returnURI=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D10207137796259432%26id%3D1117810821%26set%3Dpcb.10207137798899498%26source%3D48%26refid%3D52%26_ft_%3Dqid.6226835915828417629%253Amf_story_key.8066764526319610646&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Send as message</a><span aria-hidden="true"> · </span><a class="ca" href="/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22confirm_actions%22%3Afalse%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%2210207137796259432%22%2C%22is_impostor%22%3A%22%22%7D&amp;is_direct=1&amp;action_key=RESOLVE_PROBLEM&amp;redirect_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D10207137796259432%26id%3D1117810821%26set%3Dpcb.10207137798899498%26source%3D48%26refid%3D52%26_ft_%3Dqid.6226835915828417629%253Amf_story_key.8066764526319610646&amp;ext=1450058338&amp;hash=AeT0zJlWK5l4b23Q&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Report</a></span></div></span></div></div><div><div class="f cb" id="ufi_10207137796259432"><div class="cc cd"><div class="cc"><div class="ce" id="10207138201509563"><h3><a class="cf" href="/rebecca.wu.5811?refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Rebecca Wu Herbst</a></h3><div>Miss that place</div><div class="cg ch ci"><span class="cj"><span class="ck bu"><a class="ca" href="/a/comment.php?like_comment_id=10207138201509563&amp;snowflake&amp;redirectosoftpermalink&amp;ft_ent_identifier=10207137796259432&amp;av=550398225&amp;gfid=AQCjnFvB3tooAX50&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Like</a></span></span><span aria-hidden="true"> · </span><a href="/comment/replies/?ctoken=10207137796259432_10207138201509563&amp;actor_id=550398225&amp;ft_ent_identifier=10207137796259432&amp;gfid=AQBOw0xSsTfU4cIb&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646#comment_form_1117810821_10207137796259432">Reply</a><span aria-hidden="true"> · </span><a href="/nfx/basic/question/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22permalink%22%2C%22confirm_actions%22%3Afalse%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%22RW50Q29tbWVudDoxMDIwNzEzNzc5NjI1OTQzMl8xMDIwNzEzODIwMTUwOTU2Mw%3D%3D%22%2C%22is_impostor%22%3A%22%22%7D&amp;redirect_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D10207137796259432%26id%3D1117810821%26set%3Dpcb.10207137798899498%26source%3D48%26refid%3D52%26_ft_%3Dqid.6226835915828417629%253Amf_story_key.8066764526319610646&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Report</a><span aria-hidden="true"> · </span><abbr>21 minutes ago</abbr></div></div></div><div class="cc cl" id="u_0_0"></div><div class="cm cn" id="composer-10207137796259432"><form method="post" action="/a/comment.php?fs=7&amp;actionsource=13&amp;redirectosoftpermalink&amp;comment_logging&amp;ft_ent_identifier=10207137796259432&amp;gfid=AQCnWZy1p8N9wx5X&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646&amp;av=550398225&amp;refid=13"><input type="hidden" name="fb_dtsg" value="AQEwogaQeRk3" autocomplete="off" /><input type="hidden" name="charset_test" value="&#x20ac;,&#xb4;,&#x20ac;,&#xb4;,&#x6c34;,&#x414;,&#x404;" /><label class="co" for="u_0_1">Write a comment...</label><table class="v cp" id="u_0_1"><tbody><tr><td class="x"><div class="cq cr"><table class="v cs ct"><tbody><tr><td class="x cu w"><input class="cv cw cx cy" id="composerInput" name="comment_text" type="text" /></td></tr></tbody></table></div></td><td class="cz"><div class="da"><input value="Comment" type="submit" class="bb db dc dd" /></div></td></tr></tbody></table><span class="de bt bu"><a href="/mbasic/comment/advanced/?target_id=10207137796259432&amp;pap=1&amp;at=compose&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Attach a Photo</a><span aria-hidden="true"> · </span><a href="/friends/selector/?return_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D10207137796259432%26pap%26at%3Dcompose&amp;cancel_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D10207137796259432%26pap%26at%3Dcompose&amp;friends_key=ids&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Mention Friends</a></span></form></div></div></div></div></div></div></div></div></div></div></div></body></html>'
			let commentParameters = '&fb_dtsg=AQEwogaQeRk3' + CHARSET_TEST;
			doTest(done, html, {
				media: [new Media({
					"imageUrl": "https://scontent.fadl1-1.fna.fbcdn.net/hphotos-xfl1/v/t1.0-9/12342467_10207137796259432_9116886526397470293_n.jpg?efg=eyJpIjoiYiJ9&oh=c6432a7cad7cac012628093bc5a14e09&oe=571EBBCE",
					"mimeType": "image/jpeg",
					"srcUrl": "https://scontent.fadl1-1.fna.fbcdn.net/hphotos-xfl1/v/t1.0-9/12342467_10207137796259432_9116886526397470293_n.jpg?efg=eyJpIjoiYiJ9&oh=c6432a7cad7cac012628093bc5a14e09&oe=571EBBCE",
					"type": "photo"
				})],
				rawTimestamp: '58 minutes ago'
			});
		});

		it('View Full Story case sensitivity test...', (done) => {
			let html = '<?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE html PUBLIC \"-//WAPFORUM//DTD XHTML Mobile 1.0//EN\" \"http://www.wapforum.org/DTD/xhtml-mobile10.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><title>Timeline Photos</title></head><body tabindex=\"0\" class=\"b c d e\"><div class=\"f\"><div id=\"objects_container\"><div id=\"root\" role=\"main\" class=\"e\"><div class=\"k\"><div><div><div class=\"l\"><div style=\"text-align:center;\"><img src=\"https://scontent.fper1-1.fna.fbcdn.net/hphotos-xtl1/v/t1.0-0/cp0/e15/q65/p320x320/12705363_1150955991605088_2872581647860507864_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=3c15c136ff76b4f571bee0e8b7cc2dcc&amp;oe=5730F0B7\" width=\"320\" height=\"320\" class=\"img\" /></div></div><div class=\"l m\"><table cellspacing=\"0\" cellpadding=\"0\" class=\"n\"><tr><td valign=\"top\"><a class=\"o\" href=\"/photo.php?fbid=1151006148266739&amp;id=478381098862584&amp;set=a.555998657767494.1073741825.478381098862584&amp;_ft_=qid.6252053520056604157%3Amf_story_key.4111547457556193554\">Previous</a></td><td valign=\"top\" class=\"p\"><a class=\"o\" href=\"/photo.php?fbid=1150809884953032&amp;id=478381098862584&amp;set=a.555998657767494.1073741825.478381098862584&amp;_ft_=qid.6252053520056604157%3Amf_story_key.4111547457556193554\">Next</a></td></tr></table></div></div><div><div class=\"q s t\"><table class=\"u v\"><tbody><tr><td class=\"w x y\" style=\"width:33%\"><a class=\"z ba bb bc\" href=\"/a/like.php?ul&amp;perm&amp;ifab&amp;ft_ent_identifier=1150955991605088&amp;av=100009834785112&amp;gfid=AQArEJ2qtPKhOD5Z&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6252053520056604157%3Amf_story_key.4111547457556193554\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yy/r/P2H0Ng8Ff2w.png\" width=\"16\" height=\"16\" class=\"bd be bf img\" /><span class=\"bg\">Like</span></a></td><td class=\"w x y\" style=\"width:33%\"><a class=\"z ba bb bc\" href=\"#composer-1150955991605088\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/ks_T7R1PM8o.png\" width=\"16\" height=\"16\" class=\"bd be bf img\" /><span class=\"bg\">Comment</span></a></td><td class=\"w x bh y\" style=\"width:33%\"><a class=\"z ba bb bc\" href=\"/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=100009834785112&amp;sid=1150955991605088&amp;m=self&amp;exit_uri=https%3A%2F%2Fmbasic.facebook.com%2Fstartsat60%2Fphotos%2Fa.555998657767494.1073741825.478381098862584%2F1150955991605088%2F%3Ftype%3D3%26refid%3D52%26_ft_%3Dqid.6252053520056604157%253Amf_story_key.4111547457556193554%26__tn__%3DE&amp;cwevent=composer_entry&amp;av=100009834785112&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6252053520056604157%3Amf_story_key.4111547457556193554\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/_ByufLrUwa0.png\" width=\"16\" height=\"16\" class=\"bd be bf img\" /><span class=\"bg\">Share</span></a></td></tr></tbody></table></div></div><div><div class=\"bi bj bk bl\"><div class=\"bm\"><a class=\"bn\" href=\"/startsat60/?_ft_=qid.6252053520056604157%3Amf_story_key.4111547457556193554\"><strong class=\"bo\">Starts at 60</strong></a><br /><div class=\"bp\">Haha! So true!<div id=\"voice_replace_id\" class=\"bq\"></div></div></div><div class=\"br bs bt\"><span class=\"bu\"><div class=\"bv\"><div class=\"bw bt bu\"><abbr>Yesterday at 16:15</abbr><span aria-hidden=\"true\"> · </span><span class=\"bx bt\">Public</span><span aria-hidden=\"true\"> · </span>in <a href=\"/startsat60/albums/555998657767494/?_ft_=qid.6252053520056604157%3Amf_story_key.4111547457556193554\">Timeline Photos</a></div><span class=\"bw bt bu\"><a class=\"by\" href=\"https://scontent.fper1-1.fna.fbcdn.net/hphotos-xtl1/v/t1.0-9/fr/cp0/e15/q65/12705363_1150955991605088_2872581647860507864_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=092480ad0cdb9ac32f37dba0d5fd22e9&amp;oe=575F33C8\">View full size</a><span aria-hidden=\"true\"> · </span><a class=\"by\" href=\"/tokenizer/single/?mode=share_msg&amp;sid=1150955991605088&amp;returnURI=https%3A%2F%2Fmbasic.facebook.com%2Fstartsat60%2Fphotos%2Fa.555998657767494.1073741825.478381098862584%2F1150955991605088%2F%3Ftype%3D3%26refid%3D52%26_ft_%3Dqid.6252053520056604157%253Amf_story_key.4111547457556193554%26__tn__%3DE&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6252053520056604157%3Amf_story_key.4111547457556193554\">Send as message</a><span aria-hidden=\"true\"> · </span><a class=\"by\" href=\"/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%221150955991605088%22%2C%22is_impostor%22%3A%22%22%7D&amp;is_direct=1&amp;action_key=RESOLVE_PROBLEM&amp;redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2Fstartsat60%2Fphotos%2Fa.555998657767494.1073741825.478381098862584%2F1150955991605088%2F%3Ftype%3D3%26refid%3D52%26_ft_%3Dqid.6252053520056604157%253Amf_story_key.4111547457556193554%26__tn__%3DE&amp;ext=1455928983&amp;hash=AeRfUP7EkSfBo58-&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6252053520056604157%3Amf_story_key.4111547457556193554\">Report</a></span></div></span></div></div></div></div></div></div></div></div></div></body></html>';
			doTest(done, html, {
				media: [
					new Media({
						imageUrl: 'https://scontent.fper1-1.fna.fbcdn.net/hphotos-xtl1/v/t1.0-9/fr/cp0/e15/q65/12705363_1150955991605088_2872581647860507864_n.jpg?efg=eyJpIjoiYiJ9&oh=092480ad0cdb9ac32f37dba0d5fd22e9&oe=575F33C8',
						mimeType: 'image/jpeg',
						srcUrl: 'https://scontent.fper1-1.fna.fbcdn.net/hphotos-xtl1/v/t1.0-9/fr/cp0/e15/q65/12705363_1150955991605088_2872581647860507864_n.jpg?efg=eyJpIjoiYiJ9&oh=092480ad0cdb9ac32f37dba0d5fd22e9&oe=575F33C8',
						type: 'photo'
					})
				]
			});
		});

		it('Missing carsales.com.au post messages...', (done) => {
			let html = '<?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE html PUBLIC \"-//WAPFORUM//DTD XHTML Mobile 1.0//EN\" \"http://www.wapforum.org/DTD/xhtml-mobile10.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><title>Photo</title></head><body tabindex=\"0\" class=\"b c d e\"><div class=\"f\"><div id=\"viewport\"><div class=\"g\"><h1 class=\"h\" id=\"header\"><a class=\"i\" href=\"/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/y8/r/k97pj8-or6s.png\" width=\"77\" height=\"16\" class=\"j k\" alt=\"facebook\" /></a></h1></div><div id=\"objects_container\"><div class=\"l e\" id=\"root\" role=\"main\"><div class=\"m\"><div><div><div class=\"n\"><div style=\"text-align:center;\"><img src=\"https://scontent.fper1-1.fna.fbcdn.net/hphotos-xal1/v/t1.0-0/cp0/e15/q65/s320x320/12744249_10153346230761680_8059667817673958667_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=317c1795705a3732aa8b36ee59730616&amp;oe=574D52EA\" width=\"320\" height=\"228\" class=\"k\" /></div></div><div class=\"n o\"><table cellspacing=\"0\" cellpadding=\"0\" class=\"p\"><tr><td valign=\"top\"><a class=\"q\" href=\"/photo.php?fbid=10153346267241680&amp;id=156133956679&amp;set=a.204315446679.137558.156133956679&amp;_ft_=qid.6256523318144021094%3Amf_story_key.4142368643258826559\">Previous</a></td><td valign=\"top\" class=\"r\"><a class=\"q\" href=\"/photo.php?fbid=10153346067756680&amp;id=156133956679&amp;set=a.204315446679.137558.156133956679&amp;_ft_=qid.6256523318144021094%3Amf_story_key.4142368643258826559\">Next</a></td></tr></table></div></div><div><div class=\"s t u\"><table class=\"v w\"><tbody><tr><td class=\"x y z\" style=\"width:33%\"><a class=\"ba bb bc bd\" href=\"/a/like.php?ul&amp;perm&amp;ifab&amp;ft_ent_identifier=10153346230761680&amp;av=100011376849188&amp;gfid=AQBB_C75pbcGd-NI&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6256523318144021094%3Amf_story_key.4142368643258826559\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yy/r/P2H0Ng8Ff2w.png\" width=\"16\" height=\"16\" class=\"be bf bg k\" /><span class=\"bh\">Like</span></a></td><td class=\"x y z\" style=\"width:33%\"><a class=\"ba bb bc bd\" href=\"#composer-10153346230761680\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/ks_T7R1PM8o.png\" width=\"16\" height=\"16\" class=\"be bf bg k\" /><span class=\"bh\">Comment</span></a></td><td class=\"x y bi z\" style=\"width:33%\"><a class=\"ba bb bc bd\" href=\"/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=100011376849188&amp;sid=10153346230761680&amp;m=self&amp;exit_uri=https%3A%2F%2Fmbasic.facebook.com%2Fcarsales.com.au%2Fphotos%2Fa.204315446679.137558.156133956679%2F10153346230761680%2F%3Ftype%3D3%26bacr%3D1456469076%253A1456469076%253A2%253A4142368643258826559%253A1456435800%253A0%253A0%253A55%26refid%3D7%26_ft_%3Dqid.6256523318144021094%253Amf_story_key.4142368643258826559&amp;cwevent=composer_entry&amp;av=100011376849188&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6256523318144021094%3Amf_story_key.4142368643258826559\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/_ByufLrUwa0.png\" width=\"16\" height=\"16\" class=\"be bf bg k\" /><span class=\"bh\">Share</span></a></td></tr></tbody></table></div></div><div><div class=\"bj bk bl bm\"><div class=\"bn\"><a class=\"bo\" href=\"/carsales.com.au/?_ft_=qid.6256523318144021094%3Amf_story_key.4142368643258826559\"><strong class=\"bp\">carsales.com.au</strong></a><br /><div class=\"bq\"><span>Can you name the make/model/</span><wbr /><span class=\"word_break\"></span>year of this?<br /><a class=\"_5ayv\" href=\"/hashtag/fridayfun?_ft_=qid.6256523318144021094%3Amf_story_key.4142368643258826559\"><span class=\"_5aw4\">‪#‎</span><span class=\"_5ayu\">fridayfun‬</span></a><div id=\"voice_replace_id\" class=\"br\"></div></div></div><div class=\"bs bt bu\"><span class=\"bv\"><div class=\"bw\"><div class=\"bx bu bv\"><abbr>26 February at 05:30</abbr><span aria-hidden=\"true\"> · </span><span class=\"by bu\">Public</span><span aria-hidden=\"true\"> · </span>in <a href=\"/carsales.com.au/albums/204315446679/?_ft_=qid.6256523318144021094%3Amf_story_key.4142368643258826559\">Timeline Photos</a></div><span class=\"bx bu bv\"><a class=\"bz\" href=\"https://scontent.fper1-1.fna.fbcdn.net/hphotos-xal1/t31.0-8/fr/cp0/e15/q65/12764426_10153346230761680_8059667817673958667_o.jpg?efg=eyJpIjoiYiJ9\">View full size</a><span aria-hidden=\"true\"> · </span><a class=\"bz\" href=\"/tokenizer/single/?mode=share_msg&amp;sid=10153346230761680&amp;returnURI=https%3A%2F%2Fmbasic.facebook.com%2Fcarsales.com.au%2Fphotos%2Fa.204315446679.137558.156133956679%2F10153346230761680%2F%3Ftype%3D3%26bacr%3D1456469076%253A1456469076%253A2%253A4142368643258826559%253A1456435800%253A0%253A0%253A55%26refid%3D7%26_ft_%3Dqid.6256523318144021094%253Amf_story_key.4142368643258826559&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6256523318144021094%3Amf_story_key.4142368643258826559\">Send as message</a><span aria-hidden=\"true\"> · </span><a class=\"bz\" href=\"/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%2210153346230761680%22%2C%22is_impostor%22%3A%22%22%7D&amp;is_direct=1&amp;action_key=RESOLVE_PROBLEM&amp;redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2Fcarsales.com.au%2Fphotos%2Fa.204315446679.137558.156133956679%2F10153346230761680%2F%3Ftype%3D3%26bacr%3D1456469076%253A1456469076%253A2%253A4142368643258826559%253A1456435800%253A0%253A0%253A55%26refid%3D7%26_ft_%3Dqid.6256523318144021094%253Amf_story_key.4142368643258826559&amp;ext=1456969933&amp;hash=AeQGoijDDl7Tx5cC&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6256523318144021094%3Amf_story_key.4142368643258826559\">Report</a></span></div></span></div></div></div></div></div></div></div></div></div></body></html>';
			let expected = {
				message: 'Can you name the make/model/ year of this?\n#fridayfun'
			}

			doTest(done, html, expected);
		});

		it('Sharing with loads of others scrapes post image not user image...', (done) => {
			let html = '<?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE html PUBLIC \"-//WAPFORUM//DTD XHTML Mobile 1.0//EN\" \"http://www.wapforum.org/DTD/xhtml-mobile10.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><title>viral</title></head><body tabindex=\"0\" class=\"b c d e\"><div class=\"f\"><div id=\"viewport\"><div class=\"g\"><h1 class=\"h\" id=\"header\"><a class=\"i\" href=\"/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/y8/r/k97pj8-or6s.png\" width=\"77\" height=\"16\" class=\"j k\" alt=\"facebook\" /></a></h1></div><div id=\"objects_container\"><div class=\"l e\" id=\"root\" role=\"main\"><div class=\"m\"><div><div><div class=\"n\"><div style=\"text-align:center;\"><img src=\"https://scontent.fper1-1.fna.fbcdn.net/hphotos-xpl1/v/t1.0-0/cp0/e15/q65/p320x320/12742347_419050144886509_2392996088579809818_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=db71bd28699763a17f54a8e7d67cc69d&amp;oe=5767A61F\" width=\"320\" height=\"320\" class=\"k\" /></div></div><div class=\"n o\"><table cellspacing=\"0\" cellpadding=\"0\" class=\"p\"><tr><td valign=\"top\"><a class=\"q\" href=\"/photo.php?fbid=417721378352719&amp;id=168014926656700&amp;set=a.182428165215376.14517.168014926656700&amp;_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Previous</a></td><td valign=\"top\" class=\"r\"><a class=\"q\" href=\"/photo.php?fbid=419658094825714&amp;id=168014926656700&amp;set=a.182428165215376.14517.168014926656700&amp;_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Next</a></td></tr></table></div></div><div><div class=\"s t u\"><table class=\"v w\"><tbody><tr><td class=\"x y z\" style=\"width:33%\"><a class=\"ba bb bc bd\" href=\"/a/like.php?ul&amp;perm&amp;ifab&amp;ft_ent_identifier=419050144886509&amp;av=100009834785112&amp;gfid=AQAMqLbW9WkPAx1m&amp;amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yy/r/P2H0Ng8Ff2w.png\" width=\"16\" height=\"16\" class=\"be bf bg k\" /><span class=\"bh\">Like</span></a></td><td class=\"x y z\" style=\"width:33%\"><a class=\"ba bb bc bd\" href=\"#composer-419050144886509\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/ks_T7R1PM8o.png\" width=\"16\" height=\"16\" class=\"be bf bg k\" /><span class=\"bh\">Comment</span></a></td><td class=\"x y bi z\" style=\"width:33%\"><a class=\"ba bb bc bd\" href=\"/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=100009834785112&amp;sid=419050144886509&amp;m=self&amp;exit_uri=https%3A%2F%2Fmbasic.facebook.com%2Fdown.n.dirty69%2Fphotos%2Fa.182428165215376.14517.168014926656700%2F419050144886509%2F%3Ftype%3D3%26refid%3D52%26_ft_%3Dqid.6256885590058402011%253Amf_story_key.-1246049925265258351%26__tn__%3DE&amp;cwevent=composer_entry&amp;av=100009834785112&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/_ByufLrUwa0.png\" width=\"16\" height=\"16\" class=\"be bf bg k\" /><span class=\"bh\">Share</span></a></td></tr></tbody></table></div></div><div><div class=\"bj bk bl bm\"><div class=\"bn\"><a class=\"bo\" href=\"/down.n.dirty69/?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\"><strong class=\"bp\">Down ~n~ Dirty</strong></a><br /><div class=\"bq\"><div id=\"voice_replace_id\" class=\"br\"><span class=\"bs\">With <span><a href=\"/erica.warren.739?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Erica Warren</a></span>, <span><a href=\"/gulay.lallai?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Gulay Kunduz</a></span>, <span><a href=\"/sally.offretcadelundberg?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Sally Offret Cade Lundberg</a></span>, <span><a href=\"/dave.preising?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Dave Preising</a></span>, <span><a href=\"/angelique.aline.7?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Angelique Pickens</a></span>, <span><a href=\"https://mbasic.facebook.com/media/set/?set=ft.1240551215967522&amp;type=1&amp;_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Dominic Alexander</a></span>, <span><a href=\"/wendy.anderson.9803?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Wendy Anderson</a></span>, <span><a href=\"/marllory.la.nena?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Marllory Celeste</a></span>, <span><a href=\"/trisha.rummler?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Trisha Rummler</a></span>, <span><a href=\"/profile.php?id=100009281442060&amp;_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Caleb Alexander</a></span>, <span><a href=\"/profile.php?id=100008482055792&amp;_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Christopher Craig</a></span>, <span><a href=\"/nivida.interiano?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Nivida Interiano Padrón</a></span>, <span><a href=\"/anne.bowyer.14?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Anne Bowyer</a></span>, <span><a href=\"/Crystalg14?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Crystal Garner</a></span>, <span><a href=\"/todd.mclaughlin.102?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Todd McLaughlin</a></span>, <span><a href=\"/michael.hutchinson.14224094?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Michael Hutchinson</a></span>, <span><a href=\"/becca.rogers.79?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Becca Rogers</a></span>, <span><a href=\"/x6xdiablax6x?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">NeNa Hernandez</a></span>, <span><a href=\"/lchoka?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Leisha Choka</a></span>, <span><a href=\"/knonies?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Kim Martinez Nonies</a></span>, <span><a href=\"/lisa.pickens2?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Lisa Sanders-Pickens</a></span>, <span><a href=\"/PwnZ.Awes0me?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Panda Ownz</a></span>, <span><a href=\"/tammy.crane.125?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Tammy Crane</a></span>, <span><a href=\"/Clmorazg?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Carmen Lewis</a></span>, <span><a href=\"/nicole.monroe.73?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Nicki Laskero Singer</a></span>, <span><a href=\"/jenn.freeman.98?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Jenn Freeman</a></span>, <span><a href=\"/kirsty.johnson.75033?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Kirsty Johnson</a></span>, <span><a href=\"/michelle.byers.20?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Michelle Byers</a></span>, <span><a>Shawn panesar</a></span>, <span><a href=\"/james.rosser.790?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">James Rosser</a></span>, <span><a href=\"/annette.wessling.1?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Annette Wessling</a></span>, <span><a href=\"/jackie.wilson.77964?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Jackie Wilson</a></span>, <span><a href=\"/samantha.decanha?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Samantha Clarise de Canha</a></span>, <span><a href=\"/TinaMooreheadapartmentlady?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Tina Elizabeth Bass</a></span>, <span><a href=\"/JimTaugera?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Jimmy Segodi</a></span>, <span><a href=\"/miller.krista09?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Krista London</a></span>, <span><a href=\"/josh.hines.3557?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Josh Hines</a></span>, <span><a href=\"/mary.santonato?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Mary Santonato</a></span>, <span><a href=\"/laurika.kruger.5?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Laurika Kruger</a></span>, <span><a href=\"/ethel.dyke.50?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Ethel Dyke</a></span>, <span><a href=\"/patrick.parker.351104?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Patrick Parker</a></span>, <span><a href=\"/natalee.bilyeusmith?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Natalee Bilyeu-Smith</a></span>, <span><a href=\"/profile.php?id=100008868816956&amp;_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Frank Smith</a></span> and <span><a href=\"/andrea.shay.5?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Andrea Shay</a></span></span></div></div></div><div class=\"bt bu bv\"><span class=\"bs\"><div class=\"bw\"><div class=\"bx bv bs\"><abbr>25 February at 03:31</abbr><span aria-hidden=\"true\"> · </span><span class=\"by bv\">Public</span><span aria-hidden=\"true\"> · </span>in <a href=\"/down.n.dirty69/albums/182428165215376/?_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">viral</a></div><span class=\"bx bv bs\"><a class=\"bz\" href=\"https://scontent.fper1-1.fna.fbcdn.net/hphotos-xpl1/v/t1.0-9/fr/cp0/e15/q65/12742347_419050144886509_2392996088579809818_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=352f3a2ad5f180c84a48f988bc22552c&amp;oe=57569127\">View full size</a><span aria-hidden=\"true\"> · </span><a class=\"bz\" href=\"/tokenizer/single/?mode=share_msg&amp;sid=419050144886509&amp;returnURI=https%3A%2F%2Fmbasic.facebook.com%2Fdown.n.dirty69%2Fphotos%2Fa.182428165215376.14517.168014926656700%2F419050144886509%2F%3Ftype%3D3%26refid%3D52%26_ft_%3Dqid.6256885590058402011%253Amf_story_key.-1246049925265258351%26__tn__%3DE&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Send as message</a><span aria-hidden=\"true\"> · </span><a class=\"bz\" href=\"/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%22419050144886509%22%2C%22is_impostor%22%3A%22%22%7D&amp;is_direct=1&amp;action_key=RESOLVE_PROBLEM&amp;redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2Fdown.n.dirty69%2Fphotos%2Fa.182428165215376.14517.168014926656700%2F419050144886509%2F%3Ftype%3D3%26refid%3D52%26_ft_%3Dqid.6256885590058402011%253Amf_story_key.-1246049925265258351%26__tn__%3DE&amp;ext=1457054268&amp;hash=AeTwop5puB_l1B6a&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;_ft_=qid.6256885590058402011%3Amf_story_key.-1246049925265258351\">Report</a></span></div></span></div></div></div></div></div></div></div></div></div></body></html>';
			let expected = {
				media: [
					new Media({
						imageUrl: 'https://scontent.fper1-1.fna.fbcdn.net/hphotos-xpl1/v/t1.0-9/fr/cp0/e15/q65/12742347_419050144886509_2392996088579809818_n.jpg?efg=eyJpIjoiYiJ9&oh=352f3a2ad5f180c84a48f988bc22552c&oe=57569127',
						mimeType: 'image/jpeg',
						srcUrl: 'https://scontent.fper1-1.fna.fbcdn.net/hphotos-xpl1/v/t1.0-9/fr/cp0/e15/q65/12742347_419050144886509_2392996088579809818_n.jpg?efg=eyJpIjoiYiJ9&oh=352f3a2ad5f180c84a48f988bc22552c&oe=57569127',
						type: 'photo'
					})
				]
			}

			doTest(done, html, expected);
		});

		it('missing actions div should not throw a ReferenceError...', (done) => {
			let html = '<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Photos from Mike Bur\'s post</title></head><body class="b c d e f" tabindex="0"><div class="g"><div id="viewport"><div class="h"><h1 class="i" id="header"><a class="j" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img alt="facebook" class="k l" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v2/y8/r/k97pj8-or6s.png" width="77"/></a></h1></div><div id="objects_container"><div class="f" id="root" role="main"><div class="m"><div><div><div class="bj bk bl bm"><div class="bn"><a class="bo" href="/mike.bur.3?refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646"><strong class="bp">Mike Bur</strong></a><br/><div><div class="bq" id="voice_replace_id"/></div></div><div class="br bs bt"><span class="bu"><div class="bv"><div class="bw bt bu"><abbr>58 minutes ago</abbr>near <a class="bx" href="/profile.php?id=103317853043264&amp;ref=stream&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Cottesloe</a><span aria-hidden="true">· </span><span class="by bt">Public</span><span aria-hidden="true">· </span>in <a href="/mike.bur.3/albums/3390099787435/?refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Mobile Uploads</a></div><div class="bz"><a href="/story.php?story_fbid=10207137798899498&amp;id=1117810821&amp;refid=13&amp;_ft_=qid.6226835915828417629%3Amf_story_key.8066764526319610646">Photos from Mike Bur\'s post</a></div></div></span></div></div></div></div></div></div></div></div></div></body></html>';
			doTest(done, html, (data) => chai.assert.isNotOk(data.post.media[0].imageUrl));
		});

		it('broken link should not throw a ReferenceError...', (done) => {
			let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Content Not Found</title></head><body class="b c d e" tabindex="0"><div class="f"><div id="viewport"><div class="g"><h1 class="h" id="header"><a class="i" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=XPhotoPermalinkController"><img alt="facebook" class="j k" height="15" src="https://static.xx.fbcdn.net/rsrc.php/v3/yc/r/kuwxWbMryMe.png" width="77"/></a></h1></div><div id="objects_container"><div class="l e" id="root" role="main"><div class="m n o p"><span class="q">The page you requested cannot be displayed right now. It may be temporarily unavailable, the link you clicked on may be broken or expired, or you may not have permission to view this page.</span></div><div class="e r"><a href="/home.php?rand=565946918">Back to home</a></div><div/></div></div></div></div></body></html>'
			doTest(done, html, (data) => chai.assert.isNotOk(data.post.media[0].imageUrl));
		});

		it('photos of user with someone else should parse correctly...', (done) => {
			let html = '<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mobile Uploads</title></head><body class="b c d e" tabindex="0"><div class="f"><div id="viewport"><div class="g"><h1 class="h" id="header"><a class="i" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img alt="facebook" class="j k" height="15" src="https://static.xx.fbcdn.net/rsrc.php/v3/yc/r/kuwxWbMryMe.png" width="77"/></a></h1></div><div id="objects_container"><div class="l e" id="root"><div class="m"><div><div><div class="n"><div style="text-align:center;"><img alt="Image may contain: 7 people , people smiling , text" class="k" height="200" src="https://scontent-iad3-1.xx.fbcdn.net/v/t1.0-0/cp0/e15/q65/s600x600/14591806_1741221579532719_7254417395603480849_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=d1e1581d65281c4d0ca15d484d70a098&amp;oe=58C717B8" width="146"/></div></div><div class="n o"><table cellpadding="0" cellspacing="0" class="p"><tr><td valign="top"><a class="q" href="/photo.php?fbid=1741445779510299&amp;id=100009346826367&amp;set=a.1434240100230870.1073741831.100009346826367&amp;refid=13">Previous</a></td><td class="r" valign="top"><a class="q" href="/photo.php?fbid=1739724469682430&amp;id=100009346826367&amp;set=a.1434240100230870.1073741831.100009346826367&amp;refid=13">Next</a></td></tr></table></div></div><div><div class="s t u v"><table class="w x"><tbody><tr><td class="y z ba" style="width:25%"><a class="bb bc bd be" href="/a/like.php?ul&amp;perm&amp;ifab&amp;ft_ent_identifier=1741221702866040&amp;av=100011374953951&amp;gfid=AQClBkxVWnI1ttDp&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img class="bf bg bh k" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/yg/r/eVV-VqkZfmb.png" width="16"/><span class="bi">Like</span></a></td><td class="y z ba" style="width:25%"><a class="bb bc bd be" href="/reactions/picker/?ft_id=1741221702866040&amp;origin_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1741221579532719%26id%3D100009346826367%26set%3Da.1434240100230870.1073741831.100009346826367%26comment_id%3D1741240152864195&amp;av=100011374953951&amp;refid=13"><img class="bf bg k" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/y6/r/RFsmUG_yANT.png" width="16"/><span class="bi">React</span></a></td><td class="y z ba" style="width:25%"><a class="bb bc bd be" href="#composer-1741221702866040"><img class="bf bg bh k" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/yv/r/6lKlDS3bJld.png" width="16"/><span class="bi">Comment</span></a></td><td class="y z bj ba" style="width:25%"><a class="bb bc bd be" href="/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=100011374953951&amp;sid=1741221702866040&amp;m=self&amp;exit_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1741221579532719%26id%3D100009346826367%26set%3Da.1434240100230870.1073741831.100009346826367%26comment_id%3D1741240152864195&amp;cwevent=composer_entry&amp;av=100011374953951&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img class="bf bg bh k" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/yZ/r/kCcjzWwbf-j.png" width="16"/><span class="bi">Share</span></a></td></tr></tbody></table></div></div><div><div class="bk bl bm bn"><div class="bo"><a class="bp" href="/topnotch.hicks?refid=13"><strong class="bq">Hicks Rahjem</strong></a><br/><div class="br">Team Beast - 1031<div class="bs" id="voice_replace_id"><span class="bt">— with <span><a href="/benavente.kjfyf?refid=13">Kj Fyf Benavente</a></span></span></div></div></div><div class="bu bv bw"><span class="bt"><div class="bx"><div class="by bw bt"><abbr>Oct 31</abbr><span>· </span><span class="bz bw">Friends</span><span>· </span>in <a href="/topnotch.hicks/albums/1434240100230870/?refid=13">Mobile Uploads</a></div><span class="by bw bt"><a class="ca" href="/photos/xtag_faces/?photo_id=1741221579532719&amp;owner_id=100009346826367&amp;return_uri=%2Fphoto.php%3Ffbid%3D1741221579532719%26id%3D100009346826367%26set%3Da.1434240100230870.1073741831.100009346826367&amp;page_source=photo&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13">Tag Photo</a><span>· </span><a class="ca" href="https://scontent-iad3-1.xx.fbcdn.net/t31.0-8/fr/cp0/e15/q65/14918909_1741221579532719_7254417395603480849_o.jpg?efg=eyJpIjoiYiJ9">View Full Size</a><span>· </span><a class="ca" href="/tokenizer/single/?mode=share_msg&amp;sid=1741221579532719&amp;returnURI=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1741221579532719%26id%3D100009346826367%26set%3Da.1434240100230870.1073741831.100009346826367%26comment_id%3D1741240152864195&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13">Send as Message</a><span>· </span><a class="ca" href="/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22is_rapid_reporting%22%3Afalse%2C%22reportable_ent_token%22%3A%221741221579532719%22%2C%22is_impostor%22%3A%22%22%7D&amp;is_direct=1&amp;action_key=RESOLVE_PROBLEM&amp;redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1741221579532719%26id%3D100009346826367%26set%3Da.1434240100230870.1073741831.100009346826367%26comment_id%3D1741240152864195&amp;ext=1478900804&amp;hash=AeRwch_d663clMxF&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13">Report</a></span></div></span></div></div></div></div></div><div/></div></div></div></div></body></html>';
			doTest(done, html, (data) => data.post.media[0].imageUrl.should.equal('https://scontent-iad3-1.xx.fbcdn.net/t31.0-8/fr/cp0/e15/q65/14918909_1741221579532719_7254417395603480849_o.jpg?efg=eyJpIjoiYiJ9'));
		});

		it('photos with an extended set of actions should parse correctly...', (done) => {
			let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mobile Uploads</title></head><body class="b c d e" tabindex="0"><div class="f"><div id="viewport"><div class="g"><h1 class="h" id="header"><a class="i" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img alt="facebook" class="j k" height="15" src="https://fbstatic-a.akamaihd.net/rsrc.php/v3/y9/r/5Zo8s-IGqA1.png" width="77"/></a></h1></div><div id="objects_container"><div class="l e" id="root"><div class="m"><div><div><div class="n"><div style="text-align:center;"><img alt="Image may contain: 4 people , text, outdoor and water" class="k" height="180" src="https://fbcdn-photos-c-a.akamaihd.net/hphotos-ak-xpt1/v/t1.0-0/cp0/e15/q65/s640x640/14606553_1008349382621225_7874949187385135274_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=b5c552778e839983a5da3f97230c3f42&amp;oe=58D45CD1&amp;__gda__=1490195422_13f903d9e8cd72f936e561a26e774453" width="320"/></div></div><div class="n o"><table cellpadding="0" cellspacing="0" class="p"><tr><td valign="top"><a class="q" href="/photo.php?fbid=1016307598492070&amp;id=100003385198671&amp;set=a.113386408784198.15397.100003385198671&amp;refid=13">Previous</a></td><td class="r" valign="top"><a class="q" href="/photo.php?fbid=1006780489444781&amp;id=100003385198671&amp;set=a.113386408784198.15397.100003385198671&amp;refid=13">Next</a></td></tr></table></div></div><div><div class="s t u v"><table class="w x"><tbody><tr><td class="y z ba" style="width:25%"><a class="bb bc bd be" href="/a/like.php?ul&amp;perm&amp;ifab&amp;ft_ent_identifier=1008350115954485&amp;av=100003385198671&amp;gfid=AQBHlBfdG3DXdf3y&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img class="bf bg bh k" height="16" src="https://fbstatic-a.akamaihd.net/rsrc.php/v3/yc/r/yB-I64VDoBZ.png" width="16"/><span class="bi">Like</span></a></td><td class="y z ba" style="width:25%"><a class="bb bc bd be" href="/reactions/picker/?ft_id=1008350115954485&amp;origin_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1008349382621225%26id%3D100003385198671%26set%3Da.113386408784198.15397.100003385198671&amp;av=100003385198671&amp;refid=13"><img class="bf bg k" height="16" src="https://fbstatic-a.akamaihd.net/rsrc.php/v3/ya/r/4o8rk0I8aTS.png" width="16"/><span class="bi">React</span></a></td><td class="y z ba" style="width:25%"><a class="bb bc bd be" href="#composer-1008350115954485"><img class="bf bg bh k" height="16" src="https://fbstatic-a.akamaihd.net/rsrc.php/v3/yx/r/Psiw6TN0rH8.png" width="16"/><span class="bi">Comment</span></a></td><td class="y z bj ba" style="width:25%"><a class="bb bc bd be" href="/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=100003385198671&amp;sid=1008350115954485&amp;m=self&amp;exit_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1008349382621225%26id%3D100003385198671%26set%3Da.113386408784198.15397.100003385198671&amp;cwevent=composer_entry&amp;av=100003385198671&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img class="bf bg bh k" height="16" src="https://fbstatic-a.akamaihd.net/rsrc.php/v3/yU/r/qQMCy4a8cyx.png" width="16"/><span class="bi">Share</span></a></td></tr></tbody></table></div></div><div><div class="bk bl bm bn"><div class="bo"><a class="bp" href="/palpandi.pandi?refid=13"><strong class="bq">போஸ் பாண்டி</strong></a><br/><div class="br">My sister daughter 5th birthday celebrat<div class="bs" id="voice_replace_id"><span class="bt">— with <span><a href="/pal.pandi.58760?refid=13">Pal Pandi</a><span class="bt">(<a class="bu" href="/photo.php?fbid=1008349382621225&amp;id=100003385198671&amp;set=a.113386408784198.15397.100003385198671&amp;rtid=100006840461200&amp;refid=13">remove</a>)</span></span></span></div></div></div><div class="bv bw bx"><span class="bt"><div class="by"><div class="bz bx bt"><abbr>Oct 28</abbr><span>· </span><span class="ca bx">Public</span><span>· </span>in <a href="/palpandi.pandi/albums/113386408784198/?refid=13">Mobile Uploads</a></div><span class="bz bx bt"><a class="cb" href="/photos/xtag_faces/?photo_id=1008349382621225&amp;owner_id=100003385198671&amp;return_uri=%2Fphoto.php%3Ffbid%3D1008349382621225%26id%3D100003385198671%26set%3Da.113386408784198.15397.100003385198671&amp;page_source=photo&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13">Tag Photo</a><span>· </span><a class="cb" href="https://scontent-sin6-1.xx.fbcdn.net/v/t1.0-9/fr/cp0/e15/q65/14606553_1008349382621225_7874949187385135274_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=238af9b011f31d59ee77a25e1b3f5f0b&amp;oe=58C334C5">View Full Size</a><span>· </span><a class="cb" href="/photo.php?fbid=1008349382621225&amp;id=100003385198671&amp;prof&amp;ls=your_photo_permalink&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13">Make Profile Picture</a><span>· </span><a class="cb" href="/editphoto.php?id=1008349382621225&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13">Edit Photo</a><span>· </span><a class="cb" href="/tokenizer/single/?mode=share_msg&amp;sid=1008349382621225&amp;returnURI=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1008349382621225%26id%3D100003385198671%26set%3Da.113386408784198.15397.100003385198671&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13">Send as Message</a></span></div></span></div></div><div><div class="e cc" id="ufi_1008350115954485"><div class="cd ce"><div class="cf cg"><a class="ch" href="/ufi/reaction/profile/browser/?ft_ent_identifier=1008350115954485&amp;refid=13"><div class="ci cj"><span class="ck"><span class="cl"><img alt="Like" class="k" height="16" src="https://fbstatic-a.akamaihd.net/rsrc.php/v3/yj/r/6WffvhOaXGY.png" width="16"/></span></span><div class="cm">Ranjith Nadar and 18 others</div></div></a></div><div class="cd"><div class="cn" id="1008377419285088"><h3><a class="co" href="/profile.php?id=100006508414608&amp;refid=13">Sathishmuthu</a></h3><div>Super Thalaivare</div><div class="cp cq cr"><span class="cs"><span class="ct bt"><a href="/a/comment.php?like_comment_id=1008377419285088&amp;snowflake&amp;ft_ent_identifier=1008350115954485&amp;gfid=AQBOM_UHSziLp1Di&amp;refid=13">Like</a></span></span><span>· </span><a href="/comment/replies/?ctoken=1008350115954485_1008377419285088&amp;actor_id=100003385198671&amp;ft_ent_identifier=1008350115954485&amp;gfid=AQDZnxhEi8JNb1w1&amp;refid=13#comment_form_100003385198671_1008350115954485_reply_1008350115954485_1008377419285088">Reply</a><span>· </span><a href="/ufi/confirm_delete.php?delete_comment_id=1008377419285088&amp;delete_comment_fbid=1008377419285088&amp;ft_ent_identifier=1008350115954485&amp;snowflake&amp;av=100003385198671&amp;gfid=AQBz5KczJn1WX9bu&amp;refid=13">Delete</a><span>· </span><a href="/nfx/basic/question/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22permalink%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22is_rapid_reporting%22%3Afalse%2C%22reportable_ent_token%22%3A%22RW50Q29tbWVudDoxMDA4MzUwMTE1OTU0NDg1XzEwMDgzNzc0MTkyODUwODg%3D%22%2C%22is_impostor%22%3A%22%22%7D&amp;redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1008349382621225%26id%3D100003385198671%26set%3Da.113386408784198.15397.100003385198671&amp;refid=13">Report</a><span>· </span><abbr>Oct 28</abbr></div></div><div class="cn" id="1008380772618086"><h3><a class="co" href="/thangapriya.priya?refid=13">Paul Pandi</a></h3><div>Happy birthday</div><div class="cp cq cr"><span class="cs"><span class="ct bt"><a href="/a/comment.php?like_comment_id=1008380772618086&amp;snowflake&amp;ft_ent_identifier=1008350115954485&amp;gfid=AQAZtMJJ_jv6HEHp&amp;refid=13">Like</a></span></span><span>· </span><a href="/comment/replies/?ctoken=1008350115954485_1008380772618086&amp;actor_id=100003385198671&amp;ft_ent_identifier=1008350115954485&amp;gfid=AQAKKAw-9aPeT6MZ&amp;refid=13#comment_form_100003385198671_1008350115954485_reply_1008350115954485_1008380772618086">Reply</a><span>· </span><a href="/ufi/confirm_delete.php?delete_comment_id=1008380772618086&amp;delete_comment_fbid=1008380772618086&amp;ft_ent_identifier=1008350115954485&amp;snowflake&amp;av=100003385198671&amp;gfid=AQDzPQvrDm-0bPMQ&amp;refid=13">Delete</a><span>· </span><a href="/nfx/basic/question/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22permalink%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22is_rapid_reporting%22%3Afalse%2C%22reportable_ent_token%22%3A%22RW50Q29tbWVudDoxMDA4MzUwMTE1OTU0NDg1XzEwMDgzODA3NzI2MTgwODY%3D%22%2C%22is_impostor%22%3A%22%22%7D&amp;redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1008349382621225%26id%3D100003385198671%26set%3Da.113386408784198.15397.100003385198671&amp;refid=13">Report</a><span>· </span><abbr>Oct 28</abbr></div></div></div><div class="cd cu" id="u_0_0"/><div class="cv cw" id="composer-1008350115954485"><form action="/a/comment.php?fs=7&amp;actionsource=2&amp;comment_logging&amp;ft_ent_identifier=1008350115954485&amp;gfid=AQCQz6f11xOMTXZY&amp;av=100003385198671&amp;refid=13" method="post"><input autocomplete="off" name="fb_dtsg" type="hidden" value="AQHhAYJJbmtb:AQGzRanJX3BU"/><input name="charset_test" type="hidden" value="€,´,€,´,水,Д,Є"/><label class="cx" for="u_0_1">Write a comment...</label><table class="w x" id="u_0_1"><tbody><tr><td class="y"><div class="cy cz"><table class="w da db"><tbody><tr><td class="y dc dd"><input class="de df dg dh" id="composerInput" name="comment_text" type="text"/></td></tr></tbody></table></div></td><td class="di"><div class="dj"><input class="bc dk dl dm" type="submit" value="Comment"/></div></td></tr></tbody></table><span class="dn bx bt"><a href="/mbasic/comment/advanced/?target_id=1008350115954485&amp;pap=1&amp;at=compose&amp;refid=13">Attach a Photo</a><span>· </span><a href="/friends/selector/?return_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D1008350115954485%26pap%26at%3Dcompose&amp;cancel_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D1008350115954485%26pap%26at%3Dcompose&amp;friends_key=ids&amp;refid=13">Mention Friends</a></span></form></div></div></div></div></div></div></div><div/></div></div></div></div></body></html>';
			doTest(done, html, (data) => data.post.media[0].imageUrl.should.equal('https://scontent-sin6-1.xx.fbcdn.net/v/t1.0-9/fr/cp0/e15/q65/14606553_1008349382621225_7874949187385135274_n.jpg?efg=eyJpIjoiYiJ9&oh=238af9b011f31d59ee77a25e1b3f5f0b&oe=58C334C5'));
		});
	});

	describe('#like', function() {

		it('not liked', (done) => {
			let html = '<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Comments</title><meta name="referrer" content="default" id="meta_referrer" /><noscript><meta http-equiv="X-Frame-Options" content="DENY" /></noscript><style type="text/css">/*<![CDATA[*/.b .l{background:#f6f7f8;border:0;font-size:small;margin:0;}.l .ba{font-size:x-small;}.bf>div{border-top:1px solid rgba(0, 0, 0, .101);}.bf>.bf>div:first-child{border-top:none;}.be{background-color:#f6f7f8;color:#141823;}.ca{border-bottom:1px solid #ddd;}.b .ca{padding-bottom:8px;}@-webkit-keyframes mPlatformDialogOauthV4_moveUp{from{opacity:1;transform:translateY(0%);}to{opacity:0;transform:translateY(10%);}}@-webkit-keyframes mPlatformDialogOauthV4_moveDown{from{opacity:0;transform:translateY(10%);}to{opacity:1;transform:translateY(0%);}}@media only screen and (device-width: 320px) and (device-height: 568px){}@media only screen and (device-width: 320px) and (device-height: 480px){}@media (max-height:540px){}@media (max-height:400px){}@media screen and (orientation:portrait){}@media only screen and (orientation: portrait){}@media only screen and (orientation: landscape){}.e{background:#f6f7f8;}.r{background:#fff;}.b .bj{border-color:#ddd;border-width:1px 0 0;}.b .bj .bn{background-color:#f6f7f8;}.b .bj .bn:hover,.b .bj .bn:hover .br{background-color:#e9eaed;}.b .bj .br{background-color:inherit;}.bz{padding:8px 8px 0;}.cb{color:#141823;display:block;font-size:small;}.b .bz .ce table{border:none;}.b .bz .ck{border:1px solid #999;height:36px;padding:3px 3px 4px 0;width:98%;}.cn{padding-left:4px;}.cr{margin-top:4px;}form{margin:0;border:0;}.b .bk{border:0;border-collapse:collapse;margin:0;padding:0;width:100%;}.b .bk tbody,.b .cc>tr>td,.b .cc>tbody>tr>td,.b .bk td.cc{vertical-align:top;}.b .bl>tr>td,.b .bl>tbody>tr>td,.b .bk td.bl{vertical-align:middle;}.b .bk td{padding:0;}.b .bk td.cj{padding:2px;}.b .bm{width:100%;}.cg{background:#fff;}.cd .cl{background-color:transparent;color:#4e5665;display:block;padding:0;width:100%;}.b .cd .cf{border:1px solid #9197a3;}.ci{border:0;display:block;margin:0;padding:0;}.b .cj{padding:2px;}.co{-webkit-appearance:none;background:none;display:inline-block;font-size:12px;height:28px;line-height:28px;margin:0;overflow:visible;padding:0 9px;text-align:center;vertical-align:top;white-space:nowrap;}.b .co{border-radius:2px;}.co[disabled] .bu{opacity:.3;}.cq,a.cq,html .b a.cq{color:#fff;}.b .cq{background-color:#4e69a2;border:1px solid #385490;}.b a.cq:hover,.b .cq:hover{background-color:#465e91;}.cq[disabled]{color:#899bc1;}.b .cq[disabled]:hover{background-color:#4e69a2;}.co .bw{display:inline-block;}.b .co .bw{display:inline-block;margin-top:0;vertical-align:middle;}.b a.co::after,.b .co.bp::after{content:"";display:inline-block;height:100%;vertical-align:middle;}html .co .bu{vertical-align:top;}.co .bw{line-height:20px;margin-top:4px;}.co .bu.bv{margin-top:6px;}.co.bp{padding-left:8px;}.co.bp .bu{margin-right:6px;}.b .co{padding:0 8px;}.b a.co{height:26px;line-height:26px;}.b a.co .bu.bv{margin-top:5px;}.b .co.bp{padding-left:7px;}.bu,.k.bu{display:inline-block;pointer-events:none;vertical-align:middle;}.bw{pointer-events:none;}.bb{color:gray;}.ba{font-size:small;}body,tr,input,textarea,.f{font-size:medium;}.b a,.b a:visited{color:#3b5998;text-decoration:none;}.b .bd,.b .bd:visited{color:#6d84b4;}.b a:focus,.b a:hover,.b .bd:focus,.b .bd:hover{background-color:#3b5998;color:#fff;}.bi{border-color:#d3d6db #cdd0d6 #c0c4cc;border-style:solid;border-width:1px;}.bh .br,.bh .bn{background-color:#fff;}.bn{background-color:#fff;position:relative;}.bn.bn.bn{padding:6px 0;}.br{-webkit-appearance:none;border:none;margin:0;padding:0;}input.bs,button.bs{width:100%;}.br{display:block;}.br{background-color:#fff;color:#4e5665;font-size:small;text-align:center;white-space:nowrap;}.b .bn a.br{color:#4e5665;}.b .bn a.br:hover,.b .bn a.br:focus{background:#f2f2f2;color:#4e5665;}.bn:hover,.bn:focus,.bn:hover .br,.bn:focus .br{background:#f2f2f2;}.br{padding:0 4px;}.bn .br .bt{display:block;margin:0 auto;}.bn .bp.br .bt{margin:0 auto 1px;}.bn .bw{pointer-events:auto;}.k{border:0;display:inline-block;vertical-align:top;}i.k u{position:absolute;width:0;height:0;overflow:hidden;}.m{margin:0 6px 6px;padding:6px;}.b .m .m{border-color:#e9eaed;margin:6px 0 0;}.bc{display:inline-block;}.z{margin-top:5px;}.q{margin:5px 0;}.m a,.m a:visited{color:#2b55ad;}.m a:hover,.m a:focus{background:#2b55ad;color:#fff;}.l .m{font-size:small;padding:4px;}.l .z{margin-top:6px;}.l .q{margin:6px 0;}.b .n{background:white;margin:0;}.s{border-color:#ccced3 #c4c6ca #b4b6ba;border-style:solid;border-width:1px;}.o{color:#4e5665;}.p{font-weight:normal;}.w{position:relative;}.w:after{border:1px solid rgba(0, 0, 0, .1);bottom:0;content:"";left:0;position:absolute;right:0;top:0;}.u .x{background:#f2f2f2;display:inline-block;margin:0 3px 3px 0;}.u .x.y{margin-right:0;}body{text-align:left;direction:ltr;}body,tr,input,textarea,button{font-family:sans-serif;}body,p,figure,h1,h2,h3,h4,h5,h6,ul,ol,li,dl,dd,dt{margin:0;padding:0;}h1,h2,h3,h4,h5,h6{font-size:1em;font-weight:bold;}ul,ol{list-style:none;}article,aside,figcaption,figure,footer,header,nav,section{display:block;}.d #viewport{margin:0 auto;max-width:600px;}#page{position:relative;}.h{background:#3b5998;height:24px;}.i{display:inline-block;}.j{padding:4px 5px 5px;}/*]]>*/</style><link rel="manifest" href="/data/manifest" /></head><body tabindex="0" class="b c d e"><div class="f"><div id="viewport"><div class="g"><h1 class="h" id="header"><a class="i" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fstory.php&amp;refid=52"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/y8/r/k97pj8-or6s.png" width="77" height="16" class="j k" alt="facebook" /></a></h1></div><div id="objects_container"><div id="root" role="main" class="e"><div id="m_story_permalink_view"><div class="l"><div class="m n" id="u_0_2"><div><div><h3 class="o p"><strong><a href="/feest.devisd?fref=nf&amp;refid=52&amp;__tn__=C">Feest Devisd</a></strong> shared <a href="/profile.php?id=100011356005227&amp;fref=nf&amp;refid=52&amp;__tn__=C">Sander Devisd</a>&#039;s <a href="/photo.php?fbid=132861420435724&amp;id=100011356005227&amp;set=a.130815573973642.1073741826.100011356005227&amp;refid=52&amp;__tn__=C">photo</a>.</h3></div><div class="q"><div class="r s m t" id="u_0_3"><div><h3 class="o p"><strong><a href="/profile.php?id=100011356005227&amp;fref=nf&amp;refid=52&amp;__tn__=C">Sander Devisd</a></strong> updated his profile picture.</h3><div class="q"><div class="u v"><a class="w x y" href="/photo.php?fbid=132861420435724&amp;id=100011356005227&amp;set=a.130815573973642.1073741826.100011356005227&amp;refid=52&amp;__tn__=E"><img src="https://scontent.fmel1-1.fna.fbcdn.net/hphotos-xpf1/v/t1.0-0/cp0/e15/q65/p200x200/12744156_132861420435724_260702929061285718_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=82ca8c93112ff6b159eadc459d24b1d9&amp;oe=5754D56B" width="200" height="200" class="k" /></a></div></div></div></div></div></div><div class="z"><div class="ba bb"><abbr>31 mins</abbr><span aria-hidden="true"> · </span><span class="bc"><span><span class="ba">Public</span></span></span></div><div class="ba bb"><a class="bd" href="/nfx/basic/direct_actions/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22permalink%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22hideable_token%22%3A%22MzQyNzcwtTA0sDQ1tLQwqHPNKwkuSSwpLXYuSk0syczPCy7JL6qsqzM0MDAwNDQ2N7MwsTS0sKirM6gDAA%22%2C%22story_permalink_token%22%3A%22S%3A_I100011376849188%3A127705810951980%22%7D&amp;redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2Fstory.php%3Fstory_fbid%3D127705810951980%26id%3D100011376849188%26refid%3D7&amp;refid=52">More</a></div></div></div></div><div class="e be" id="ufi_127705810951980"><div class="bf bg"><div class="bh bi bj"><table class="bk bl"><tbody><tr><td class="bm bn bo" style="width:33%"><a class="bp bq br bs" href="/a/like.php?ul&amp;perm&amp;ifab&amp;ft_ent_identifier=127705810951980&amp;av=100009543463363&amp;gfid=AQBONB9ItVxyuLY5&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fstory.php&amp;refid=52"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yy/r/P2H0Ng8Ff2w.png" width="16" height="16" class="bt bu bv k" /><span class="bw">Like</span></a></td><td class="bm bn bo" style="width:33%"><a class="bp bq br bs" href="#composer-127705810951980"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/ks_T7R1PM8o.png" width="16" height="16" class="bt bu bv k" /><span class="bw">Comment</span></a></td><td class="bm bn bx bo" style="width:33%"><a class="bp bq br bs" href="/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=100009543463363&amp;sid=127705810951980&amp;m=self&amp;exit_uri=https%3A%2F%2Fmbasic.facebook.com%2Fstory.php%3Fstory_fbid%3D127705810951980%26id%3D100011376849188%26refid%3D7&amp;cwevent=composer_entry&amp;av=100009543463363&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fstory.php&amp;refid=52"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/_ByufLrUwa0.png" width="16" height="16" class="bt bu bv k" /><span class="bw">Share</span></a></td></tr></tbody></table></div><div class="bf by" id="u_0_0"></div><div class="bz ca" id="composer-127705810951980"><form method="post" action="/a/comment.php?fs=8&amp;actionsource=1&amp;redirectosoftpermalink&amp;comment_logging&amp;ft_ent_identifier=127705810951980&amp;gfid=AQDQ5mSPlWm1l7OK&amp;av=100009543463363&amp;refid=52"><input type="hidden" name="fb_dtsg" value="AQGkfQMX0TbD:AQHpHrqicen4" autocomplete="off" /><input type="hidden" name="charset_test" value="&#x20ac;,&#xb4;,&#x20ac;,&#xb4;,&#x6c34;,&#x414;,&#x404;" /><label class="cb" for="u_0_1">Write a comment...</label><table class="bk cc" id="u_0_1"><tbody><tr><td class="bm"><div class="cd ce"><table class="bk cf cg"><tbody><tr><td class="bm ch bl"><input class="ci cj ck cl" id="composerInput" name="comment_text" type="text" /></td></tr></tbody></table></div></td><td class="cm"><div class="cn"><input value="Comment" type="submit" class="bq co cp cq" /></div></td></tr></tbody></table><span class="cr ba bb"><a href="/mbasic/comment/advanced/?target_id=127705810951980&amp;pap=1&amp;at=compose&amp;refid=52">Attach a Photo</a><span aria-hidden="true"> · </span><a href="/friends/selector/?return_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D127705810951980%26pap%26at%3Dcompose&amp;cancel_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D127705810951980%26pap%26at%3Dcompose&amp;friends_key=ids&amp;refid=52">Mention Friends</a></span></form></div></div></div></div></div></div></div></div></body></html>'
			let expected = {
				likeStatus: Post.LikeStatusNone
			}
			doTest(done, html, expected)
		})

		it('liked', (done) => {
			let html = '<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Profile pictures</title><meta name="referrer" content="default" id="meta_referrer" /><noscript><meta http-equiv="X-Frame-Options" content="DENY" /></noscript><style type="text/css">/*<![CDATA[*/.bm{background-color:#fff;}.m{background-color:#000;}.n{padding:2px 3px;}.bn{padding:6px 3px;}.o{width:100%;}.o .q{text-align:right;}.b a,.b a:visited{color:#3b5998;text-decoration:none;}.b .bz,.b .bz:visited{color:#6d84b4;}.b .p,.b .p:visited{color:#fff;}.b a:focus,.b a:hover,.b .bz:focus,.b .bz:hover{background-color:#3b5998;color:#fff;}.b .p:focus,.b .p:hover{background-color:#fff;color:#3b5998;}.b .u{border-color:#ddd;border-width:1px 0 0;}.b .u .y{background-color:#f6f7f8;}.b .u .y:hover,.b .u .y:hover .bd{background-color:#e9eaed;}.b .u .bd{background-color:inherit;}.b .u .z .bi{color:#5890ff;}.cc .ce a{font-weight:bold;}.cb>div{border-top:1px solid rgba(0, 0, 0, .101);}.cb>.cb>div:first-child{border-top:none;}.ca,.ca .cg{background-color:#f6f7f8;color:#141823;}.cs{border-bottom:1px solid #ddd;}.b .cs{padding-bottom:8px;}.t{border-color:#d3d6db #cdd0d6 #c0c4cc;border-style:solid;border-width:1px;}.s .bd,.s .y{background-color:#fff;}.b .v{border:0;border-collapse:collapse;margin:0;padding:0;width:100%;}.b .v tbody,.b .cu>tr>td,.b .cu>tbody>tr>td,.b .v td.cu{vertical-align:top;}.b .w>tr>td,.b .w>tbody>tr>td,.b .v td.w{vertical-align:middle;}.b .v td{padding:0;}.b .v td.db{padding:2px;}.b .v td.cd{padding:4px;}.b .x{width:100%;}.y{background-color:#fff;position:relative;}.y.y.y{padding:6px 0;}.bd{-webkit-appearance:none;border:none;margin:0;padding:0;}input.be,button.be{width:100%;}.bd{display:block;}.bd{background-color:#fff;color:#4e5665;font-size:small;text-align:center;white-space:nowrap;}.b .y a.bd{color:#4e5665;}.b .y a.bd:hover,.b .y a.bd:focus{background:#f2f2f2;color:#4e5665;}.y:hover,.y:focus,.y:hover .bd,.y:focus .bd{background:#f2f2f2;}.bd{padding:0 4px;}.y .bd .bf{display:block;margin:0 auto;}.y .bb.bd .bf{margin:0 auto 1px;}.y .bi{pointer-events:auto;}.bg,.img.bg{display:inline-block;pointer-events:none;vertical-align:middle;}.bi{pointer-events:none;}.img{border:0;display:inline-block;vertical-align:top;}i.img u{position:absolute;width:0;height:0;overflow:hidden;}@-webkit-keyframes mPlatformDialogOauthV4_moveUp{from{opacity:1;transform:translateY(0%);}to{opacity:0;transform:translateY(10%);}}@-webkit-keyframes mPlatformDialogOauthV4_moveDown{from{opacity:0;transform:translateY(10%);}to{opacity:1;transform:translateY(0%);}}@media only screen and (device-width: 320px) and (device-height: 568px){}@media only screen and (device-width: 320px) and (device-height: 480px){}@media (max-height:540px){}@media (max-height:400px){}@media screen and (orientation:portrait){}@media only screen and (orientation: portrait){}@media only screen and (orientation: landscape){}.e{background:#f6f7f8;}.cf{background:#eceff5;font-size:small;padding:8px;}.cf a{font-weight:bold;}.cr{padding:8px 8px 0;}.ct{color:#141823;display:block;font-size:small;}.b .cr .cw table{border:none;}.b .cr .dc{border:1px solid #999;height:36px;padding:3px 3px 4px 0;width:98%;}.bl{padding:4px;}.cn{padding-top:4px;}.df{padding-left:4px;}.dj{margin-top:4px;}form{margin:0;border:0;}.cy{background:#fff;}.cv .dd{background-color:transparent;color:#4e5665;display:block;padding:0;width:100%;}.b .cv .cx{border:1px solid #9197a3;}.da{border:0;display:block;margin:0;padding:0;}.b .db{padding:2px;}.b .cd{padding:4px;}.dg{-webkit-appearance:none;background:none;display:inline-block;font-size:12px;height:28px;line-height:28px;margin:0;overflow:visible;padding:0 9px;text-align:center;vertical-align:top;white-space:nowrap;}.b .dg{border-radius:2px;}.dg[disabled] .bg{opacity:.3;}.di,a.di,html .b a.di{color:#fff;}.b .di{background-color:#4e69a2;border:1px solid #385490;}.b a.di:hover,.b .di:hover{background-color:#465e91;}.di[disabled]{color:#899bc1;}.b .di[disabled]:hover{background-color:#4e69a2;}.dg .bi{display:inline-block;}.b .dg .bi{display:inline-block;margin-top:0;vertical-align:middle;}.b a.dg::after,.b .dg.bb::after{content:"";display:inline-block;height:100%;vertical-align:middle;}html .dg .bg{vertical-align:top;}.dg .bi{line-height:20px;margin-top:4px;}.dg .bg.bh{margin-top:6px;}.dg.bb{padding-left:8px;}.dg.bb .bg{margin-right:6px;}.b .dg{padding:0 8px;}.b a.dg{height:26px;line-height:26px;}.b a.dg .bg.bh{margin-top:5px;}.b .dg.bb{padding-left:7px;}.bv{color:gray;}.bu{font-size:small;}body,tr,input,textarea,.f{font-size:medium;}.bk{border-bottom:1px solid #ddd;font-size:small;}.by,.br{display:inline;}.bk .bx,.bk .by .f,.bk .by.bu,.bk .by .bu{font-size:x-small;}.bt{margin-top:2px;}@-webkit-keyframes highlightFade{0%{background:#fff9d7;}50%{background:#fff9d7;}100%{background:transparent;}}.cj{color:#9197a3;}.ci{font-size:12px;line-height:16px;}.ck{font-weight:normal;}body{text-align:left;direction:ltr;}body,tr,input,textarea,button{font-family:sans-serif;}body,p,figure,h1,h2,h3,h4,h5,h6,ul,ol,li,dl,dd,dt{margin:0;padding:0;}h1,h2,h3,h4,h5,h6{font-size:1em;font-weight:bold;}ul,ol{list-style:none;}article,aside,figcaption,figure,footer,header,nav,section{display:block;}.d #viewport{margin:0 auto;max-width:600px;}#page{position:relative;}.h{background:#3b5998;height:24px;}.i{display:inline-block;}.j{padding:4px 5px 5px;}/*]]>*/</style><meta name="robots" content="noindex" /><link rel="manifest" href="/data/manifest" /></head><body tabindex="0" class="b c d e"><div class="f"><div id="viewport"><div class="g"><h1 class="h" id="header"><a class="i" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/y8/r/k97pj8-or6s.png" width="77" height="16" class="j img" alt="facebook" /></a></h1></div><div id="objects_container"><div class="k e" id="root" role="main"><div class="l"><div><div><div class="m"><div style="text-align:center;"><img src="https://scontent.fper2-1.fna.fbcdn.net/hphotos-xfp1/v/t1.0-0/cp0/e15/q65/s320x320/12734088_234981433506348_2057691236210521989_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=1078666d342469ef115ba857a33288ed&amp;oe=576DAB10" width="320" height="180" class="img" /></div></div><div class="m n"><table cellspacing="0" cellpadding="0" class="o"><tr><td valign="top"><a class="p" href="/photo.php?fbid=107249772946182&amp;id=100009834785112&amp;set=a.107249819612844.1073741826.100009834785112&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Previous</a></td><td valign="top" class="q"><a class="p" href="/photo.php?fbid=107249772946182&amp;id=100009834785112&amp;set=a.107249819612844.1073741826.100009834785112&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Next</a></td></tr></table></div></div><div><div class="s t u"><table class="v w"><tbody><tr><td class="x y z ba" style="width:25%"><a class="bb bc bd be" href="/a/like.php?ul=1&amp;perm&amp;ifab&amp;ft_ent_identifier=234981433506348&amp;av=100009543463363&amp;gfid=AQBcW4KLjhUkQFBu&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yu/r/VYNYSvu5NAQ.png" width="16" height="16" class="bf bg bh img" /><span class="bi">Like</span></a></td><td class="x y ba" style="width:25%"><a class="bb bc bd be" href="#composer-234981433506348"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/ks_T7R1PM8o.png" width="16" height="16" class="bf bg bh img" /><span class="bi">Comment</span></a></td><td class="x y ba" style="width:25%"><a class="bb bc bd be" href="/photos/xtag_faces/?photo_id=234981433506348&amp;owner_id=100009834785112&amp;return_uri=%2Fphoto.php%3Ffbid%3D234981433506348%26id%3D100009834785112%26set%3Da.107249819612844.1073741826.100009834785112&amp;page_source=photo&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yE/r/Q-U_WZzAqVP.png" width="16" height="16" class="bf bg bh img" /><span class="bi">Tag</span></a></td><td class="x y bj ba" style="width:25%"><a class="bb bc bd be" href="/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=100009543463363&amp;sid=234981433506348&amp;m=self&amp;exit_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D234981433506348%26id%3D100009834785112%26set%3Da.107249819612844.1073741826.100009834785112%26bacr%3D1456282253%253A1456282253%253A9%253A41774056594996059%253A1456280343%253A0%253A0%253A3600%26refid%3D28%26_ft_%3Dqid.6254692390982509928%253Amf_story_key.2531467133139350377&amp;cwevent=composer_entry&amp;av=100009543463363&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377"><img src="https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/_ByufLrUwa0.png" width="16" height="16" class="bf bg bh img" /><span class="bi">Share</span></a></td></tr></tbody></table></div></div><div><div class="bk bl bm bn"><div class="bo"><a class="bp" href="/profile.php?id=100009834785112&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377"><strong class="bq">Skooter Martin</strong></a><br /><div><div id="voice_replace_id" class="br"></div></div></div><div class="bs bt bu"><span class="bv"><div class="bw"><div class="bx bu bv"><abbr>2 hours ago</abbr><span aria-hidden="true"> · </span><span class="by bu">Public</span><span aria-hidden="true"> · </span>in <a href="/100009834785112/albums/107249819612844/?refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Profile pictures</a></div><span class="bx bu bv"><a class="bz" href="https://scontent.fper2-1.fna.fbcdn.net/hphotos-xlp1/t31.0-8/fr/cp0/e15/q65/12711223_234981433506348_2057691236210521989_o.jpg?efg=eyJpIjoiYiJ9">View full size</a><span aria-hidden="true"> · </span><a class="bz" href="/tokenizer/single/?mode=share_msg&amp;sid=234981433506348&amp;returnURI=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D234981433506348%26id%3D100009834785112%26set%3Da.107249819612844.1073741826.100009834785112%26bacr%3D1456282253%253A1456282253%253A9%253A41774056594996059%253A1456280343%253A0%253A0%253A3600%26refid%3D28%26_ft_%3Dqid.6254692390982509928%253Amf_story_key.2531467133139350377&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Send as message</a><span aria-hidden="true"> · </span><a class="bz" href="/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%22234981433506348%22%2C%22is_impostor%22%3A%22%22%7D&amp;is_direct=1&amp;action_key=RESOLVE_PROBLEM&amp;redirect_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D234981433506348%26id%3D100009834785112%26set%3Da.107249819612844.1073741826.100009834785112%26bacr%3D1456282253%253A1456282253%253A9%253A41774056594996059%253A1456280343%253A0%253A0%253A3600%26refid%3D28%26_ft_%3Dqid.6254692390982509928%253Amf_story_key.2531467133139350377&amp;ext=1456543305&amp;hash=AeTYRPDGEKXGB0m7&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Report</a></span></div></span></div></div><div><div class="e ca" id="ufi_234981433506348"><div class="cb cc"><div class="cd ce cf cg">You and <a href="/234981433506348/likes/?cancel_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D234981433506348%26id%3D100009834785112%26set%3Da.107249819612844.1073741826.100009834785112%26bacr%3D1456282253%253A1456282253%253A9%253A41774056594996059%253A1456280343%253A0%253A0%253A3600%26refid%3D28%26_ft_%3Dqid.6254692390982509928%253Amf_story_key.2531467133139350377&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">8 others</a> like this.</div><div class="cb"><div class="cd" id="234983670172791"><h3><a class="ch" href="/teest.devisd?refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Teest Devisd</a></h3><div>A little late, but a little cute little lad nonetheless...</div><div class="ci cj ck"><span class="cl"><span class="cm bv"><a href="/a/comment.php?like_comment_id=234983670172791&amp;snowflake&amp;redirectosoftpermalink&amp;ft_ent_identifier=234981433506348&amp;gfid=AQAkJuwJMiUVQBc-&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Like</a></span></span><span aria-hidden="true"> · </span><a href="/comment/replies/?ctoken=234981433506348_234983670172791&amp;actor_id=100009543463363&amp;ft_ent_identifier=234981433506348&amp;gfid=AQB6IcLurhXzOSGF&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377#comment_form_100009834785112_234981433506348_reply_234981433506348_234983670172791">Reply</a><span aria-hidden="true"> · </span><a href="/mbasic/comment/advanced/?target_id=234981433506348&amp;at=edit&amp;ctoken=234981433506348_234983670172791&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Edit</a><span aria-hidden="true"> · </span><abbr>2 hours ago</abbr></div></div><div class="cd" id="234984726839352"><h3><a class="ch" href="/amytomlinson916?refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Amy Tomlinson</a></h3><div>How gorgeous is that xx</div><div class="ci cj ck"><span class="cl"><span class="cm bv"><a href="/a/comment.php?like_comment_id=234984726839352&amp;snowflake&amp;redirectosoftpermalink&amp;ft_ent_identifier=234981433506348&amp;gfid=AQBVEv4iFFZKs--y&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Like</a></span></span><span aria-hidden="true"> · </span><a href="/comment/replies/?ctoken=234981433506348_234984726839352&amp;actor_id=100009543463363&amp;ft_ent_identifier=234981433506348&amp;gfid=AQABBTSbthEIDy10&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377#comment_form_100009834785112_234981433506348_reply_234981433506348_234984726839352">Reply</a><span aria-hidden="true"> · </span><a href="/nfx/basic/question/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22permalink%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%22RW50Q29tbWVudDoyMzQ5ODE0MzM1MDYzNDhfMjM0OTg0NzI2ODM5MzUy%22%2C%22is_impostor%22%3A%22%22%7D&amp;redirect_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D234981433506348%26id%3D100009834785112%26set%3Da.107249819612844.1073741826.100009834785112%26bacr%3D1456282253%253A1456282253%253A9%253A41774056594996059%253A1456280343%253A0%253A0%253A3600%26refid%3D28%26_ft_%3Dqid.6254692390982509928%253Amf_story_key.2531467133139350377&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Report</a><span aria-hidden="true"> · </span><abbr>2 hours ago</abbr></div></div><div class="cd" id="234987963505695"><h3><a class="ch" href="/kelly.stace.3?refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Kelly Stace</a></h3><div>Sooo cute!!!</div><div class="ci cj ck"><span class="cl"><span class="cm bv"><a href="/a/comment.php?like_comment_id=234987963505695&amp;snowflake&amp;redirectosoftpermalink&amp;ft_ent_identifier=234981433506348&amp;gfid=AQDCgBxAFWmsvSnd&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Like</a></span></span><span aria-hidden="true"> · </span><a href="/comment/replies/?ctoken=234981433506348_234987963505695&amp;actor_id=100009543463363&amp;ft_ent_identifier=234981433506348&amp;gfid=AQD8EzxuUtnoss-8&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377#comment_form_100009834785112_234981433506348_reply_234981433506348_234987963505695">Reply</a><span aria-hidden="true"> · </span><a href="/nfx/basic/question/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22permalink%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%22RW50Q29tbWVudDoyMzQ5ODE0MzM1MDYzNDhfMjM0OTg3OTYzNTA1Njk1%22%2C%22is_impostor%22%3A%22%22%7D&amp;redirect_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D234981433506348%26id%3D100009834785112%26set%3Da.107249819612844.1073741826.100009834785112%26bacr%3D1456282253%253A1456282253%253A9%253A41774056594996059%253A1456280343%253A0%253A0%253A3600%26refid%3D28%26_ft_%3Dqid.6254692390982509928%253Amf_story_key.2531467133139350377&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Report</a><span aria-hidden="true"> · </span><abbr>2 hours ago</abbr></div></div><div class="cd" id="235006286837196"><h3><a class="ch" href="/sian.churcher.1?refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Sian Churcher</a></h3><div>Can totally tell he&#039;s your boy! Looks like you!!</div><div class="ci cj ck"><span class="cl"><span class="cm bv"><a href="/a/comment.php?like_comment_id=235006286837196&amp;snowflake&amp;redirectosoftpermalink&amp;ft_ent_identifier=234981433506348&amp;gfid=AQCILVd1h1mbhpqP&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Like</a></span></span><span aria-hidden="true"> · </span><a href="/comment/replies/?ctoken=234981433506348_235006286837196&amp;actor_id=100009543463363&amp;ft_ent_identifier=234981433506348&amp;gfid=AQCK80qkViuvq8od&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377#comment_form_100009834785112_234981433506348_reply_234981433506348_235006286837196">Reply</a><span aria-hidden="true"> · </span><a href="/nfx/basic/question/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22permalink%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%22RW50Q29tbWVudDoyMzQ5ODE0MzM1MDYzNDhfMjM1MDA2Mjg2ODM3MTk2%22%2C%22is_impostor%22%3A%22%22%7D&amp;redirect_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D234981433506348%26id%3D100009834785112%26set%3Da.107249819612844.1073741826.100009834785112%26bacr%3D1456282253%253A1456282253%253A9%253A41774056594996059%253A1456280343%253A0%253A0%253A3600%26refid%3D28%26_ft_%3Dqid.6254692390982509928%253Amf_story_key.2531467133139350377&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Report</a><span aria-hidden="true"> · </span><abbr>1 hour ago</abbr></div><div class="cn" id="comment_replies_more_1:234981433506348_235006286837196"><div class="ci co cp"><a href="/comment/replies/?ctoken=234981433506348_235006286837196&amp;count=1&amp;pc=1&amp;ft_ent_identifier=234981433506348&amp;gfid=AQCRcxaMVqNah6cJ&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">1 reply</a></div></div></div><div class="cd" id="235009963503495"><h3><a class="ch" href="/jan.stone.9235?refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Jan Stone</a></h3><div>What a lovely photo <img src="https://static.xx.fbcdn.net/rsrc.php/v2/yL/r/_vxTn6fgK7m.png" width="16" height="16" class="m_fbEmoji_icon m_fbEmoji_size_16 img" /></div><div class="ci cj ck"><span class="cl"><span class="cm bv"><a href="/a/comment.php?like_comment_id=235009963503495&amp;snowflake&amp;redirectosoftpermalink&amp;ft_ent_identifier=234981433506348&amp;gfid=AQCzfmEsf5S4wkhx&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Like</a></span></span><span aria-hidden="true"> · </span><a href="/comment/replies/?ctoken=234981433506348_235009963503495&amp;actor_id=100009543463363&amp;ft_ent_identifier=234981433506348&amp;gfid=AQAKBk0goJQPAmyL&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377#comment_form_100009834785112_234981433506348_reply_234981433506348_235009963503495">Reply</a><span aria-hidden="true"> · </span><a href="/nfx/basic/question/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22permalink%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%22RW50Q29tbWVudDoyMzQ5ODE0MzM1MDYzNDhfMjM1MDA5OTYzNTAzNDk1%22%2C%22is_impostor%22%3A%22%22%7D&amp;redirect_uri=https%3A%2F%2Fm.facebook.com%2Fphoto.php%3Ffbid%3D234981433506348%26id%3D100009834785112%26set%3Da.107249819612844.1073741826.100009834785112%26bacr%3D1456282253%253A1456282253%253A9%253A41774056594996059%253A1456280343%253A0%253A0%253A3600%26refid%3D28%26_ft_%3Dqid.6254692390982509928%253Amf_story_key.2531467133139350377&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Report</a><span aria-hidden="true"> · </span><abbr>1 hour ago</abbr></div></div></div><div class="cb cq" id="u_0_0"></div><div class="cr cs" id="composer-234981433506348"><form method="post" action="/a/comment.php?fs=7&amp;actionsource=13&amp;redirectosoftpermalink&amp;comment_logging&amp;ft_ent_identifier=234981433506348&amp;gfid=AQAlZdevMqU4JBMD&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377&amp;av=100009543463363&amp;refid=13"><input type="hidden" name="fb_dtsg" value="AQFq4fxFC09K:AQFHvlN8zO8P" autocomplete="off" /><input type="hidden" name="charset_test" value="&#x20ac;,&#xb4;,&#x20ac;,&#xb4;,&#x6c34;,&#x414;,&#x404;" /><label class="ct" for="u_0_1">Write a comment...</label><table class="v cu" id="u_0_1"><tbody><tr><td class="x"><div class="cv cw"><table class="v cx cy"><tbody><tr><td class="x cz w"><input class="da db dc dd" id="composerInput" name="comment_text" type="text" /></td></tr></tbody></table></div></td><td class="de"><div class="df"><input value="Comment" type="submit" class="bc dg dh di" /></div></td></tr></tbody></table><span class="dj bu bv"><a href="/mbasic/comment/advanced/?target_id=234981433506348&amp;pap=1&amp;at=compose&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Attach a Photo</a><span aria-hidden="true"> · </span><a href="/friends/selector/?return_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D234981433506348%26pap%26at%3Dcompose&amp;cancel_uri=%2Fmbasic%2Fcomment%2Fadvanced%2F%3Ftarget_id%3D234981433506348%26pap%26at%3Dcompose&amp;friends_key=ids&amp;refid=13&amp;_ft_=qid.6254692390982509928%3Amf_story_key.2531467133139350377">Mention Friends</a></span></form></div></div></div></div></div></div></div></div></div></div></div></body></html>'
			let expected = {
				likeStatus: Post.LikeStatusLike
			}
			doTest(done, html, expected)
		})

	})

	describe('#dirty foreign language tests', function() {

		it('Spanish parsing of image URLs...', (done) => {
			let html = '<?xml version=\"1.0\" encoding=\"utf-8\"?><?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE html PUBLIC \"-//WAPFORUM//DTD XHTML Mobile 1.0//EN\" \"http://www.wapforum.org/DTD/xhtml-mobile10.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><title>Fotos de la publicación de Robert Mcauley</title></head><body tabindex=\"0\" class=\"b c d e\"><div class=\"f\"><div id=\"viewport\"><div class=\"g\"><h1 class=\"h\" id=\"header\"><a class=\"i\" href=\"/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/y8/r/k97pj8-or6s.png\" width=\"77\" height=\"16\" class=\"j k\" alt=\"facebook\" /></a></h1></div><div id=\"objects_container\"><div id=\"root\" role=\"main\" class=\"e\"><div class=\"l\"><div><div><div class=\"m\"><div style=\"text-align:center;\"><img src=\"https://scontent.fmel1-1.fna.fbcdn.net/hphotos-xpf1/v/t1.0-0/cp0/e15/q65/p320x320/12734093_1137400252970741_6873586890841851245_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=d8c3cf121ab57e4cebf0fe98974c62d9&amp;oe=575D664F\" width=\"320\" height=\"428\" class=\"k\" /></div></div><div class=\"m n\"><table cellspacing=\"0\" cellpadding=\"0\" class=\"o\"><tr><td valign=\"top\"><a class=\"p\" href=\"/photo.php?fbid=1137400386304061&amp;id=100001023311939&amp;set=pcb.1356323211059991&amp;source=48&amp;refid=13\">Anterior</a></td><td valign=\"top\" class=\"q\"><a class=\"p\" href=\"/photo.php?fbid=1137400292970737&amp;id=100001023311939&amp;set=pcb.1356323211059991&amp;source=48&amp;refid=13\">Siguiente</a></td></tr></table></div></div><div><div class=\"s t u\"><table class=\"v w\"><tbody><tr><td class=\"x y z\" style=\"width:33%\"><a class=\"ba bb bc bd\" href=\"/a/like.php?ul&amp;perm&amp;ifab&amp;ft_ent_identifier=1356323284393317&amp;av=100009834785112&amp;gfid=AQCwEIsW5dgxqhsL&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yy/r/P2H0Ng8Ff2w.png\" width=\"16\" height=\"16\" class=\"be bf bg k\" /><span class=\"bh\">Me gusta</span></a></td><td class=\"x y z\" style=\"width:33%\"><a class=\"ba bb bc bd\" href=\"#composer-1356323284393317\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yw/r/ks_T7R1PM8o.png\" width=\"16\" height=\"16\" class=\"be bf bg k\" /><span class=\"bh\">Comentar</span></a></td><td class=\"x y bi z\" style=\"width:33%\"><a class=\"ba bb bc bd\" href=\"/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=100009834785112&amp;sid=1137400252970741&amp;m=self&amp;exit_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1137400252970741%26id%3D100001023311939%26set%3Dpcb.1356323211059991%26relevant_count%3D3%26source%3D48%26refid%3D18&amp;cwevent=composer_entry&amp;av=100009834785112&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13\"><img src=\"https://static.xx.fbcdn.net/rsrc.php/v2/yP/r/_ByufLrUwa0.png\" width=\"16\" height=\"16\" class=\"be bf bg k\" /><span class=\"bh\">Compartir</span></a></td></tr></tbody></table></div></div><div><div class=\"bj bk bl bm\"><div class=\"bn\"><a class=\"bo\" href=\"/robert.mcauley.336?refid=13\"><strong class=\"bp\">Robert Mcauley</strong></a><span class=\"bq\"> &gt; </span><a href=\"/groups/1172970366061944?refid=13\"><strong>Perth Alcohol Economy (using alcohol as currency to trade)</strong></a><br /><div><div id=\"voice_replace_id\" class=\"br\"></div></div></div><div class=\"bs bt bu\"><span class=\"bq\"><div class=\"bv\"><div class=\"bw bu bq\"><abbr>hace 10 minutos</abbr><span aria-hidden=\"true\"> · </span><span class=\"bx bu\">Perth Alcohol Eco...</span><span aria-hidden=\"true\"> · </span>en <a href=\"https://mbasic.facebook.com/media/set/?set=pcb.1356323211059991&amp;type=1&amp;refid=13\">Fotos de la publicación de Robert Mcauley</a></div><span class=\"bw bu bq\"><a class=\"by\" href=\"https://scontent.fmel1-1.fna.fbcdn.net/hphotos-xpl1/t31.0-8/fr/cp0/e15/q65/12711294_1137400252970741_6873586890841851245_o.jpg?efg=eyJpIjoiYiJ9\">Ver en tamaño grande</a><span aria-hidden=\"true\"> · </span><a class=\"by\" href=\"/tokenizer/single/?mode=share_msg&amp;sid=1137400252970741&amp;returnURI=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1137400252970741%26id%3D100001023311939%26set%3Dpcb.1356323211059991%26relevant_count%3D3%26source%3D48%26refid%3D18&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13\">Enviar como mensaje</a><span aria-hidden=\"true\"> · </span><a class=\"by\" href=\"/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22reportable_ent_token%22%3A%221137400252970741%22%2C%22is_impostor%22%3A%22%22%7D&amp;is_direct=1&amp;action_key=RESOLVE_PROBLEM&amp;redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D1137400252970741%26id%3D100001023311939%26set%3Dpcb.1356323211059991%26relevant_count%3D3%26source%3D48%26refid%3D18&amp;ext=1456472469&amp;hash=AeSNrdssuILjnNEu&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13\">Reportar</a></span></div></span></div></div></div></div></div></div></div></div></div></body></html>';
			let expected = {
				media: [
					new Media({
						imageUrl: 'https://scontent.fmel1-1.fna.fbcdn.net/hphotos-xpl1/t31.0-8/fr/cp0/e15/q65/12711294_1137400252970741_6873586890841851245_o.jpg?efg=eyJpIjoiYiJ9',
						mimeType: 'image/jpeg',
						srcUrl: 'https://scontent.fmel1-1.fna.fbcdn.net/hphotos-xpl1/t31.0-8/fr/cp0/e15/q65/12711294_1137400252970741_6873586890841851245_o.jpg?efg=eyJpIjoiYiJ9',
						type: 'photo'
					})
				]
			};
			doTest(done, html, expected);
		});


		it('Tag user page offered in Dutch...', (done) => {
			let html = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Omslagfoto\'s</title></head><body class="b c d e" tabindex="0"><div class="f"><div id="viewport"><div class="g"><h1 class="h" id="header"><a class="i" href="/home.php?ref_component=mbasic_home_logo&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13"><img alt="facebook" class="j k" height="15" src="https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/5Zo8s-IGqA1.png" width="77"/></a></h1></div><div id="objects_container"><div class="l e" id="root" role="main"><div class="m"><div><div><div class="n"><div style="text-align:center;"><img class="k" height="210" src="https://scontent.fper1-1.fna.fbcdn.net/v/t1.0-0/cp0/e15/q65/s640x640/14364719_10157472660720305_7060260747699224928_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=fe7b8266e7a859e1cbb51a88da103c37&amp;oe=5878B206" width="320"/></div></div><div class="n o"><table cellpadding="0" cellspacing="0" class="p"><tr><td valign="top"><a class="q" href="/photo.php?fbid=10153303939495305&amp;id=879265304&amp;set=a.10151176800485305.790634.879265304&amp;refid=13&amp;_ft_=qid.6332600421382950849%3Amf_story_key.6625549484716698576">Vorige</a></td><td class="r" valign="top"><a class="q" href="/photo.php?fbid=10157108258910305&amp;id=879265304&amp;set=a.10151176800485305.790634.879265304&amp;refid=13&amp;_ft_=qid.6332600421382950849%3Amf_story_key.6625549484716698576">Volgende</a></td></tr></table></div></div><div><div class="s t u"><table class="v w"><tbody><tr><td class="x y z" style="width:50%"><a class="ba bb bc bd" href="/photos/xtag_faces/?photo_id=10157472660720305&amp;owner_id=879265304&amp;return_uri=%2Fphoto.php%3Ffbid%3D10157472660720305%26id%3D879265304%26set%3Da.10151176800485305.790634.879265304&amp;page_source=photo&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6332600421382950849%3Amf_story_key.6625549484716698576"><img class="be bf bg k" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/UTvGUwr4lXO.png" width="16"/><span class="bh">Taggen</span></a></td><td class="x y bi z" style="width:50%"><a class="ba bb bc bd" href="/composer/mbasic/?c_src=share&amp;referrer=permalink&amp;target=100009834785112&amp;sid=10157472660720305&amp;m=self&amp;exit_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D10157472660720305%26id%3D879265304%26set%3Da.10151176800485305.790634.879265304%26bacr%3D1474421842%253A1474421842%253A24%253A-5434171621776776771%253A1474421607%253A0%26refid%3D28%26_ft_%3Dqid.6332600421382950849%253Amf_story_key.6625549484716698576&amp;cwevent=composer_entry&amp;av=100009834785112&amp;view_overview&amp;ref_component=mbasic_photo_permalink_actionbar&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6332600421382950849%3Amf_story_key.6625549484716698576"><img class="be bf bg k" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/yU/r/qQMCy4a8cyx.png" width="16"/><span class="bh">Delen</span></a></td></tr></tbody></table></div></div><div><div class="bj bk bl bm"><div class="bn"><a class="bo" href="/nicolethuijs?refid=13&amp;_ft_=qid.6332600421382950849%3Amf_story_key.6625549484716698576"><strong class="bp">Nicole Thuijs</strong></a><br/><div><div class="bq" id="voice_replace_id"/></div></div><div class="br bs bt"><span class="bu"><div class="bv"><div class="bw bt bu"><abbr>1 uur geleden</abbr><span aria-hidden="true">· </span><span class="bx bt">Openbaar</span><span aria-hidden="true">· </span>in <a href="/nicolethuijs/albums/10151176800485305/?refid=13&amp;_ft_=qid.6332600421382950849%3Amf_story_key.6625549484716698576">Omslagfoto\'s</a></div><span class="bw bt bu"><a class="by" href="/photos/xtag_faces/?photo_id=10157472660720305&amp;owner_id=879265304&amp;return_uri=%2Fphoto.php%3Ffbid%3D10157472660720305%26id%3D879265304%26set%3Da.10151176800485305.790634.879265304&amp;page_source=photo&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6332600421382950849%3Amf_story_key.6625549484716698576">Foto taggen</a><span aria-hidden="true">· </span><a class="by" href="https://scontent.fper1-1.fna.fbcdn.net/v/t1.0-9/fr/cp0/e15/q65/14364719_10157472660720305_7060260747699224928_n.jpg?efg=eyJpIjoiYiJ9&amp;oh=9a63f4e3b5e688fb13782b2224757f1e&amp;oe=586624AF">Volledige grootte weergeven</a><span aria-hidden="true">· </span><a class="by" href="/tokenizer/single/?mode=share_msg&amp;sid=10157472660720305&amp;returnURI=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D10157472660720305%26id%3D879265304%26set%3Da.10151176800485305.790634.879265304%26bacr%3D1474421842%253A1474421842%253A24%253A-5434171621776776771%253A1474421607%253A0%26refid%3D28%26_ft_%3Dqid.6332600421382950849%253Amf_story_key.6625549484716698576&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6332600421382950849%3Amf_story_key.6625549484716698576">Versturen als bericht</a><span aria-hidden="true">· </span><a class="by" href="/nfx/basic/handle_action/?context_str=%7B%22breadcrumbs%22%3A%5B%5D%2C%22story_location%22%3A%22photo_viewer%22%2C%22is_from_feed_tombstone%22%3Afalse%2C%22actions_taken%22%3A%22%22%2C%22is_rapid_reporting%22%3Afalse%2C%22reportable_ent_token%22%3A%2210157472660720305%22%2C%22is_impostor%22%3A%22%22%7D&amp;is_direct=1&amp;action_key=RESOLVE_PROBLEM&amp;redirect_uri=https%3A%2F%2Fmbasic.facebook.com%2Fphoto.php%3Ffbid%3D10157472660720305%26id%3D879265304%26set%3Da.10151176800485305.790634.879265304%26bacr%3D1474421842%253A1474421842%253A24%253A-5434171621776776771%253A1474421607%253A0%26refid%3D28%26_ft_%3Dqid.6332600421382950849%253Amf_story_key.6625549484716698576&amp;ext=1474682636&amp;hash=AeRFmuLUCnl0vtNv&amp;ref_component=mbasic_photo_permalink&amp;ref_page=%2Fwap%2Fphoto.php&amp;refid=13&amp;_ft_=qid.6332600421382950849%3Amf_story_key.6625549484716698576">Rapporteren</a></span></div></span></div></div><div><div class="e bz" id="ufi_10157472660720305"><div class="ca cb"><div class="cc cd"><a class="ce" href="/ufi/reaction/profile/browser/?ft_ent_identifier=10157472660720305&amp;refid=13&amp;_ft_=qid.6332600421382950849%3Amf_story_key.6625549484716698576"><div class="cf cg"><span class="ch"><span class="ci"><img alt="Leuk" class="k" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/yj/r/6WffvhOaXGY.png" width="16"/></span><span class="ci"><img alt="Geweldig" class="k" height="16" src="https://static.xx.fbcdn.net/rsrc.php/v3/y1/r/RvGKklgAefT.png" width="16"/></span></span><div aria-label="Julia Lawrence en 11 anderen hebben gereageerd" class="cj">Julia Lawrence en 11 anderen</div></div></a></div><div class="ca ck" id="u_0_0"/></div></div></div></div></div></div><div/></div></div></div></div></body></html>';
			let expected = {
				media: [
					new Media({
						imageUrl: 'https://scontent.fper1-1.fna.fbcdn.net/v/t1.0-9/fr/cp0/e15/q65/14364719_10157472660720305_7060260747699224928_n.jpg?efg=eyJpIjoiYiJ9&oh=9a63f4e3b5e688fb13782b2224757f1e&oe=586624AF',
						mimeType: 'image/jpeg',
						srcUrl: 'https://scontent.fper1-1.fna.fbcdn.net/v/t1.0-9/fr/cp0/e15/q65/14364719_10157472660720305_7060260747699224928_n.jpg?efg=eyJpIjoiYiJ9&oh=9a63f4e3b5e688fb13782b2224757f1e&oe=586624AF',
						type: 'photo'
					})
				]
			};
			doTest(done, html, expected);
		});

	});
});